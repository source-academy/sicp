<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" />
    <!-- Global site tag (gtag.js) - Google Analytics - START -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-156801664-1"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "UA-156801664-1");
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics - END -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="4.3.3&nbsp;&nbsp;
    Implementing the
    
      <span style="color:green">Amb</span>
      <span style="color:blue">amb</span>
    
    Evaluator
   - SICP Comparison Edition"/><title>4.3.3&nbsp;&nbsp;
    Implementing the
    
      <span style="color:green">Amb</span>
      <span style="color:blue">amb</span>
    
    Evaluator
   - SICP Comparison Edition</title><meta name="csrf-param" content="authenticity_token" />
    <meta
      name="csrf-token"
      content="EMTEijVc2kiiKUH4nYH0lQG3pLPfMowQ/Stg//t6DCo0e5pWMQwamnTvIdmVZqY/MqSx2IYYE+2bpNV6UNSMwQ=="
    />
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    -->
    <link
      href="https://fonts.googleapis.com/css?family=Inconsolata&display?swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Droid+Sans|Droid+Serif"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      media="all"
      href="../assets/stylesheet.css"
    />

    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="../assets/sourcepower.ico"
    />

    <!--    <link rel="shortcut icon" type="image/png" href="../images/lambda.png" /> -->

    <!-- for support of progressive web app, see github README, DISABLED!
    <link rel="manifest" href="../static/manifest.json">
    -->

    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
      integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
      crossorigin="anonymous"
    />
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
      integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
      crossorigin="anonymous"
    />

    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script> -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-AMS-MML_HTMLorMML-full"
    />
    <!--  <script type="text/javascript"
      src="../MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML-full">
    </script> -->
    <script src="../assets/application.js"></script>

    <!-- Rendering inline LaTeX -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true,
          jax: ["input/TeX","output/HTML-CSS"]
        }
      });
    </script>
    <!--<script src="/mathjax/MathJax.js?config=TeX-AMS_HTML-full.js" type="text/javascript"></script>-->
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script
        src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"
        type="text/javascript"
      ></script>
    <![endif]--> </head><body><!-- support for progressive web app, see README, DISABLED -->
    <!-- <script>
      if ("serviceWorker" in navigator && !navigator.serviceWorker.controller) {
        navigator.serviceWorker.register("../sw.js").then(function (reg) {
          console.log(
            "Service worker has been registered for scope: " + reg.scope
          );
        });
      }
    </script> -->
    <nav
      class="navbar navbar-expand-sm navbar-dark bg-dark fixed-top justify-content-between"
    >
      <button
        id="btn"
        class="navbar-toggler collapsed"
        type="button"
        data-toggle="collapse"
        data-target="#nav-sidebar"
        aria-controls="nav-sidebar"
        aria-expanded="false"
        aria-label="Toggle navigation"
        title="navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <span class="toolt"
        >Legend<span class="toolttext">
          <div class="title-text-ALSO">
      <span class="title-text-ALSO">Color highlighting:</span><br />
    </div>
    <div class="title-text-OTHEREDITIONS">
      <span class="title-text-OTHEREDITIONS">
        <span style="color:black">Unchanged █</span>
      </span>
    </div>
    <div class="title-text-OTHEREDITIONS">
      <span class="title-text-OTHEREDITIONS">
        <span style="color:green">Scheme █</span>
      </span>
    </div>
    <div class="title-text-OTHEREDITIONS">
      <span class="title-text-OTHEREDITIONS">
        <span style="color:blue">Javascript █</span>
      </span>
    </div>
    <div class="title-text-OTHEREDITIONS">
      <span class="title-text-OTHEREDITIONS">
        <span style="color:grey">Explanation █</span>
      </span>
    </div>
    <div class="title-text-OTHEREDITIONS">
      <span class="title-text-OTHEREDITIONS">
        <span style="color:red">Web-only █</span>
      </span>
    </div>
        </span></span
      >
    </nav><span class="navbar-brand-short"
        ><a
          title="Go back to front page"
          href="../index.html"
          class="gray"
          >SICP &mdash; Scheme/JS</a
        ></span
      >
      <span class="navbar-brand-long"
        ><a
          title="Go back to front page"
          href="../index.html"
          class="gray"
          >Structure and Interpretation of Computer Programs &mdash; Comparison Edition</a
        ></span
      ><div class="container scroll">
        <div class="collapse" id="nav-sidebar" role="tablist" aria-multiselectable="true">
        <!-- insert a dummy entry, to give one extra line of space -->
        <a class="navbar-brand" href="index.html">&nbsp;</a>
    
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-1">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-1"
                aria-expanded="false"
                aria-controls="sidebar-collapse-1"
              >
                <a href="./foreword02.html">
                  
        <span style="color:blue">Foreword</span>
    </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-2">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-2"
                aria-expanded="false"
                aria-controls="sidebar-collapse-2"
              >
                <a href="./foreword84.html">
                  Foreword <span style="color:blue">to Structure and Interpretation of Computer Programs, 1984</span></a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-3">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-3"
                aria-expanded="false"
                aria-controls="sidebar-collapse-3"
              >
                <a href="./prefaces03.html">
                  
    
      <span style="color:blue">Preface</span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-4">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-4"
                aria-expanded="false"
                aria-controls="sidebar-collapse-4"
              >
                <a href="./prefaces96.html">
                  
    Prefaces
    
      <span style="color:blue">
	to Structure and Interpretation of Computer Programs, 1996<span style='color:blue'> & </span>1984
      </span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-5">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-5"
                aria-expanded="false"
                aria-controls="sidebar-collapse-5"
              >
                <a href="./acknowledgements.html">
                  Acknowledgments</a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-6">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-6"
                aria-expanded="false"
                aria-controls="sidebar-collapse-6"
              >
                <a href="./see.html">
                  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-7">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-7"
        aria-expanded="true"
        aria-controls="sidebar-collapse-7"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-7"
        aria-expanded="true"
        aria-controls="sidebar-collapse-7"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./1.html"
        >1 
    Building Abstractions with 
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
  </a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-7" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-8">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-8"
        aria-expanded="true"
        aria-controls="sidebar-collapse-8"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-8"
        aria-expanded="true"
        aria-controls="sidebar-collapse-8"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./1.1.html"
        >1.1 The Elements of Programming</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-8" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-9">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-9"
                aria-expanded="false"
                aria-controls="sidebar-collapse-9"
              >
                <a href="./1.1.1.html">
                  1.1.1 Expressions</a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-10">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-10"
                aria-expanded="false"
                aria-controls="sidebar-collapse-10"
              >
                <a href="./1.1.2.html">
                  1.1.2 Naming and the Environment</a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-11">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-11"
                aria-expanded="false"
                aria-controls="sidebar-collapse-11"
              >
                <a href="./1.1.3.html">
                  1.1.3 
    Evaluating
    
      <span style="color:green">Combinations</span>
      <span style="color:blue">Operator Combinations</span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-12">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-12"
                aria-expanded="false"
                aria-controls="sidebar-collapse-12"
              >
                <a href="./1.1.4.html">
                  1.1.4 
    Compound <span style="color:green">Procedures</span>
    <span style="color:blue">Functions</span>
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-13">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-13"
                aria-expanded="false"
                aria-controls="sidebar-collapse-13"
              >
                <a href="./1.1.5.html">
                  1.1.5 
    The Substitution Model for 
    
      <span style="color:green">
        Procedure
      </span>
      <span style="color:blue">
        Function
      </span>
    
    Application
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-14">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-14"
                aria-expanded="false"
                aria-controls="sidebar-collapse-14"
              >
                <a href="./1.1.6.html">
                  1.1.6 
    Conditional Expressions and Predicates
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-15">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-15"
                aria-expanded="false"
                aria-controls="sidebar-collapse-15"
              >
                <a href="./1.1.7.html">
                  1.1.7 Example: Square Roots by Newton's Method</a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-16">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-16"
                aria-expanded="false"
                aria-controls="sidebar-collapse-16"
              >
                <a href="./1.1.8.html">
                  1.1.8 
    
      <span style="color:green">
        Procedures
      </span>
      <span style="color:blue">
        Functions
      </span>
    
    as Black-Box Abstractions
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-17">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-17"
        aria-expanded="true"
        aria-controls="sidebar-collapse-17"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-17"
        aria-expanded="true"
        aria-controls="sidebar-collapse-17"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./1.2.html"
        >1.2 
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
    and the Processes They Generate
  </a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-17" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-18">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-18"
                aria-expanded="false"
                aria-controls="sidebar-collapse-18"
              >
                <a href="./1.2.1.html">
                  1.2.1 Linear Recursion and Iteration</a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-19">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-19"
                aria-expanded="false"
                aria-controls="sidebar-collapse-19"
              >
                <a href="./1.2.2.html">
                  1.2.2 Tree Recursion</a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-20">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-20"
                aria-expanded="false"
                aria-controls="sidebar-collapse-20"
              >
                <a href="./1.2.3.html">
                  1.2.3 Orders of Growth</a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-21">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-21"
                aria-expanded="false"
                aria-controls="sidebar-collapse-21"
              >
                <a href="./1.2.4.html">
                  1.2.4 Exponentiation</a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-22">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-22"
                aria-expanded="false"
                aria-controls="sidebar-collapse-22"
              >
                <a href="./1.2.5.html">
                  1.2.5 Greatest Common Divisors</a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-23">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-23"
                aria-expanded="false"
                aria-controls="sidebar-collapse-23"
              >
                <a href="./1.2.6.html">
                  1.2.6 Example: Testing for Primality</a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-24">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-24"
        aria-expanded="true"
        aria-controls="sidebar-collapse-24"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-24"
        aria-expanded="true"
        aria-controls="sidebar-collapse-24"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./1.3.html"
        >1.3 
        Formulating Abstractions with Higher-Order 
        
	  <span style="color:green">Procedures</span>
	  <span style="color:blue">Functions</span>
	
      </a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-24" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-25">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-25"
                aria-expanded="false"
                aria-controls="sidebar-collapse-25"
              >
                <a href="./1.3.1.html">
                  1.3.1 
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
    as Arguments
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-26">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-26"
                aria-expanded="false"
                aria-controls="sidebar-collapse-26"
              >
                <a href="./1.3.2.html">
                  1.3.2 
    
      <span style="color:green">Constructing Procedures using Lambda</span>
      <span style="color:blue">Constructing Functions using Lambda Expressions
      </span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-27">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-27"
                aria-expanded="false"
                aria-controls="sidebar-collapse-27"
              >
                <a href="./1.3.3.html">
                  1.3.3 
    
      <span style="color:green">Procedures</span>
    <span style="color:blue">Functions</span>
    as General Methods
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-28">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-28"
                aria-expanded="false"
                aria-controls="sidebar-collapse-28"
              >
                <a href="./1.3.4.html">
                  1.3.4 
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
    as Returned Values
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-29">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-29"
        aria-expanded="true"
        aria-controls="sidebar-collapse-29"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-29"
        aria-expanded="true"
        aria-controls="sidebar-collapse-29"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./2.html"
        >2 Building Abstractions with Data</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-29" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-30">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-30"
        aria-expanded="true"
        aria-controls="sidebar-collapse-30"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-30"
        aria-expanded="true"
        aria-controls="sidebar-collapse-30"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./2.1.html"
        >2.1 Introduction to Data Abstraction</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-30" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-31">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-31"
                aria-expanded="false"
                aria-controls="sidebar-collapse-31"
              >
                <a href="./2.1.1.html">
                  2.1.1 
    Example: Arithmetic Operations for Rational Numbers
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-32">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-32"
                aria-expanded="false"
                aria-controls="sidebar-collapse-32"
              >
                <a href="./2.1.2.html">
                  2.1.2 
    Abstraction Barriers
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-33">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-33"
                aria-expanded="false"
                aria-controls="sidebar-collapse-33"
              >
                <a href="./2.1.3.html">
                  2.1.3 
    What Is Meant by Data?
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-34">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-34"
                aria-expanded="false"
                aria-controls="sidebar-collapse-34"
              >
                <a href="./2.1.4.html">
                  2.1.4 
    Extended Exercise: Interval Arithmetic
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-35">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-35"
        aria-expanded="true"
        aria-controls="sidebar-collapse-35"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-35"
        aria-expanded="true"
        aria-controls="sidebar-collapse-35"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./2.2.html"
        >2.2 Hierarchical Data and the Closure Property</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-35" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-36">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-36"
                aria-expanded="false"
                aria-controls="sidebar-collapse-36"
              >
                <a href="./2.2.1.html">
                  2.2.1 
    Representing Sequences
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-37">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-37"
                aria-expanded="false"
                aria-controls="sidebar-collapse-37"
              >
                <a href="./2.2.2.html">
                  2.2.2 
    Hierarchical Structures
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-38">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-38"
                aria-expanded="false"
                aria-controls="sidebar-collapse-38"
              >
                <a href="./2.2.3.html">
                  2.2.3 
    Sequences as Conventional Interfaces
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-39">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-39"
                aria-expanded="false"
                aria-controls="sidebar-collapse-39"
              >
                <a href="./2.2.4.html">
                  2.2.4 
    Example: A Picture Language
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-40">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-40"
        aria-expanded="true"
        aria-controls="sidebar-collapse-40"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-40"
        aria-expanded="true"
        aria-controls="sidebar-collapse-40"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./2.3.html"
        >2.3 Symbolic Data</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-40" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-41">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-41"
                aria-expanded="false"
                aria-controls="sidebar-collapse-41"
              >
                <a href="./2.3.1.html">
                  2.3.1 
    
      <span style="color:green">Quotation</span>
      <span style="color:blue">Strings</span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-42">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-42"
                aria-expanded="false"
                aria-controls="sidebar-collapse-42"
              >
                <a href="./2.3.2.html">
                  2.3.2 
    Example: Symbolic Differentiation
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-43">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-43"
                aria-expanded="false"
                aria-controls="sidebar-collapse-43"
              >
                <a href="./2.3.3.html">
                  2.3.3 
    Example: Representing Sets
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-44">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-44"
                aria-expanded="false"
                aria-controls="sidebar-collapse-44"
              >
                <a href="./2.3.4.html">
                  2.3.4 
    Example: Huffman Encoding Trees
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-45">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-45"
        aria-expanded="true"
        aria-controls="sidebar-collapse-45"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-45"
        aria-expanded="true"
        aria-controls="sidebar-collapse-45"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./2.4.html"
        >2.4 Multiple Representations for Abstract Data</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-45" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-46">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-46"
                aria-expanded="false"
                aria-controls="sidebar-collapse-46"
              >
                <a href="./2.4.1.html">
                  2.4.1 
    Representations for Complex Numbers
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-47">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-47"
                aria-expanded="false"
                aria-controls="sidebar-collapse-47"
              >
                <a href="./2.4.2.html">
                  2.4.2 
    Tagged data
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-48">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-48"
                aria-expanded="false"
                aria-controls="sidebar-collapse-48"
              >
                <a href="./2.4.3.html">
                  2.4.3 
    Data-Directed Programming and Additivity
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-49">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-49"
        aria-expanded="true"
        aria-controls="sidebar-collapse-49"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-49"
        aria-expanded="true"
        aria-controls="sidebar-collapse-49"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./2.5.html"
        >2.5 Systems with Generic Operations</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-49" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-50">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-50"
                aria-expanded="false"
                aria-controls="sidebar-collapse-50"
              >
                <a href="./2.5.1.html">
                  2.5.1 
    Generic Arithmetic Operations
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-51">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-51"
                aria-expanded="false"
                aria-controls="sidebar-collapse-51"
              >
                <a href="./2.5.2.html">
                  2.5.2 
    Combining Data of Different Types
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-52">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-52"
                aria-expanded="false"
                aria-controls="sidebar-collapse-52"
              >
                <a href="./2.5.3.html">
                  2.5.3 
    Example: Symbolic Algebra
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-53">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-53"
        aria-expanded="true"
        aria-controls="sidebar-collapse-53"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-53"
        aria-expanded="true"
        aria-controls="sidebar-collapse-53"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./3.html"
        >3 Modularity, Objects, and State</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-53" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-54">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-54"
        aria-expanded="true"
        aria-controls="sidebar-collapse-54"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-54"
        aria-expanded="true"
        aria-controls="sidebar-collapse-54"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./3.1.html"
        >3.1 Assignment and Local State</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-54" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-55">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-55"
                aria-expanded="false"
                aria-controls="sidebar-collapse-55"
              >
                <a href="./3.1.1.html">
                  3.1.1 
    Local State Variables
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-56">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-56"
                aria-expanded="false"
                aria-controls="sidebar-collapse-56"
              >
                <a href="./3.1.2.html">
                  3.1.2 
    The Benefits of Introducing Assignment
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-57">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-57"
                aria-expanded="false"
                aria-controls="sidebar-collapse-57"
              >
                <a href="./3.1.3.html">
                  3.1.3 
    The Costs of Introducing Assignment
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-58">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-58"
        aria-expanded="true"
        aria-controls="sidebar-collapse-58"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-58"
        aria-expanded="true"
        aria-controls="sidebar-collapse-58"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./3.2.html"
        >3.2 The Environment Model of Evaluation</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-58" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-59">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-59"
                aria-expanded="false"
                aria-controls="sidebar-collapse-59"
              >
                <a href="./3.2.1.html">
                  3.2.1 
    The Rules for Evaluation
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-60">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-60"
                aria-expanded="false"
                aria-controls="sidebar-collapse-60"
              >
                <a href="./3.2.2.html">
                  3.2.2 
    Applying Simple
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-61">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-61"
                aria-expanded="false"
                aria-controls="sidebar-collapse-61"
              >
                <a href="./3.2.3.html">
                  3.2.3 
    Frames as the Repository of Local State
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-62">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-62"
                aria-expanded="false"
                aria-controls="sidebar-collapse-62"
              >
                <a href="./3.2.4.html">
                  3.2.4 
    Internal
    
      <span style="color:green">Definitions</span>
      <span style="color:blue">Declarations</span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-63">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-63"
                aria-expanded="false"
                aria-controls="sidebar-collapse-63"
              >
                <a href="./3.2.5.html">
                  3.2.5 
    CSE Machine
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-64">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-64"
        aria-expanded="true"
        aria-controls="sidebar-collapse-64"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-64"
        aria-expanded="true"
        aria-controls="sidebar-collapse-64"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./3.3.html"
        >3.3 Modeling with Mutable Data</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-64" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-65">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-65"
                aria-expanded="false"
                aria-controls="sidebar-collapse-65"
              >
                <a href="./3.3.1.html">
                  3.3.1 
    Mutable List Structure
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-66">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-66"
                aria-expanded="false"
                aria-controls="sidebar-collapse-66"
              >
                <a href="./3.3.2.html">
                  3.3.2 
    Representing Queues
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-67">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-67"
                aria-expanded="false"
                aria-controls="sidebar-collapse-67"
              >
                <a href="./3.3.3.html">
                  3.3.3 
    Representing Tables
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-68">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-68"
                aria-expanded="false"
                aria-controls="sidebar-collapse-68"
              >
                <a href="./3.3.4.html">
                  3.3.4 
    A Simulator for Digital Circuits
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-69">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-69"
                aria-expanded="false"
                aria-controls="sidebar-collapse-69"
              >
                <a href="./3.3.5.html">
                  3.3.5 
    Propagation of Constraints
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-70">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-70"
        aria-expanded="true"
        aria-controls="sidebar-collapse-70"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-70"
        aria-expanded="true"
        aria-controls="sidebar-collapse-70"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./3.4.html"
        >3.4 Concurrency: Time Is of the Essence</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-70" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-71">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-71"
                aria-expanded="false"
                aria-controls="sidebar-collapse-71"
              >
                <a href="./3.4.1.html">
                  3.4.1 
    The Nature of Time in Concurrent Systems
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-72">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-72"
                aria-expanded="false"
                aria-controls="sidebar-collapse-72"
              >
                <a href="./3.4.2.html">
                  3.4.2 
    Mechanisms for Controlling Concurrency
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-73">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-73"
        aria-expanded="true"
        aria-controls="sidebar-collapse-73"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-73"
        aria-expanded="true"
        aria-controls="sidebar-collapse-73"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./3.5.html"
        >3.5 Streams</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-73" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-74">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-74"
                aria-expanded="false"
                aria-controls="sidebar-collapse-74"
              >
                <a href="./3.5.1.html">
                  3.5.1 
    Streams Are Delayed Lists
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-75">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-75"
                aria-expanded="false"
                aria-controls="sidebar-collapse-75"
              >
                <a href="./3.5.2.html">
                  3.5.2 
    Infinite Streams
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-76">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-76"
                aria-expanded="false"
                aria-controls="sidebar-collapse-76"
              >
                <a href="./3.5.3.html">
                  3.5.3 
    Exploiting the Stream Paradigm
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-77">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-77"
                aria-expanded="false"
                aria-controls="sidebar-collapse-77"
              >
                <a href="./3.5.4.html">
                  3.5.4 
    Streams and Delayed Evaluation
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-78">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-78"
                aria-expanded="false"
                aria-controls="sidebar-collapse-78"
              >
                <a href="./3.5.5.html">
                  3.5.5 
    Modularity of Functional Programs and Modularity of Objects
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-79">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-79"
        aria-expanded="true"
        aria-controls="sidebar-collapse-79"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-79"
        aria-expanded="true"
        aria-controls="sidebar-collapse-79"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./4.html"
        >4 Metalinguistic Abstraction</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-79" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-80">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-80"
        aria-expanded="true"
        aria-controls="sidebar-collapse-80"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-80"
        aria-expanded="true"
        aria-controls="sidebar-collapse-80"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./4.1.html"
        >4.1 The Metacircular Evaluator</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-80" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-81">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-81"
                aria-expanded="false"
                aria-controls="sidebar-collapse-81"
              >
                <a href="./4.1.1.html">
                  4.1.1 
    The Core of the Evaluator
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-82">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-82"
                aria-expanded="false"
                aria-controls="sidebar-collapse-82"
              >
                <a href="./4.1.2.html">
                  4.1.2 
    Representing
    
      <span style="color:green">Expressions</span>
      <span style="color:blue">Components</span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-83">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-83"
                aria-expanded="false"
                aria-controls="sidebar-collapse-83"
              >
                <a href="./4.1.3.html">
                  4.1.3 
    Evaluator Data Structures
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-84">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-84"
                aria-expanded="false"
                aria-controls="sidebar-collapse-84"
              >
                <a href="./4.1.4.html">
                  4.1.4 
    Running the Evaluator as a Program
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-85">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-85"
                aria-expanded="false"
                aria-controls="sidebar-collapse-85"
              >
                <a href="./4.1.5.html">
                  4.1.5 
    Data as Programs
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-86">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-86"
                aria-expanded="false"
                aria-controls="sidebar-collapse-86"
              >
                <a href="./4.1.6.html">
                  4.1.6 
    Internal
    
      <span style="color:green">Definitions</span>
      <span style="color:blue">Declarations</span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-87">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-87"
                aria-expanded="false"
                aria-controls="sidebar-collapse-87"
              >
                <a href="./4.1.7.html">
                  4.1.7 
    Separating Syntactic Analysis from Execution
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-88">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-88"
        aria-expanded="true"
        aria-controls="sidebar-collapse-88"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-88"
        aria-expanded="true"
        aria-controls="sidebar-collapse-88"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./4.2.html"
        >4.2 
    
      <span style="color:green">Variations on a Scheme:</span>
    
    Lazy Evaluation
</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-88" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-89">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-89"
                aria-expanded="false"
                aria-controls="sidebar-collapse-89"
              >
                <a href="./4.2.1.html">
                  4.2.1 
    Normal Order and Applicative Order
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-90">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-90"
                aria-expanded="false"
                aria-controls="sidebar-collapse-90"
              >
                <a href="./4.2.2.html">
                  4.2.2 
    An Interpreter with Lazy Evaluation
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-91">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-91"
                aria-expanded="false"
                aria-controls="sidebar-collapse-91"
              >
                <a href="./4.2.3.html">
                  4.2.3 
    Streams as Lazy Lists
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-92">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-92"
        aria-expanded="true"
        aria-controls="sidebar-collapse-92"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-92"
        aria-expanded="true"
        aria-controls="sidebar-collapse-92"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./4.3.html"
        >4.3 
    
      <span style="color:green">Variations on a Scheme:</span>
    
    Nondeterministic Computing
  </a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-92" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-93">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-93"
                aria-expanded="false"
                aria-controls="sidebar-collapse-93"
              >
                <a href="./4.3.1.html">
                  4.3.1 
    
      <span style="color:green">Amb and Search</span>
      <span style="color:blue">Search and amb</span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-94">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-94"
                aria-expanded="false"
                aria-controls="sidebar-collapse-94"
              >
                <a href="./4.3.2.html">
                  4.3.2 
    Examples of Nondeterministic Programs
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-95">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-95"
                aria-expanded="false"
                aria-controls="sidebar-collapse-95"
              >
                <a href="./4.3.3.html">
                  4.3.3 
    Implementing the
    
      <span style="color:green">Amb</span>
      <span style="color:blue">amb</span>
    
    Evaluator
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-96">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-96"
        aria-expanded="true"
        aria-controls="sidebar-collapse-96"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-96"
        aria-expanded="true"
        aria-controls="sidebar-collapse-96"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./4.4.html"
        >4.4 Logic Programming</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-96" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-97">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-97"
                aria-expanded="false"
                aria-controls="sidebar-collapse-97"
              >
                <a href="./4.4.1.html">
                  4.4.1 
    Deductive Information Retrieval
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-98">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-98"
                aria-expanded="false"
                aria-controls="sidebar-collapse-98"
              >
                <a href="./4.4.2.html">
                  4.4.2 
    How the Query System Works
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-99">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-99"
                aria-expanded="false"
                aria-controls="sidebar-collapse-99"
              >
                <a href="./4.4.3.html">
                  4.4.3 
    Is Logic Programming Mathematical Logic?
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-100">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-100"
                aria-expanded="false"
                aria-controls="sidebar-collapse-100"
              >
                <a href="./4.4.4.html">
                  4.4.4 
    Implementing the Query System
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-101">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-101"
        aria-expanded="true"
        aria-controls="sidebar-collapse-101"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-101"
        aria-expanded="true"
        aria-controls="sidebar-collapse-101"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./5.html"
        >5 Computing with Register Machines</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-101" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-102">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-102"
        aria-expanded="true"
        aria-controls="sidebar-collapse-102"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-102"
        aria-expanded="true"
        aria-controls="sidebar-collapse-102"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./5.1.html"
        >5.1 Designing Register Machines</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-102" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-103">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-103"
                aria-expanded="false"
                aria-controls="sidebar-collapse-103"
              >
                <a href="./5.1.1.html">
                  5.1.1 
    A Language for Describing Register Machines
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-104">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-104"
                aria-expanded="false"
                aria-controls="sidebar-collapse-104"
              >
                <a href="./5.1.2.html">
                  5.1.2 
    Abstraction in Machine Design
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-105">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-105"
                aria-expanded="false"
                aria-controls="sidebar-collapse-105"
              >
                <a href="./5.1.3.html">
                  5.1.3 
    Subroutines
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-106">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-106"
                aria-expanded="false"
                aria-controls="sidebar-collapse-106"
              >
                <a href="./5.1.4.html">
                  5.1.4 
    Using a Stack to Implement Recursion
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-107">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-107"
                aria-expanded="false"
                aria-controls="sidebar-collapse-107"
              >
                <a href="./5.1.5.html">
                  5.1.5 
    Instruction Summary
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-108">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-108"
        aria-expanded="true"
        aria-controls="sidebar-collapse-108"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-108"
        aria-expanded="true"
        aria-controls="sidebar-collapse-108"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./5.2.html"
        >5.2 A Register-Machine Simulator</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-108" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-109">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-109"
                aria-expanded="false"
                aria-controls="sidebar-collapse-109"
              >
                <a href="./5.2.1.html">
                  5.2.1 
    The Machine Model
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-110">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-110"
                aria-expanded="false"
                aria-controls="sidebar-collapse-110"
              >
                <a href="./5.2.2.html">
                  5.2.2 
    The Assembler
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-111">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-111"
                aria-expanded="false"
                aria-controls="sidebar-collapse-111"
              >
                <a href="./5.2.3.html">
                  5.2.3 
    
      <span style="color:green">Generating Execution Procedures for Instructions</span>
      <span style="color:blue">Instructions and Their Execution Functions</span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-112">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-112"
                aria-expanded="false"
                aria-controls="sidebar-collapse-112"
              >
                <a href="./5.2.4.html">
                  5.2.4 
    Monitoring Machine Performance
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-113">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-113"
        aria-expanded="true"
        aria-controls="sidebar-collapse-113"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-113"
        aria-expanded="true"
        aria-controls="sidebar-collapse-113"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./5.3.html"
        >5.3 Storage Allocation and Garbage Collection</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-113" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-114">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-114"
                aria-expanded="false"
                aria-controls="sidebar-collapse-114"
              >
                <a href="./5.3.1.html">
                  5.3.1 
    Memory as Vectors
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-115">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-115"
                aria-expanded="false"
                aria-controls="sidebar-collapse-115"
              >
                <a href="./5.3.2.html">
                  5.3.2 
    Maintaining the Illusion of Infinite Memory
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-116">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-116"
        aria-expanded="true"
        aria-controls="sidebar-collapse-116"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-116"
        aria-expanded="true"
        aria-controls="sidebar-collapse-116"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./5.4.html"
        >5.4 The Explicit-Control Evaluator</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-116" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-117">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-117"
                aria-expanded="false"
                aria-controls="sidebar-collapse-117"
              >
                <a href="./5.4.1.html">
                  5.4.1 
    
      <span style="color:green">The Core of the Explicit-Control Evaluator</span>
      <span style="color:blue">The Dispatcher and Basic Evaluation</span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-118">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-118"
                aria-expanded="false"
                aria-controls="sidebar-collapse-118"
              >
                <a href="./5.4.2.html">
                  5.4.2 
    
      <span style="color:green">
        Sequence Evaluation and Tail Recursion
      </span>
      <span style="color:blue">
        Evaluating Function Applications
      </span>
        
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-119">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-119"
                aria-expanded="false"
                aria-controls="sidebar-collapse-119"
              >
                <a href="./5.4.3.html">
                  5.4.3 
    
      <span style="color:green">
        Conditionals, Assignments and Definitions
      </span>
      <span style="color:blue">
        Blocks, Assignments, and Declarations
      </span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-120">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-120"
                aria-expanded="false"
                aria-controls="sidebar-collapse-120"
              >
                <a href="./5.4.4.html">
                  5.4.4 
    Running the Evaluator
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
            <div class="card-header" role="tab" id="sidebar-121">
    <h5 class="mb-0">
      <a
        class="sidebar-show collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-121"
        aria-expanded="true"
        aria-controls="sidebar-collapse-121"
      >
        &#10148;
        <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
      </a>
      <a
        class="sidebar-hide collapsed"
        data-toggle="collapse"
        href="#sidebar-collapse-121"
        aria-expanded="true"
        aria-controls="sidebar-collapse-121"
      >
        &#x25BC;
        <!-- ▼ (because the corresponding one is not rendered) -->
      </a>
      <a href="./5.5.html"
        >5.5 Compilation</a
      >
    </h5>
  </div>

              <div id="sidebar-collapse-121" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-122">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-122"
                aria-expanded="false"
                aria-controls="sidebar-collapse-122"
              >
                <a href="./5.5.1.html">
                  5.5.1 
    Structure of the Compiler
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-123">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-123"
                aria-expanded="false"
                aria-controls="sidebar-collapse-123"
              >
                <a href="./5.5.2.html">
                  5.5.2 
    Compiling
    
      <span style="color:green">Expressions</span>
      <span style="color:blue">Components</span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-124">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-124"
                aria-expanded="false"
                aria-controls="sidebar-collapse-124"
              >
                <a href="./5.5.3.html">
                  5.5.3 
    Compiling
    
      <span style="color:green">
	Combinations
      </span>
      <span style="color:blue">
	Applications and Return Statements
      </span>
    
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-125">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-125"
                aria-expanded="false"
                aria-controls="sidebar-collapse-125"
              >
                <a href="./5.5.4.html">
                  5.5.4 
    Combining Instruction Sequences
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-126">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-126"
                aria-expanded="false"
                aria-controls="sidebar-collapse-126"
              >
                <a href="./5.5.5.html">
                  5.5.5 
    An Example of Compiled Code
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-127">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-127"
                aria-expanded="false"
                aria-controls="sidebar-collapse-127"
              >
                <a href="./5.5.6.html">
                  5.5.6 
    Lexical Addressing
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-128">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-128"
                aria-expanded="false"
                aria-controls="sidebar-collapse-128"
              >
                <a href="./5.5.7.html">
                  5.5.7 
    Interfacing Compiled Code to the Evaluator
  </a
                >
              </span>
            </h5>
          </div>
        </div>
      
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-129">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-129"
                aria-expanded="false"
                aria-controls="sidebar-collapse-129"
              >
                <a href="./references.html">
                  References</a
                >
              </span>
            </h5>
          </div>
        </div>
      
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-130">
            <h5 class="mb-0">
              <span
                class="collapsed"
                data-toggle="collapse"
                href="#sidebar-collapse-130"
                aria-expanded="false"
                aria-controls="sidebar-collapse-130"
              >
                <a href="./making-of.html">
                  <span class='webonly'>About the SICP JS Project</span></a
                >
              </span>
            </h5>
          </div>
        </div>
      </div>
<div id='permalink-msg'>
<div class='screen'>
  <div class='alert alert-success'>
    <strong>Permalink copied!</strong>
  </div>
</div>
</div>
<div class='chapter-content'>

      <div class='chapter-title'>
        <div class='permalink'>
        <a name='top' class='permalink'>
    4.3.3&nbsp;&nbsp;
    Implementing the
    
      <span style="color:green">Amb</span>
      <span style="color:blue">amb</span>
    
    Evaluator
  
        </a>
        </div>
      </div>
      <div class='chapter-text'>
        <div class='SECTION'>
    

  

  

  <div class='permalink'>
<a name='p1' class='permalink'></a><p>
    The evaluation of an ordinary
    
      <span style="color:green">Scheme expression</span>
      <span style="color:blue">JavaScript program</span>
    
    may return a value, may never terminate, or may signal an error.
    In nondeterministic
    
      <span style="color:green">Scheme</span>
      <span style="color:blue">JavaScript</span>
    
    the evaluation of
    
      <span style="color:green">an expression</span>
      <span style="color:blue">a program</span>
    
    may in addition result in the discovery of
    a dead end, in which case evaluation must backtrack to a previous choice
    point.  The interpretation of nondeterministic
    
      <span style="color:green">Scheme</span>
      <span style="color:blue">JavaScript</span>
    
    is complicated by this extra case.
  </p></div>

  <div class='permalink'>
<a name='p2' class='permalink'></a><p>
    We will construct the <kbd>amb</kbd> evaluator for
    nondeterministic
    
      <span style="color:green">Scheme</span>
      <span style="color:blue">JavaScript</span>
    
    by modifying the
    
    analyzing evaluator of
    section&nbsp;<REF NAME="sec:separating-analysis"><a class="superscript" id="4.3.3-sec-link-4.1.7" href="./4.1.7.html">4.1.7</a></REF>.<a class='superscript' id='footnote-link-1' href='#footnote-1'>[1]</a> As in the analyzing evaluator, evaluation of
    
      <span style="color:green">an expression</span>
      <span style="color:blue">a component</span>
    
    is accomplished by calling an 
    
    execution
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    produced by analysis of that
    
      <span style="color:green">expression.</span>
      <span style="color:blue">component.</span>
    
    The difference between the interpretation of ordinary
    
      <span style="color:green">Scheme</span>
      <span style="color:blue">JavaScript</span>
    
    and the interpretation of nondeterministic
    
      <span style="color:green">Scheme</span>
      <span style="color:blue">JavaScript</span>
    
    will be entirely
    in the execution
    
      <span style="color:green">procedures.</span>
      <span style="color:blue">functions.</span>
    
  </p></div>

  
      <div class='permalink'>
        <a name='h1' class='permalink'></a><h2>
    
    
      Execution
      
	<span style="color:green">procedures</span>
	<span style="color:blue">functions</span>
      
      and continuations
    
  </h2></div>

  

  <div class='permalink'>
<a name='p3' class='permalink'></a><p>
    Recall that the
    
    execution
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    for the ordinary evaluator take one argument: the environment of execution.
    In contrast, the execution
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    in the <kbd>amb</kbd> evaluator take three arguments:
    the environment, and two
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    called
    
      <span style="color:green"><EM>continuation procedures</EM>.</span>
      <span style="color:blue"><EM>continuation functions</EM>.</span>
    
    The evaluation of
    
      <span style="color:green">an expression</span>
      <span style="color:blue">a component</span>
    
    will finish by calling one of these two
    continuations: If the evaluation results in a value, the 
    
    <EM>success continuation</EM> is called with that value; if the evaluation
    results in the discovery of a dead end, the 
    
    <EM>failure continuation</EM> is called.  Constructing and calling
    appropriate continuations is the mechanism by which the nondeterministic
    evaluator implements backtracking.
  </p></div>

  <div class='permalink'>
<a name='p4' class='permalink'></a><p>
    It is the job of the success continuation to receive a value and proceed
    with the computation.  Along with that value, the success continuation is
    passed another failure continuation, which is to be called subsequently if
    the use of that value leads to a dead end.
  </p></div>

  <div class='permalink'>
<a name='p5' class='permalink'></a><p>
    It is the job of the failure continuation to try another branch of the
    nondeterministic process.  The essence of the nondeterministic
    language is in the fact that
    
      <span style="color:green">expressions</span>
      <span style="color:blue">components</span>
    
    may represent choices among
    alternatives.  The evaluation of such
    
      <span style="color:green">an expression</span>
      <span style="color:blue">a component</span>
    
    must proceed with
    one of the indicated alternative choices, even though it is not known
    in advance which choices will lead to acceptable results.  To deal
    with this, the evaluator picks one of the alternatives and passes this
    value to the success continuation.  Together with this value, the
    evaluator constructs and passes along a failure continuation that can
    be called later to choose a different alternative.
  </p></div>

  
  <div class='permalink'>
<a name='p6' class='permalink'></a><p>
    A failure is triggered during evaluation (that is, a failure
    continuation is called) when a user program explicitly rejects the
    current line of attack (for example, a call to
    <kbd>require</kbd> may result in execution of
    
      <span style="color:green"><kbd>(amb)</kbd>,</span>
      <span style="color:blue"><kbd>amb()</kbd>,</span>
    
    an expression that always
    fails—see section&nbsp;<REF NAME="sec:amb"><a class="superscript" id="4.3.3-sec-link-4.3.1" href="./4.3.1.html">4.3.1</a></REF>).  The failure
    continuation in hand at that point will cause the most recent choice point
    to choose another alternative.  If there are no more alternatives to be
    considered at that choice point, a failure at an earlier choice point
    is triggered, and so on.  Failure continuations are also invoked by
    the driver loop in response to a
    
      <span style="color:green"><kbd>try-again</kbd></span>
      <span style="color:blue">
	<kbd>retry</kbd>
      </span>
    
    request, to find another value of the
    
      <span style="color:green">expression.</span>
      <span style="color:blue">program.</span>
    
  </p></div>

  <div class='permalink'>
<a name='p7' class='permalink'></a><p>
    In addition, if a side-effect operation (such as assignment to a
    variable) occurs on a branch of the process resulting from a choice,
    it may be necessary, when the process finds a dead end, to undo the
    side effect before making a new choice.  This is accomplished by
    having the side-effect operation produce a failure continuation that
    undoes the side effect and propagates the failure.
  </p></div>

  <div class='permalink'>
<a name='p8' class='permalink'></a><p>
    In summary, failure continuations are constructed by
    <UL>
      <LI>
	<kbd>amb</kbd> expressions—to provide a
	mechanism to make alternative choices if the current choice made by the
	<kbd>amb</kbd> expression leads to a dead end;
      </LI>
      <LI>
	the top-level driver—to provide a mechanism to report failure
	when the choices are exhausted;
      </LI>
      <LI>
	assignments—to intercept failures and undo assignments
	during backtracking.
      </LI>
    </UL>
  </p></div>

  <div class='permalink'>
<a name='p9' class='permalink'></a><p>
    Failures are initiated only when a dead end is encountered. This occurs
    <UL>
      <LI>
	if the user program executes
	
	  <span style="color:green"><kbd>(amb)</kbd>;</span>
	  <span style="color:blue"><kbd>amb()</kbd>;</span>
	  
      </LI>
      <LI>
	if the user types
	
	  <span style="color:green">
	    <kbd>try-again</kbd>
	  </span>
	  <span style="color:blue">
	    <kbd>retry</kbd>
	  </span>
	
	at the top-level driver.
      </LI>

    </UL>
  </p></div>

  <div class='permalink'>
<a name='p10' class='permalink'></a><p>
    Failure continuations are also called during processing of a failure:
    <UL>
      <LI>When the failure continuation created by an assignment finishes
      undoing a side effect, it calls the failure continuation it intercepted,
      in order to propagate the failure back to the choice point that
      led to this assignment or to the top level.

      </LI>
      <LI>When the failure continuation for an <kbd>amb</kbd>
      runs out of choices, it calls the failure continuation that was originally
      given to the <kbd>amb</kbd>, in order to propagate the
      failure back to the previous choice point or to the top level.
      </LI>
    </UL>
  </p></div>

  
  
  
      <div class='permalink'>
        <a name='h2' class='permalink'></a><h2>
    
    Structure of the evaluator
  </h2></div>

  <div class='permalink'>
<a name='p11' class='permalink'></a><p>
    The syntax- and data-representation
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    for the <kbd>amb</kbd> evaluator, and also the basic
    
    <kbd>analyze</kbd>
    
      <span style="color:green">procedure,</span>
      <span style="color:blue">function,</span>
    
    are identical to those in the evaluator of
    section&nbsp;<REF NAME="sec:separating-analysis"><a class="superscript" id="4.3.3-sec-link-4.1.7" href="./4.1.7.html">4.1.7</a></REF>, except for the fact
    that we need additional syntax
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    to recognize
    
      <span style="color:green">
	the <kbd>amb</kbd> special
	form:<a class='superscript' id='footnote-link-2' href='#footnote-2'style="color:green">[2]</a>
      </span>
      <span style="color:blue">
	the <kbd>amb</kbd> syntactic form:
      </span>
    
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (amb? exp) (tagged-list? exp 'amb))

(define (amb-choices exp) (cdr exp))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function is_amb(component) {      
    return is_tagged_list(component, "application") && 
           is_name(function_expression(component)) && 
           symbol_of_name(function_expression(component)) === "amb";
}
function amb_choices(component) {
    return arg_expressions(component);
}
      </kbd></span></td></tr></table>
    <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
      </span>    </td>
          <td></td>
          <td><span style="color:blue">

	We continue to use the parse function of
	section&nbsp;<REF NAME="sec:representing-expressions"><a class="superscript" id="4.3.3-sec-link-4.1.2" href="./4.1.2.html">4.1.2</a></REF>, which
	doesn't support <kbd>amb</kbd> as a syntactic
	form and instead treats <kbd>amb(</kbd>$\ldots$<kbd>)</kbd> as
	a function application. The function
	<kbd>is_amb</kbd> ensures that
	whenever the name
	<kbd>amb</kbd> appears as the function
	expression of an application, the evaluator treats the
	<QUOTE>application</QUOTE> as
	a nondeterministic choice point.<a class='superscript' id='footnote-link-3' href='#footnote-3'style="color:blue">[3]</a>
      </span></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p12' class='permalink'></a><p>
    We must also add to the dispatch in <kbd>analyze</kbd> a
    clause that will recognize
    
      <span style="color:green">this special form and generate an appropriate execution procedure:
      </span>
      <span style="color:blue">such expressions and generate an appropriate execution
      function:</span>
    
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
((amb? exp) (analyze-amb exp))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
$\ldots$
: is_amb(component)
? analyze_amb(component)
: is_application(component)
$\ldots$
      </kbd></span></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p13' class='permalink'></a><p>
    The top-level
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    <kbd>ambeval</kbd> (similar to the version of
    
      <span style="color:green"><kbd>eval</kbd></span>
      <span style="color:blue"><kbd>evaluate</kbd></span>
    
    given in section&nbsp;<REF NAME="sec:separating-analysis"><a class="superscript" id="4.3.3-sec-link-4.1.7" href="./4.1.7.html">4.1.7</a></REF>) analyzes the
    given
    
      <span style="color:green">expression</span>
      <span style="color:blue">component</span>
    
    and applies the resulting execution
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    to the given environment, together with two given continuations:
    
    
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (ambeval exp env succeed fail)
  ((analyze exp) env succeed fail))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function ambeval(component, env, succeed, fail) {      
    return analyze(component)(env, succeed, fail);
}
      </kbd></span></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p14' class='permalink'></a><p>
    A success
    
    
    continuation is a
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    of two arguments: the value just obtained and another failure continuation to
    be used if that value leads to a subsequent failure. A
    
    failure continuation
    is a
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    of no arguments.  So 
    the general form of an
    
    execution
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    is
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(lambda (env succeed fail)
  ;; succeed is (lambda (value fail) $\ldots$)
  ;; fail is (lambda () $\ldots$)
  $\ldots$)
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
(env, succeed, fail) => {      
    // $\texttt{succeed}\,$ is $\texttt{(value, fail) =>}~\ldots$
    // $\texttt{fail}\,$ is $\texttt{() =>}~\ldots$
    $\ldots$
}
      </kbd></span></td></tr></table>
  </p></div>
  <div class='permalink'>
<a name='p15' class='permalink'></a><p>
    For example, executing
    <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
	<span style="color:green"><kbd class='snippet'>
(ambeval exp
         the-global-environment
         (lambda (value fail) value)
         (lambda () 'failed))
	  </kbd></span>
      </span>    </td>
          <td></td>
          <td><span style="color:blue">
	<span style="color:blue"><kbd class='snippet'>
ambeval($component$,
        the_global_environment,
        (value, fail) => value,
        () => "failed");
	  </kbd></span>
      </span></td></tr></table>
    will attempt to evaluate the given
    
      <span style="color:green">expression</span>
      <span style="color:blue">component</span>
    
    and will return either the
    
      <span style="color:green">expression's</span>
      <span style="color:blue">component's</span>
    
    value (if the evaluation succeeds) or the
    
      <span style="color:green">
	symbol <kbd>failed</kbd>
      </span>
      <span style="color:blue">
	string <kbd>"failed"</kbd>
      </span>
    
    (if the evaluation fails).
    The call to <kbd>ambeval</kbd> in the driver loop shown
    below uses much more complicated continuation
    
      <span style="color:green">procedures,</span>
      <span style="color:blue">functions,</span>
    
    which continue the loop and support the
    
      <span style="color:green">
	<kbd>try-again</kbd>
      </span>
      <span style="color:blue">
	<kbd>retry</kbd>	
      </span>
    
    request.
  </p></div>

  <div class='permalink'>
<a name='p16' class='permalink'></a><p>
    Most of the complexity of the <kbd>amb</kbd> evaluator
    results from the mechanics of passing the continuations around as the
    execution
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    call each other.  In going through the following code, you should compare
    each of the execution
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    with the corresponding
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    for the ordinary evaluator given in
    section&nbsp;<REF NAME="sec:separating-analysis"><a class="superscript" id="4.3.3-sec-link-4.1.7" href="./4.1.7.html">4.1.7</a></REF>.
  </p></div>

  
      <div class='permalink'>
        <a name='h3' class='permalink'></a><h2>
    
    Simple expressions
  </h2></div>

  
  
  <div class='permalink'>
<a name='p17' class='permalink'></a><p>
    The execution
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    for the simplest kinds of expressions are
    essentially the same as those for the ordinary evaluator, except for the
    need to manage the continuations.  The execution
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    simply succeed with the value of the expression, passing along the failure
    continuation that was passed to them.
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (analyze-self-evaluating exp)
  (lambda (env succeed fail)
    (succeed exp fail)))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function analyze_literal(component) {
    return (env, succeed, fail) =>
             succeed(literal_value(component), fail);
}
      </kbd></span></td></tr></table>
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (analyze-variable exp)
  (lambda (env succeed fail)
    (succeed (lookup-variable-value exp env)
             fail)))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function analyze_name(component) {
    return (env, succeed, fail) =>
             succeed(lookup_symbol_value(symbol_of_name(component),
                                         env),
                     fail);
}
      </kbd></span></td></tr></table>
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (analyze-lambda exp)
  (let ((vars (lambda-parameters exp))
        (bproc (analyze-sequence (lambda-body exp))))
    (lambda (env succeed fail)
      (succeed (make-procedure vars bproc env)
               fail))))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function analyze_lambda_expression(component) {
    const params = lambda_parameter_symbols(component);
    const bfun = analyze(lambda_body(component));
    return (env, succeed, fail) =>
             succeed(make_function(params, bfun, env),
                     fail);
}
      </kbd></span></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p18' class='permalink'></a><p>
    Notice that looking up a
    
      <span style="color:green">variable</span>
      <span style="color:blue">name</span>
    
    always <QUOTE>succeeds.</QUOTE>
    
    If
    
      <span style="color:green">
	<kbd>lookup-variable-value</kbd>
      </span>
      <span style="color:blue">
	<kbd>lookup_symbol_value</kbd>
      </span>
    
    fails to find the
    
      <span style="color:green">variable,</span>
      <span style="color:blue">name,</span>
    
    it signals an
    error, as usual.  Such a <QUOTE>failure</QUOTE> indicates a program
    bug—a reference to an unbound
    
      <span style="color:green">variable;</span>
      <span style="color:blue">name;</span>
    
    it is not an indication
    that we should try another nondeterministic choice instead of the one that
    is currently being tried.
  </p></div>

  
  
      <div class='permalink'>
        <a name='h4' class='permalink'></a><h2>
    
    Conditionals and sequences
  </h2></div>

  <div class='permalink'>
<a name='p19' class='permalink'></a><p>
    Conditionals are also handled in a similar way as in the ordinary
    evaluator.  The execution
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    generated by
    
      <span style="color:green">
	<kbd>analyze-if</kbd>
      </span>
      <span style="color:blue">
	<kbd>analyze_conditional</kbd>
      </span>
    
    invokes the predicate execution
    
      <span style="color:green">procedure
      <kbd>pproc</kbd>
      </span>
      <span style="color:blue">function
      <kbd>pfun</kbd>
      </span>
    
    with a success continuation that checks whether the predicate value is true
    and goes on to execute either the consequent or the alternative.  If the
    execution of
    
      <span style="color:green">
	<kbd>pproc</kbd>
      </span>
      <span style="color:blue">
	<kbd>pfun</kbd>
      </span>
    
    fails, the original failure continuation for
    the
    
      <span style="color:green">
	<kbd>if</kbd>
      </span>
      <span style="color:blue">
	conditional
      </span>
    
    expression is called.
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (analyze-if exp)
  (let ((pproc (analyze (if-predicate exp)))
        (cproc (analyze (if-consequent exp)))
        (aproc (analyze (if-alternative exp))))
   (lambda (env succeed fail)
           (pproc env
                  <EM>;; success continuation for evaluating the predicate</EM>
                  <EM>;; to obtain <kbd>pred-value</kbd></EM>
                  (lambda (pred-value fail2)
                    (if (true? pred-value)
                        (cproc env succeed fail2)
                        (aproc env succeed fail2)))
                  <EM>;; failure continuation for evaluating the predicate</EM>
                  fail))))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function analyze_conditional(component) {      
    const pfun = analyze(conditional_predicate(component));
    const cfun = analyze(conditional_consequent(component));
    const afun = analyze(conditional_alternative(component));
    return (env, succeed, fail) =>
             pfun(env,
                  // success continuation for evaluating the predicate 
                  // to obtain $\texttt{pred\char`_value}$
                  (pred_value, fail2) =>
                    is_truthy(pred_value) 
                    ? cfun(env, succeed, fail2)
                    : afun(env, succeed, fail2),
                  // failure continuation for evaluating the predicate		    
                  fail);
}
      </kbd></span></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p20' class='permalink'></a><p>
    <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
	Sequences are also handled in the same way as in the previous
	evaluator, except for the machinations in the
      subprocedure
	<kbd>sequentially</kbd> that are required for passing the
	continuations. Namely, to sequentially execute <kbd>a</kbd>
	and then <kbd>b</kbd>, we call
	<kbd>a</kbd> with a success continuation that calls
	<kbd>b</kbd>.
	<span style="color:green"><kbd class='snippet'>
	    (define (analyze-sequence exps)
	    (define (sequentially a b)
	    (lambda (env succeed fail)
	    (a env
            ;; success continuation for calling a
            (lambda (a-value fail2)
            (b env succeed fail2))
            ;; failure continuation for calling a
            fail)))
	    (define (loop first-proc rest-procs)
	    (if (null? rest-procs)
            first-proc
            (loop (sequentially first-proc (car rest-procs))
            (cdr rest-procs))))
	    (let ((procs (map analyze exps)))
	    (if (null? procs)
            (error "Empty sequence - - ANALYZE"))
	    (loop (car procs) (cdr procs))))
	  </kbd></span>
      </span>    </td>
          <td></td>
          <td><span style="color:blue">
	Sequences are also handled in the same way as in the previous
	evaluator, except for the machinations in the
	subfunction
	<kbd>sequentially</kbd> that are required for passing the
	continuations. Namely, to sequentially execute <kbd>a</kbd>
	and then <kbd>b</kbd>, we call
	<kbd>a</kbd> with a success continuation that calls
	<kbd>b</kbd>.
	<span style="color:blue"><kbd class='snippet'>
function analyze_sequence(stmts) {
    function sequentially(a, b) {
        return (env, succeed, fail) => 
                 a(env, 
                   // success continuation for calling $\texttt{a}$
                   (a_value, fail2) =>
                     is_return_value(a_value)
                     ? succeed(a_value, fail2)
                     : b(env, succeed, fail2),
                   // failure continuation for calling $\texttt{a}$
                   fail);
    }
    function loop(first_fun, rest_funs) {
        return is_null(rest_funs)
               ? first_fun
               : loop(sequentially(first_fun, head(rest_funs)),
                      tail(rest_funs));
    }
    const funs = map(analyze, stmts);
    return is_null(funs) 
           ? env => undefined
           : loop(head(funs), tail(funs));
}
	  </kbd></span>
      </span></td></tr></table>
  </p></div>

  
      <div class='permalink'>
        <a name='h5' class='permalink'></a><h2>
    
    
      
	<span style="color:green">Definitions</span>
	<span style="color:blue">Declarations</span>
      
      and assignments
    
  </h2></div>

  <div class='permalink'>
<a name='p21' class='permalink'></a><p>
    
      <span style="color:green">Definitions</span>
      <span style="color:blue">Declarations</span>
    
    are another case where we must go to some trouble to
    manage the continuations, because it is necessary to evaluate the
    
      <span style="color:green">
	definition-value expression before actually defining the new variable.
      </span>
      <span style="color:blue">
	declaration-value expression before actually declaring the new name.
      </span>
    
    To accomplish this, the
    
      <span style="color:green">definition-value</span>
      <span style="color:blue">declaration-value</span>
    
    execution
    
      <span style="color:green">procedure
      <kbd>vproc</kbd>
      </span>
      <span style="color:blue">function
      <kbd>vfun</kbd>
      </span>
    
    is called with the environment, a success continuation, and the
    failure continuation.  If the execution of
    
      <span style="color:green">
	<kbd>vproc</kbd>
      </span>
      <span style="color:blue">
	<kbd>vfun</kbd>
      </span>
    
    succeeds, obtaining a value <kbd>val</kbd> for the
    
      <span style="color:green">
	defined variable, the variable is defined and the success is propagated:
      </span>
      <span style="color:blue">
	declared name, the name is declared and the success is propagated:
      </span>
    
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (analyze-definition exp)
  (let ((var (definition-variable exp))
        (vproc (analyze (definition-value exp))))
    (lambda (env succeed fail)
      (vproc env                        
             (lambda (val fail2)
               (define-variable! var val env)
               (succeed 'ok fail2))
             fail))))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function analyze_declaration(component) {
    const symbol = declaration_symbol(component);
    const vfun = analyze(declaration_value_expression(component));
    return (env, succeed, fail) => 
             vfun(env,
                  (val, fail2) => {
                      assign_symbol_value(symbol, val, env);
                      return succeed(undefined, fail2);
                  },
                  fail);
}
      </kbd></span></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p22' class='permalink'></a><p>
    Assignments
    
    are more interesting.  This is the first place where we
    really use the continuations, rather than just passing them around.
    The execution
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    for assignments starts out like the one for
    
      <span style="color:green">definitions.</span>
      <span style="color:blue">declarations.</span>
    
    It first attempts
    to obtain the new value to be assigned to the
    
      <span style="color:green">variable.</span>
      <span style="color:blue">name.</span>
    
    If this evaluation of
    
      <span style="color:green"><kbd>vproc</kbd></span>
      <span style="color:blue"><kbd>vfun</kbd></span>
      
    fails, the assignment fails.
  </p></div>

  <div class='permalink'>
<a name='p23' class='permalink'></a><p>
    If
    
      <span style="color:green"><kbd>vproc</kbd></span>
      <span style="color:blue"><kbd>vfun</kbd></span>
      
    succeeds, however, and we go on to make the assignment, we must consider the
    possibility that this branch of the computation might later fail, which will
    require us to backtrack out of the assignment.  Thus, we must arrange to
    undo the assignment as part of the backtracking  process.<a class='superscript' id='footnote-link-4' href='#footnote-4'>[4]</a>
  </p></div>

  <div class='permalink'>
<a name='p24' class='permalink'></a><p>
    This is accomplished by giving
    
      <span style="color:green"><kbd>vproc</kbd></span>
      <span style="color:blue"><kbd>vfun</kbd></span>
      
    a success continuation (marked with the comment <QUOTE>*1*</QUOTE> below)
    that saves the old value of the variable before assigning the new value to
    the variable and proceeding from the assignment.  The failure continuation
    that is passed along with the value of the assignment (marked with the
    comment <QUOTE>*2*</QUOTE> below) restores the old value of the variable
    before continuing the failure. That is, a successful assignment provides a
    failure continuation that will intercept a subsequent failure; whatever
    failure would otherwise have called <kbd>fail2</kbd> calls
    this
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    instead, to undo the assignment before actually calling
    <kbd>fail2</kbd>.
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (analyze-assignment exp)
  (let ((var (assignment-variable exp))
        (vproc (analyze (assignment-value exp))))
    (lambda (env succeed fail)
      (vproc env
             (lambda (val fail2)        <EM>; *1*</EM>
               (let ((old-value
                     (lookup-variable-value var env))) 
                 (set-variable-value! var val env)
                 (succeed 'ok
                          (lambda ()    <EM>; *2*</EM>
                            (set-variable-value! var
                                                 old-value
                                                 env)
                            (fail2)))))
             fail))))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function analyze_assignment(component) {
    const symbol = assignment_symbol(component);
    const vfun = analyze(assignment_value_expression(component));
    return (env, succeed, fail) =>
             vfun(env,
                  (val, fail2) => {              // *1*
                      const old_value = lookup_symbol_value(symbol,
                                                            env);
                      assign_symbol_value(symbol, val, env);
                      return succeed(val,
                                     () => {     // *2*
                                         assign_symbol_value(symbol,
                                                             old_value, 
                                                             env);
                                         return fail2();
                                     });
                  },
                  fail);
}
      </kbd></span></td></tr></table>
  </p></div>

  <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
    </span>    </td>
          <td></td>
          <td><span style="color:blue">
      
      <div class='permalink'>
        <a name='h6' class='permalink'></a><h2>
    
	Return statements and blocks
      </h2></div>

      <div class='permalink'>
<a name='p25' class='permalink'></a><p>
	Analyzing return statements is straightforward.
	The return expression is analyzed to produce an execution function.
	The execution function for the return statement calls that execution
	function with a success continuation that wraps the return value
	in a return value object and passes it to the original success continuation.
	<span style="color:blue"><kbd class='snippet'>
function analyze_return_statement(component) {
    const rfun = analyze(return_expression(component));
    return (env, succeed, fail) =>
             rfun(env,
                  (val, fail2) =>
                    succeed(make_return_value(val), fail2),
                  fail);
}
	  </kbd></span>
      </p></div>
      <div class='permalink'>
<a name='p26' class='permalink'></a><p>
	The execution function for blocks calls the body's execution
	function on an extended environment, without changing success or
	failure continuations.
	<span style="color:blue"><kbd class='snippet'>
function analyze_block(component) {
    const body = block_body(component);
    const locals = scan_out_declarations(body);
    const unassigneds = list_of_unassigned(locals);
    const bfun = analyze(body);
    return (env, succeed, fail) =>
             bfun(extend_environment(locals, unassigneds, env),
                  succeed, 
                  fail);
}
	  </kbd></span>
      </p></div>
    </span></td></tr></table>
  
  
      <div class='permalink'>
        <a name='h7' class='permalink'></a><h2>
    
    
      
	<span style="color:green">Procedure</span>
	<span style="color:blue">Function</span>
      
      applications
    
  </h2></div>

  <div class='permalink'>
<a name='p27' class='permalink'></a><p>
    The execution
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    for applications contains no new ideas except for the technical complexity
    of managing the continuations.  This complexity arises in
    
      <span style="color:green"><kbd>analyze-application</kbd>,</span>
      <span style="color:blue">
      <kbd>analyze_application</kbd>,</span>
      
    due to the need to keep track of the success and failure continuations as
    we evaluate the
    
      <span style="color:green">operands.</span>
      <span style="color:blue">argument expressions.</span>
    
    We use a
    
      <span style="color:green">procedure <kbd>get-args</kbd></span>
      <span style="color:blue">function <kbd>get_args</kbd>
      </span>
      
    to evaluate the list of
    
      <span style="color:green">operands,</span>
      <span style="color:blue">argument expressions,</span>
    
    rather than a simple
    <kbd>map</kbd> as in the ordinary evaluator.
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (analyze-application exp)
  (let ((fproc (analyze (operator exp)))
        (aprocs (map analyze (operands exp))))
    (lambda (env succeed fail)
      (fproc env
             (lambda (proc fail2)
               (get-args aprocs
                         env
                         (lambda (args fail3)
                           (execute-application
                            proc args succeed fail3))
                         fail2))
             fail))))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function analyze_application(component) {
    const ffun = analyze(function_expression(component));
    const afuns = map(analyze, arg_expressions(component));
    return (env, succeed, fail) =>
             ffun(env,
                  (fun, fail2) =>
                    get_args(afuns, 
                             env,
                             (args, fail3) =>
                               execute_application(fun,
                                                   args, 
                                                   succeed,
                                                   fail3),
                             fail2),
                  fail); 
}      
      </kbd></span></td></tr></table>
  </p></div>

  
  
  <div class='permalink'>
<a name='p28' class='permalink'></a><p>
    
      <span style="color:green">
	In  <kbd>get-args</kbd>, notice how
	<kbd>cdr</kbd>ing down the list of
	<kbd>aproc</kbd>
	execution procedures and
	<kbd>cons</kbd>ing
	up the resulting list of
	<kbd>args</kbd> is accomplished by calling each
	<kbd>aproc</kbd>
	in the list with a success continuation that recursively calls
	<kbd>get-args</kbd>.
      </span>
      <span style="color:blue">
	In <kbd>get_args</kbd>,
	notice how walking down the list of
	<kbd>afun</kbd>
	execution functions
	and constructing the resulting list of
	<kbd>args</kbd>
	is accomplished by calling each
	<kbd>afun</kbd>
	in the list with a success continuation that recursively calls
	<kbd>get_args</kbd>.
      </span>
    
    Each of these recursive calls to
    
      <span style="color:green"><kbd>get-args</kbd></span>
      <span style="color:blue"><kbd>get_args</kbd></span>
      
    has a success continuation whose value is the
    
      <span style="color:green">
	<kbd>cons</kbd>
	of the newly obtained argument onto the list of accumulated arguments:
      </span>
      <span style="color:blue">
	new list resulting from using
	<kbd>pair</kbd>
	to adjoin the newly obtained argument
	to the list of accumulated arguments:
      </span>
    
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (get-args aprocs env succeed fail)
  (if (null? aprocs)
      (succeed '() fail)
      ((car aprocs) env
                    <EM>;; success continuation for this <kbd>aproc</kbd></EM>
                    (lambda (arg fail2)
                      (get-args (cdr aprocs)
                                env
                                <EM>;; success continuation for recursive</EM>
                                <EM>;; call to <kbd>get-args</kbd></EM>
                                (lambda (args fail3)
                                  (succeed (cons arg args)
                                           fail3))
                                fail2))
                    fail)))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function get_args(afuns, env, succeed, fail) {      
    return is_null(afuns)
           ? succeed(null, fail)
           : head(afuns)(env,
                         // success continuation for this $\texttt{afun}$
                         (arg, fail2) =>
                           get_args(tail(afuns),
                                    env,
                                    // success continuation for
                                    // recursive call to $\texttt{get\char`_args}$
                                    (args, fail3) =>
                                      succeed(pair(arg, args),
                                              fail3),
                                    fail2),
                         fail);
}
      </kbd></span></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p29' class='permalink'></a><p>
    The actual
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    application, which is performed by
    
      <span style="color:green"><kbd>execute-application</kbd>,</span>
      <span style="color:blue"><kbd>execute_application</kbd>,
      </span>
      
    is accomplished in the same way as for the ordinary evaluator, except for
    the need to manage the continuations.
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (execute-application proc args succeed fail)
  (cond ((primitive-procedure? proc)
         (succeed (apply-primitive-procedure proc args)
                  fail))
        ((compound-procedure? proc)
         ((procedure-body proc)
          (extend-environment (procedure-parameters proc)
                              args
                              (procedure-environment proc))
          succeed
          fail))
        (else
         (error
          "Unknown procedure type - - EXECUTE-APPLICATION"
          proc))))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function execute_application(fun, args, succeed, fail) {
    return is_primitive_function(fun)
           ? succeed(apply_primitive_function(fun, args),
                     fail)
           : is_compound_function(fun) 
           ? function_body(fun)(
                 extend_environment(function_parameters(fun),
                                    args,
                                    function_environment(fun)),
                 (body_result, fail2) => 
                   succeed(is_return_value(body_result) 
                           ? return_value_content(body_result)
                           : undefined,
                           fail2),
                 fail)
           : error(fun, "unknown function type - execute_application");
}
      </kbd></span></td></tr></table>
  </p></div>

  
  
      <div class='permalink'>
        <a name='h8' class='permalink'></a><h2>
    
    Evaluating amb expressions
  </h2></div>

  <div class='permalink'>
<a name='p30' class='permalink'></a><p>
    The <kbd>amb</kbd>
    
      <span style="color:green">special</span>
      <span style="color:blue">syntactic</span>
    
    form is the key element in the nondeterministic language.  Here we see the
    essence of the interpretation process and the reason for keeping track of
    the continuations.  The execution
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    for <kbd>amb</kbd> defines a loop
    
      <span style="color:green"><kbd>try-next</kbd></span>
      <span style="color:blue"><kbd>try_next</kbd></span>
    
    that cycles through the execution
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    for all the possible values of the <kbd>amb</kbd>
    expression.  Each execution
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    is called with a
    
    failure continuation that will try the next one.  When
    there are no more alternatives to try, the entire
    <kbd>amb</kbd> expression fails.
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (analyze-amb exp)
  (let ((cprocs (map analyze (amb-choices exp))))
    (lambda (env succeed fail)
      (define (try-next choices)
        (if (null? choices)
            (fail)
            ((car choices) env
             succeed
             (lambda ()
               (try-next (cdr choices))))))
      (try-next cprocs))))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function analyze_amb(component) {
    const cfuns = map(analyze, amb_choices(component));
    return (env, succeed, fail) => {
               function try_next(choices) {
                   return is_null(choices)
                          ? fail()
                          : head(choices)(env,
                                          succeed,
                                          () =>
                                            try_next(tail(choices)));
               }
               return try_next(cfuns);
           };
}
      </kbd></span></td></tr></table>
  </p></div>

  
      <div class='permalink'>
        <a name='h9' class='permalink'></a><h2>
    
    Driver loop
  </h2></div>

  

  <div class='permalink'>
<a name='p31' class='permalink'></a><p>
    The driver loop for the <kbd>amb</kbd> evaluator is
    complex, due to the mechanism that permits the user to retry in evaluating
    
      <span style="color:green">an expression.</span>
      <span style="color:blue">a program.</span>
    
    The driver uses a
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    called
    
      <span style="color:green"><kbd>internal-loop</kbd>,</span>
      <span style="color:blue"><kbd>internal_loop</kbd>,
      </span>
    
    which takes as argument a
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    
    
      <span style="color:green">  
	<kbd>try-again</kbd>.
      </span>
      <span style="color:blue">
	<kbd>retry</kbd>.
      </span>
    
    The intent is that calling
    <span style="color:green">  
      <kbd>try-again</kbd>
    </span>
    <span style="color:blue">
      <kbd>retry</kbd>
    </span>
    should go on to the next untried alternative in the nondeterministic
    evaluation.
    <span style="color:green">  
      <kbd>Internal-loop</kbd>
    </span>
    <span style="color:blue">The function
    <kbd>internal_loop</kbd>
    </span>
    either calls
    
      <span style="color:green"><kbd>try-again</kbd></span>
      <span style="color:blue"><kbd>retry</kbd></span>
    
    in response to the user typing
    
      <span style="color:green"><kbd>try-again</kbd></span>
      <span style="color:blue">
	<kbd>retry</kbd>
      </span>
    
    at the driver loop, or else starts a new evaluation by calling
    <kbd>ambeval</kbd>.  
  </p></div>

  <div class='permalink'>
<a name='p32' class='permalink'></a><p>
    The failure continuation for this call to
    <kbd>ambeval</kbd>
    
    informs the user that there are no more values and reinvokes the driver
    loop.
  </p></div>

  <div class='permalink'>
<a name='p33' class='permalink'></a><p>
    The success continuation for the call to <kbd>ambeval</kbd>
    
    is more subtle.  We print the obtained value and then
    
      <span style="color:green">
	invoke the internal loop again
      </span>
      <span style="color:blue">
	reinvoke the internal loop
      </span>
    
    with a
    
      <span style="color:green">  
	<kbd>try-again</kbd>
      </span>
      <span style="color:blue">
	<kbd>retry</kbd>
      </span>
    
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    that will be able to try the next alternative.  This
    
      <span style="color:green">  
	<kbd>next-alternative</kbd>
      </span>
      <span style="color:blue">
	<kbd>next_alternative</kbd>
      </span>
    
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    is the second argument that was passed to the success continuation.
    Ordinarily, we think of this second argument as a failure continuation to
    be used if the current evaluation branch later fails.  In this case,
    however, we have completed a successful evaluation, so we can invoke the
    <QUOTE>failure</QUOTE> alternative branch in order to search for additional
    successful evaluations.
    
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define input-prompt ";;; Amb-Eval input:")
(define output-prompt ";;; Amb-Eval value:")

(define (driver-loop)
  (define (internal-loop try-again)
    (prompt-for-input input-prompt)
    (let ((input (read)))
      (if (eq? input 'try-again)
          (try-again)
          (begin
            (newline)
            (display ";;; Starting a new problem ")
            (ambeval input
                     the-global-environment
                     <EM>;; <kbd>ambeval</kbd> success</EM>
                     (lambda (val next-alternative)
                       (announce-output output-prompt)
                       (user-print val)
                       (internal-loop next-alternative))
                    <EM>;; <kbd>ambeval</kbd> failure</EM>
                    (lambda ()
                      (announce-output
                       ";;; There are no more values of")
                      (user-print input)
                      (driver-loop)))))))
  (internal-loop
   (lambda ()
     (newline)
     (display ";;; There is no current problem")
     (driver-loop))))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
const input_prompt = "amb-evaluate input:";
const output_prompt =  "amb-evaluate value:";

function driver_loop(env) {
    function internal_loop(retry) {
        const input = user_read(input_prompt);
        if (is_null(input)) {
            display("evaluator terminated");
        } else if (input === "retry") {
            return retry();
        } else {
            display("Starting a new problem");
            const program = parse(input);
            const locals = scan_out_declarations(program);
            const unassigneds = list_of_unassigned(locals);
            const program_env = extend_environment(
                                    locals, unassigneds, env);
            return ambeval(
                       program,  
                       program_env,
                       // ambeval success
                       (val, next_alternative) => {
                           user_print(output_prompt, val);
                           return internal_loop(next_alternative);
                       },
                       // ambeval failure
                       () => {
                           display("There are no more values of");
                           display(input);
                           return driver_loop(program_env);
                       });
        }
    }
    return internal_loop(() => {
                             display("There is no current problem");
                             return driver_loop(env);
                         });
}
      </kbd></span></td></tr></table>
    The initial call to
    
      <span style="color:green"><kbd>internal-loop</kbd></span>
      <span style="color:blue"><kbd>internal_loop</kbd></span>
    
    uses a
    
      <span style="color:green"><kbd>try-again</kbd></span>
      <span style="color:blue"><kbd>retry</kbd></span>
    
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    that complains that there is no current problem and restarts the driver loop.
    This is the behavior that will happen if the user types
    
      <span style="color:green"><kbd>try-again</kbd></span>
      <span style="color:blue">
	<kbd>retry</kbd>
      </span>
    
    when there is no evaluation in progress.
  </p></div>
  <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td>    </td>
          <td></td>
          <td><span style="color:blue">
      <div class='permalink'>
<a name='p34' class='permalink'></a><p>
	We start the driver loop as usual, by setting up the global environment
	and passing it as the enclosing environment for the first iteration of
	<kbd>driver_loop</kbd>.
	<span style="color:blue"><kbd class='snippet'>
const the_global_environment = setup_environment();
driver_loop(the_global_environment);
	  </kbd></span>
      </p></div>
    </span></td></tr></table>
  
  
    <div class="permalink">
    <a name="ex_4.59" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.59">Exercise 4.59 </a></b> 
  
    Implement a new
    
      <span style="color:green">special</span>
      <span style="color:blue">syntactic</span>
    
    form <kbd>ramb</kbd> that is like
    <kbd>amb</kbd> except that it searches alternatives in a
    random order, rather than from left to right.  Show how this can help with
    Alyssa's problem in exercise&nbsp;<REF NAME="ex:sentence-generate"><a class="superscript" id="4.3.3-ex-link-4.58" href="./4.3.2.html#ex_4.58">4.58</a></REF>.
    
  
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_94_1_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_94_1_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>



  
    <div class="permalink">
    <a name="ex_4.60" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.60">Exercise 4.60 </a></b> 
  
    
      <span style="color:green">
	Implement a new kind of assignment called
	<kbd>permanent-set!</kbd> that
      </span>
      <span style="color:blue">
	Change the implementation of assignment so that it
      </span>
    
    is not undone upon failure. For example, we can choose two distinct
    elements from a list and count the number of trials required to make a
    successful choice as follows:
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define count 0)

(let ((x (an-element-of '(a b c)))
      (y (an-element-of '(a b c))))
  (permanent-set! count (+ count 1))
  (require (not (eq? x y)))
  (list x y count))
      </kbd></span><kbd class='snippet-output'>
;;; Starting a new problem
;;; Amb-Eval value:
(a b 2)

;;; Amb-Eval input:
      </kbd></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
let count = 0;

let x = an_element_of("a", "b", "c");
let y = an_element_of("a", "b", "c");
count = count + 1;
require(x !== y);
list(x, y, count);
      </kbd><kbd class='snippet-output'>
Starting a new problem
amb-evaluate value:
["a", ["b", [2, null]]]
      </kbd></span></td></tr></table>
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
try-again
      </kbd></span><kbd class='snippet-output'>
;;; Amb-Eval value:
(a c 3)
      </kbd></span>    </td>
            <td><span style="color:blue"><kbd class='snippet-prompt'>
amb-evaluate input:
      </kbd><kbd class='snippet'>
retry
      </kbd><kbd class='snippet-output'>
amb-evaluate value:
["a", ["c", [3, null]]]
      </kbd></span></td></tr></table>
    <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
	What values would have been displayed if we had used
	<kbd>set!</kbd> here rather than
	<kbd>permanent-set!</kbd>?
      </span>    </td>
          <td></td>
          <td><span style="color:blue">
	What values would have been displayed if we had used
	the original meaning of assignment rather than
	permanent assignment?
      </span></td></tr></table>
    
  
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_94_2_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_94_2_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


  <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
      
    <div class="permalink">
    <a name="ex_4.61" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.61">Exercise 4.61 </a></b> 
  
	
	Implement a new construct called <kbd>if-fail</kbd>
	that permits the user to catch the failure of an expression.
	<kbd>If-fail</kbd> takes two expressions. It evaluates
	the first expression as usual and returns as usual if the evaluation
	succeeds. If the evaluation fails, however, the value of the second
	expression is returned, as in the following example:
	<span style="color:green"><kbd class='snippet'>
	  </kbd><kbd class='snippet-output'>
;;; Amb-Eval input:
	  </kbd></span>
	<span style="color:green"><kbd class='snippet'>
(if-fail (let ((x (an-element-of '(1 3 5))))
           (require (even? x))
           x)
         'all-odd)
	  </kbd><kbd class='snippet-output'>
;;; Starting a new problem
;;; Amb-Eval value:
all-odd

;;; Amb-Eval input:
	  </kbd></span>
	<span style="color:green"><kbd class='snippet'>
(if-fail (let ((x (an-element-of '(1 3 5 8))))
           (require (even? x))
           x)
         'all-odd)
	  </kbd><kbd class='snippet-output'>
;;; Starting a new problem
;;; Amb-Eval value:
8
	  </kbd></span>
      
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_94_3_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_94_3_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>

    </span>    </td>
          <td></td>
          <td><span style="color:blue">
      
    <div class="permalink">
    <a name="ex_4.62" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.62">Exercise 4.62 </a></b> 
  
	
	We shall horribly abuse the syntax for conditional statements, by
	implementing a construct of the following form: 
	<span style="color:blue"><kbd class='snippet'>
if (evaluation_succeeds_take) { $statement$ } else { $alternative$ }
	  </kbd></span>
	The construct permits the user to catch the failure of a
	statement. It evaluates the statement as usual and returns
	as usual if the evaluation succeeds. If the evaluation fails,
	however, the given alternative statement 
	is evaluated, as in the following example:
	<span style="color:blue"><kbd class='snippet-prompt'>
amb-evaluate input:
	  </kbd><kbd class='snippet'>
if (evaluation_succeeds_take) {
    const x = an_element_of(list(1, 3, 5));
    require(is_even(x));
    x;
} else {
    "all odd";
}
	  </kbd><kbd class='snippet-output'>
Starting a new problem
amb-evaluate value:
"all odd"
	  </kbd></span>
	<span style="color:blue"><kbd class='snippet-prompt'>
amb-evaluate input:
	  </kbd><kbd class='snippet'>
if (evaluation_succeeds_take) {
    const x = an_element_of(list(1, 3, 5, 8));
    require(is_even(x));
    x;
} else {
    "all odd";
}
	  </kbd><kbd class='snippet-output'>
Starting a new problem
amb-evaluate value:
8
	  </kbd></span>
	Implement this construct by extending the
	<kbd>amb</kbd>
	evaluator. Hint: The function 
	<kbd>is_amb</kbd> shows
	how to abuse the existing JavaScript syntax in order to implement
	a new syntactic form.
      
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_94_4_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_94_4_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>

    </span></td></tr></table>

  
    <div class="permalink">
    <a name="ex_4.63" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.63">Exercise 4.63 </a></b> 
  
    
    With
    
      <span style="color:green">
	<kbd>permanent-set!</kbd>
      </span>
      <span style="color:blue">
	the new kind of assignment
      </span>
    
    as described in exercise&nbsp;<REF NAME="ex:permanent-set"><a class="superscript" id="4.3.3-ex-link-4.60" href="./4.3.3.html#ex_4.60">4.60</a></REF> and
    
      <span style="color:green">
	<kbd>if-fail</kbd>
      </span>
      <span style="color:blue">
	the construct
	<span style="color:blue"><kbd class='snippet'>
if (evaluation_succeeds_take) { $\ldots$ } else { $\ldots$ }
      </kbd></span>
      </span>
    
    as in exercise&nbsp;<REF NAME="ex:if-fail"><a class="superscript" id="4.3.3-ex-link-4.62" href="./4.3.3.html#ex_4.62">4.62</a></REF>, what will be the result of
    evaluating
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(let ((pairs '()))
  (if-fail (let ((p (prime-sum-pair '(1 3 5 8) '(20 35 110))))
             (permanent-set! pairs (cons p pairs))
             (amb))
           pairs))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
let pairs = null;      
if (evaluation_succeeds_take) {
    const p = prime_sum_pair(list(1, 3, 5, 8), list(20, 35, 110));
    pairs = pair(p, pairs); // using permanent assignment
    amb();
} else {
    pairs;
}
      </kbd></span></td></tr></table>
  
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_94_5_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_94_5_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


  
    <div class="permalink">
    <a name="ex_4.64" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.64">Exercise 4.64 </a></b> 
  
    
    If we had not realized that
    
    <kbd>require</kbd> could be
    implemented as an ordinary
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    that uses <kbd>amb</kbd>, to be defined by the user as
    part of a nondeterministic program, we would have had to implement it
    as a 
    
      <span style="color:green">special</span>
      <span style="color:blue">syntactic</span>
    
    form. This would require syntax
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (require? exp) (tagged-list? exp 'require))

(define (require-predicate exp) (cadr exp))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function is_require(component) {
    return is_tagged_list(component, "require"); 
}
function require_predicate(component) { return head(tail(component)); }
      </kbd></span></td></tr></table>
    and a new clause in the dispatch in <kbd>analyze</kbd>
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
      ((require? exp) (analyze-require exp))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
: is_require(component)
? analyze_require(component)
      </kbd></span></td></tr></table>
    as well the
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    
      <span style="color:green">
	<kbd>analyze-require</kbd>
      </span>
      <span style="color:blue">
	<kbd>analyze_require</kbd>
      </span>
    
    that handles <kbd>require</kbd>
    expressions.  Complete the following definition of
    
      <span style="color:green">
	<kbd>analyze-require</kbd>.
      </span>
      <span style="color:blue">
	<kbd>analyze_require</kbd>.
      </span>
    
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td class="meta" style = "color:grey; text-align: center">Original</td>
            <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
          </tr>
          <tr>
            <td><span style="color:green"><span style="color:green"><kbd class='snippet'>
(define (analyze-require exp)
  (let ((pproc (analyze (require-predicate exp))))
    (lambda (env succeed fail)
      (pproc env
             (lambda (pred-value fail2)
               (if ??
                   ??
                   (succeed 'ok fail2)))
             fail))))
      </kbd></span></span>    </td>
            <td><span style="color:blue"><kbd class='snippet'>
function analyze_require(component) {
    const pfun = analyze(require_predicate(component));
    return (env, succeed, fail) =>
             pfun(env,
                  (pred_value, fail2) =>
                    $\langle{}$<EM>??</EM>$\rangle$
                    ? $\langle{}$<EM>??</EM>$\rangle$
                    : succeed("ok", fail2),
                  fail);
}
      </kbd></span></td></tr></table>
  
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_94_6_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_94_6_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


  

  
  
    
    
    
    
    
    
    
<hr>

    <div class='footnote'>
      <a class='footnote-number' id='footnote-1' href='#footnote-link-1' >[1] </a>
    <FOOTNOTE>
    We chose to
    implement the lazy evaluator in
    section&nbsp;<REF NAME="sec:lazy-evaluation"><a class="superscript" id="4.3.3-sec-link-4.2" href="./4.2.html">4.2</a></REF> as a modification of the
    ordinary metacircular evaluator of
    section&nbsp;<REF NAME="sec:core-of-evaluator"><a class="superscript" id="4.3.3-sec-link-4.1.1" href="./4.1.1.html">4.1.1</a></REF>.  In contrast, we will
    base the <kbd>amb</kbd> evaluator on the analyzing
    evaluator of section&nbsp;<REF NAME="sec:separating-analysis"><a class="superscript" id="4.3.3-sec-link-4.1.7" href="./4.1.7.html">4.1.7</a></REF>, because
    the execution
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    in that evaluator provide a convenient framework for implementing
    backtracking.
    </FOOTNOTE></div>

    
    <div class='footnote'><span style="color:green">
      <a class='footnote-number' id='footnote-2' href='#footnote-link-2' style="color:green">[2] </a>
    <FOOTNOTE>
    We
	assume that the evaluator supports <kbd>let</kbd>
	(see exercise&nbsp;<REF NAME="ex:implement-analyze-let"><a class="superscript" id="4.3.3-ex-link-4.31" href="./4.1.7.html#ex_4.31">4.31</a></REF>),
	which we have used in our nondeterministic programs.
    </FOOTNOTE></span></div>

    
    <div class='footnote'><span style="color:blue">
      <a class='footnote-number' id='footnote-3' href='#footnote-link-3' style="color:blue">[3] </a>
    <FOOTNOTE>
    With this treatment, 
	<kbd>amb</kbd> is no longer a name with
	proper scoping.	To avoid confusion, we must
	refrain from declaring <kbd>amb</kbd> as a
	name in our nondeterministic programs.
    </FOOTNOTE></span></div>

    
    <div class='footnote'>
      <a class='footnote-number' id='footnote-4' href='#footnote-link-4' >[4] </a>
    <FOOTNOTE>
    We
    
      <span style="color:green">
	didn't worry about undoing definitions,
	since we can
	assume that
	
	internal definitions
	are scanned out
	(section&nbsp;<REF NAME="sec:internal-definitions"><a class="superscript" id="4.3.3-sec-link-4.1.6" href="./4.1.6.html">4.1.6</a></REF>).
      </span>
      <span style="color:blue">
	didn't worry about undoing declarations, since we assume that a
	name can't be used prior to the evaluation of its declaration,
	
	so its previous value doesn't matter.
      </span>
    
    </FOOTNOTE></div>

    
</div></div>

    <div class='nav'>
  
        <a class='btn btn-secondary btn-nav' href='./4.3.2.html'>&lt; Previous</a>
    
    <div style='flex-grow: 1;'></div>
  
        <a class='btn btn-secondary btn-nav' id='96' href='./4.4.html'>Next &gt;</a>
      </div>
    <div class='chapter_sign'>
      4.3.3&nbsp;&nbsp;
    Implementing the
    
      <span style="color:green">Amb</span>
      <span style="color:blue">amb</span>
    
    Evaluator
  
    </div>
    <script> var chapter_id = 95; </script>
    <script> var chapter_path = "chapters/4.3.3.html"; </script>
    <div class='next-page'></div>
    </div>
    </div> <!-- /.container -->
    </body></html>