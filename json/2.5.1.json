[{"id":"/sicpjs/2.5.1","tag":"TITLE","body":"2.5.1  \n    Generic Arithmetic Operations"},{"tag":"TEXT","id":"#p1","child":[{"body":"\n    The task of designing generic arithmetic operations is analogous to that of\n    designing the generic complex-number operations.  We would like, for\n    instance, to have a generic addition\n    function","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"add"},{"body":" that acts like ordinary primitive addition\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"+"},{"body":" on ordinary numbers, like\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"add_rat"},{"body":"\n    on rational numbers, and like\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"add_complex"},{"body":"\n    on complex numbers.  We can implement ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"add"},{"body":", and\n    the other generic arithmetic operations, by following the same strategy we\n    used in section ","tag":"#text"},{"tag":"REF","body":"2.4.3","href":"/sicpjs/2.4.3"},{"body":" to implement the\n    generic selectors for complex numbers.  We will attach a type tag to each\n    kind of number and cause the generic\n    function\n    to dispatch to an appropriate package according to the data type of its\n    arguments.\n  ","tag":"#text"}]},{"tag":"TEXT","id":"#p2","child":[{"body":"\n    The generic arithmetic\n    functions\n    are defined as follows:\n    ","tag":"#text"},{"tag":"SNIPPET","latex":false,"id":1,"eval":false,"body":"function add(x, y) { return apply_generic(\"add\", list(x, y)); }\n\nfunction sub(x, y) { return apply_generic(\"sub\", list(x, y)); }\n\nfunction mul(x, y) { return apply_generic(\"mul\", list(x, y)); }\n\nfunction div(x, y) { return apply_generic(\"div\", list(x, y)); }"}]},{"tag":"TEXT","id":"#p3","child":[{"body":"\n    We begin\n    by installing a package for handling\n    ","tag":"#text"},{"tag":"EM","child":[{"body":"ordinary","tag":"#text"}]},{"body":" numbers,\n    that is, the primitive numbers of our language.  We\n    \n    tag these\n    with the \n    \n\tstring ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"\"javascript_number\""},{"body":".\n      \n    The arithmetic operations in this package are the primitive arithmetic\n    functions\n    (so there is no need to define extra\n    functions\n    to handle the untagged numbers).  Since these operations each take two\n    arguments, they are installed in the table keyed by the list\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"list(\"javascript_number\", \"javascript_number\")"},{"body":":","tag":"#text"},{"tag":"SNIPPET","latex":false,"id":2,"eval":true,"prependLength":95,"program":"chap=4&prgrm=PTAEGUEkGEAVQFLlAJgHQFY0EYBQuRRIA7CAewFcAnAYwFMAaUAWzIGcAXUAMwuJo4BLMsTagAFgEMAbnVCSeggB50AJqGIVmAIzpVQZbvKoBzLXWIc2aAmAAUAFXFze-ISNAAbQZ1A-QHM4GxJ4AnqB0SvQADu7ETBxkAeL+bEncklRoAJS2oE4ufALCpJLR0WEA+oLElXyqemE1JpUAVjKSbDRUgrHynp5kAO5iFGKJeWUV4ZLE4SaCsqSuxR6uAUmSAxGedMwWVgZGgXKZZvuWoHnevmdsTJ1+x87hQ3pybHTRmZIcp6bmSxsXArOLycphOyuB6mNjZUAAb1woBRoCodA41FKENC1Vq9UaoWabQ6XR6sShfBhJjhAG5cABffCgkrg6aVEwWPSCGh2MjRalwxHI1E0ES+DihaJ0SocSQ00AAXhYZTskulsvlguy9NRoDFoi462VnI4fIFASlMrlNJ1IpR6MxVFIAEI-Gw6sQGtwampKcRcnqgyiAPxsqo1T0NKhNYgtdrSTrdXpm6Eq6J2A1-IHawPBvUALgiVCoZCodhuZv5CStmttDHt+aboAARMQkvtAmR1Nwy8k6J9LdKxABaEfh3Gc4jcmgtu1MkFFMGSVSqOxKJiheEItEYrETjlcnq8lsr1QtpiV9eb7I60ALlkeNgUbTX0BbxG7p3Y9lTmd2Ftn20C8vB8M0N3fW9aXvZkl1ZZgKE8N8Px3R19ymKo-2PACEM8ECrwgrc7wfOCPFURZkO3L90JxQ9p2wltyOkfCwMo4j8EIfk9F+EpNW0XYmGiCguFmdRTTybhS2YfUpFiPRQAAZlAOxPlWUgFLQDSFNyRc3FZTo0l5ABrOhQiYdExSoVQhSRPU0Odd1Kk0AY7AsstrLzZswwJH1p1URt8yLOgAEcKC2OwTLMiQ6BXOxnFityrLhW8AuDMN4rXRKPNSoMiwMshjNMhJJEEJCsuS+kSL0jxmEkEy+N2Oxt0bA1fEGGgtgauRlSvFsACo5X4ug+rnXVUUfUhBjIIyKAzSLKmwJh5pQZqm1arggMG3YlXkNhDIi0yFuK0qKwKzqtroKCcqeZSfCjOhfL9TbJCG29hWbVF7NIHzfVUMbgwZHZB1sj79XFLgsp2-LCtxFBjqQ57XrtUHqIcu6fr81y6Es1RPJRvVvK9B7fuu0GizlE6suR-MmT1WnxtI0gak+KgzXmxbQGWphE08ChLve-N1tARHtuVaGDtxDmKaQ9rzpe3YrqbQQjDsdGicetcRcu1bQc+DhNRO2XPC6ht8abb5BHLK92cEkryy50Aeb529TbN0HpdOjrjYu29qYBoG5BBj6hchsW9oKiXKjhgISoRl8fb95tlduj0Mb9KmdbNvWDbj7QLtdt3zbtuwLftw7o6dy74ZU+P5e1xOm0BuhPGB0n82zj2su5rZnf+5t6YBxsB54RnQHIthvg4GhxDsZhM6DL6WCVRVlRbKaZuiFs26DMN19m7fCyXlfV+ZvQOC3t2w1P1mD9RIKSzLWemBbPgjPbIZSC4qgeI8McY6G0aQ9GyL3HpPaelV8BCy-j-WoF0dq1XqhdJq9Ihamh2tAuIXUAJ703naIWQkuDKgwbxJBLZr7nztLpNS8gOBymnnWNUtYbRMCzAcGywC9wOVLowjUzCwaWDYfOKhYJ1TWnlHYVQvwtDz0XndbhkjMRz23ulGKa4FHSO3vfUs5Z1HMGftoFcMcTCcnULo0Af9RF1kAUyCa-DsxWAkVIueAsHScKZh6eRTi8b5jDB7XR3jgxaMfro-RhibQmLHk48x45WFAmsbBaqTNDRbGNgmJM5J9aaB0HoSo3waBGXlHQJqLiR6JKMeueedk3E0LoeIBhLY0lkhTE5LQugqAgSUInYeBCAJnhYpwACjTkyxBadk9pz8hkZNGW0ucTBrqUSVAAPnKUoUAABqSCicemARfP0s0DTSTDMya0vQIEDmJiaSMrJMzshzKbAsxUyybTrnMZsvu2zcJ7MGYcqZ1zTkTJ+c0v57TblXHuYReEjyVmgD6m8xs2ymJfPOekoFJzxmtkmaisZsywX5geU88RqywBEXecJHCdU6BnMxVctFIFrqrKhc8zpidF6MREJSyqQA","body":"function install_javascript_number_package() {\n    function tag(x) {\n        return attach_tag(\"javascript_number\", x);\n    }\n    put(\"add\", list(\"javascript_number\", \"javascript_number\"), \n        (x, y) => tag(x + y));\n    put(\"sub\", list(\"javascript_number\", \"javascript_number\"), \n        (x, y) => tag(x - y));\n    put(\"mul\", list(\"javascript_number\", \"javascript_number\"), \n        (x, y) => tag(x * y));\n    put(\"div\", list(\"javascript_number\", \"javascript_number\"), \n        (x, y) => tag(x / y));\n    put(\"make\", \"javascript_number\", \n        x => tag(x));\n    return \"done\";\n} "}]},{"tag":"TEXT","id":"#p4","child":[{"body":"\n    Users of the\n    JavaScript-number package\n    will create (tagged) ordinary numbers by means of the\n    function:","tag":"#text"},{"tag":"SNIPPET","latex":false,"id":3,"eval":true,"prependLength":114,"program":"chap=4&prgrm=PTAEGUEkGEAVQFLlAJgHQFY0EYBQuRRIA7CAewFcAnAYwFMAaUAWzIGcAXUAMwuJo4BLMsTagAFgEMAbnVCSeggB50AJqGIVmAIzpVQZbvKoBzLXWIc2aAmAAUAFXFze-ISNAAbQZ1A-QHM4GxJ4AnqB0SvQADu7ETBxkAeL+bEncklRoAJS2oE4ufALCpJLR0WEA+oLElXyqemE1JpUAVjKSbDRUgrHynp5kAO5iFGKJeWUV4ZLE4SaCsqSuxR6uAUmSAxGedMwWVgZGgXKZZvuWoHnevmdsTJ1+x87hQ3pybHTRmZIcp6bmSxsXArOLycphOyuB6mNjZUAAb1woBRoCodA41FKENC1Vq9UaoWabQ6XR6sShfBhJjhAG5cABffCgkrg6aVEwWPSCGh2MjRalwxHI1E0ES+DihaJ0SocSQ00AAXhYZTskulsvlguy9NRoDFoi462VnI4fIFASlMrlNJ1IpR6MxVFIAEI-Gw6sQGtwampKcRcnqgyiAPxsqo1T0NKhNYgtdrSTrdXpm6Eq6J2A1-IHawPBvUALgiVCoZCodhuZv5CStmttDHt+aboAARMQkvtAmR1Nwy8k6J9LdKxABaEfh3Gc4jcmgtu1MkFFMGSVSqOxKJiheEItEYrETjlcnq8lsr1QtpiV9eb7I60ALlkeNgUbTX0BbxG7p3Y9lTmd2Ftn20C8vB8M0N3fW9aXvZkl1ZZgKE8N8Px3R19ymKo-2PACEM8ECrwgrc7wfOCPFURZkO3L90JxQ9p2wltyOkfCwMo4j8EIfk9F+EpNW0XYmGiCguFmdRTTybhS2YfUpFiPRQAAZlAOxPlWUgFLQDSFNyRc3FZTo0l5ABrOhQiYdExSoVQhSRPU0Odd1Kk0AY7AsstrLzZswwJH1p1URt8yLOgAEcKC2OwTLMiQ6BXOxnFityrLhW8AuDMN4rXRKPNSoMiwMshjNMhJJEEJCsuS+kSL0jxmEkEy+N2Oxt0bA1fEGGgtgauRlSvFsACo5X4ug+rnXVUUfUhBjIIyKAzSLKmwJh5pQZqm1arggMG3YlXkNhDIi0yFuK0qKwKzqtroKCcqeZSfCjOhfL9TbJCG29hWbVF7NIHzfVUMbgwZHZB1sj79XFLgsp2-LCtxFBjqQ57XrtUHqIcu6fr81y6Es1RPJRvVvK9B7fuu0GizlE6suR-MmT1WnxtI0gak+KgzXmxbQGWphE08ChLve-N1tARHtuVaGDtxDmKaQ9rzpe3YrqbQQjDsdGicetcRcu1bQc+DhNRO2XPC6ht8abb5BHLK92cEkryy50Aeb529TbN0HpdOjrjYu29qYBoG5BBj6hchsW9oKiXKjhgISoRl8fb95tlduj0Mb9KmdbNvWDbj7QLtdt3zbtuwLftw7o6dy74ZU+P5e1xOm0BuhPGB0n82zj2su5rZnf+5t6YBxsB54RnQHIthvg4GhxDsZhM6DL6WCVRVlRbKaZuiFs26DMN19m7fCyXlfV+ZvQOC3t2w1P1mD9RIKSzLWemBbPgjPbIZSC4qgeI8McY6G0aQ9GyL3HpPaelV8BCy-j-WoF0dq1XqhdJq9Ihamh2tAuIXUAJ703naIWQkuDKgwbxJBLZr7nztLpNS8gOBymnnWNUtYbRMCzAcGywC9wOVLowjUzCwaWDYfOKhYJ1TWnlHYVQvwtDz0XndbhkjMRz23ulGKa4FHSO3vfUs5Z1HMGftoFcMcTCcnULo0Af9RF1kAUyCa-DsxWAkVIueAsHScKZh6eRTi8b5jDB7XR3jgxaMfro-RhibQmLHk48x45WFAmsbBaqTNDRbGNgmJM5J9aaB0HoSo3waBGXlHQJqLiR6JKMeueedk3E0LoeIBhLY0lkhTE5LQugqAgSUInYeBCAJnhYpwACjTkyxBadk9pz8hkZNGW0ucTBrqUSVAAPnKUoUAABqSCicemARfP0s0DTSTDMya0vQIEDmJiaSMrJMzshzKbAsxUyybTrnMZsvu2zcJ7MGYcqZ1zTkTJ+c0v57TblXHuYReEjyVmgD6m8xs2ymJfPOekoFJzxmtkmaisZsywX5geU88RqywBEXecJHCdU6BnMxVctFIFrqrKhc8zpidF6MREJSiBuBmZygGCSC5Rzpk5LyQUzkyCEnUIQTKalxyxl2ADCUxeppyUmSpYCml2LshyqEbgIWxBsDwIpXylF6q2l2AACx4PBhoFABr6rSsFeWDAlCzxyo5sQFatIgA","body":"function make_javascript_number(n) {\n    return get(\"make\", \"javascript_number\")(n);\n} "}]},{"tag":"TEXT","id":"#p5","child":[{"body":"\n    Now that the framework of the generic arithmetic system is in place,\n    we can readily include new kinds of numbers.  Here is a package that\n    performs rational arithmetic.  Notice that, as a benefit of\n    additivity, we can use without modification the rational-number code\n    from section ","tag":"#text"},{"tag":"REF","body":"2.1.1","href":"/sicpjs/2.1.1"},{"body":" as the internal\n    functions\n    in the package:\n    ","tag":"#text"},{"tag":"SNIPPET","latex":false,"id":4,"eval":true,"prependLength":99,"program":"chap=4&prgrm=PTAEGUEkGEAVQFLlAJgHQFY0EYBQuRRIA7CAewFcAnAYwFMAaUAWzIGcAXUAMwuJo4BLMsTagAFgEMAbnVCSeggB50AJqGIVmAIzpVQZbvKoBzLXWIc2aAmAAUAFXFze-ISNAAbQZ1A-QHM4GxJ4AnqB0SvQADu7ETBxkAeL+bEncklRoAJS2oE4ufALCpJLR0WEA+oLElXyqemE1JpUAVjKSbDRUgrHynp5kAO5iFGKJeWUV4ZLE4SaCsqSuxR6uAUmSAxGedMwWVgZGgXKZZvuWoHnevmdsTJ1+x87hQ3pybHTRmZIcp6bmSxsXArOLycphOyuB6mNjZUAAb1woBRoCodA41FKENC1Vq9UaoWabQ6XR6sShfBhJjhAG5cABffCgkrg6aVEwWPSCGh2MjRalwxHI1E0ES+DihaJ0SocSQ00AAXhYZTskulsvlguy9NRoDFoi462VnI4fIFASlMrlNJ1IpR6MxVFIAEI-Gw6sQGtwampKcRcnqgyiAPxsqo1T0NKhNYgtdrSTrdXpm6Eq6J2A1-IHawPBvUALgiVCoZCodhuZv5CStmttDHt+aboAARMQkvtAmR1Nwy8k6J9LdKxABaEfh3Gc4jcmgtu1MkFFMGSVSqOxKJiheEItEYrETjlcnq8lsr1QtpiV9eb7I60ALlkeNgUbTX0BbxG7p3Y9lTmd2Ftn20C8vB8M0N3fW9aXvZkl1ZZgKE8N8Px3R19ymKo-2PACEM8ECrwgrc7wfOCPFURZkO3L90JxQ9p2wltyOkfCwMo4j8EIfk9F+EpNW0XYmGiCguFmdRTTybhS2YfUpFiPRQAAZlAOxPlWUgFLQDSFNyRc3FZTo0l5ABrOhQiYdExSoVQhSRPU0Odd1Kk0AY7AsstrLzZswwJH1p1URt8yLOgAEcKC2OwTLMiQ6BXOxnFityrLhW8AuDMN4rXRKPNSoMiwMshjNMhJJEEJCsuS+kSL0jxmEkEy+N2Oxt0bA1fEGGgtgauRlSvFsACo5X4ug+rnXVUUfUhBjIIyKAzSLKmwJh5pQZqm1arggMG3YlXkNhDIi0yFuK0qKwKzqtroKCcqeZSfCjOhfL9TbJCG29hWbVF7NIHzfVUMbgwZHZB1sj79XFLgsp2-LCtxFBjqQ57XrtUHqIcu6fr81y6Es1RPJRvVvK9B7fuu0GizlE6suR-MmT1WnxtI0gak+KgzXmxbQGWphE08ChLve-N1tARHtuVaGDtxDmKaQ9rzpe3YrqbQQjDsdGicetcRcu1bQc+DhNRO2XPC6ht8abb5BHLK92cEkryy50Aeb529TbN0HpdOjrjYu29qYBoG5BBj6hchsW9oKiXKjhgISoRl8fb95tlduj0Mb9KmdbNvWDbj7QLtdt3zbtuwLftw7o6dy74ZU+P5e1xOm0BuhPGB0n82zj2su5rZnf+5t6YBxsB54RnQHIthvg4GhxDsZhM6DL6WCVRVlRbKaZuiFs26DMN19m7fCyXlfV+ZvQOC3t2w1P1mD9RIKSzLWemBbPgjPbIZSC4qgeI8McY6G0aQ9GyL3HpPaelV8BCy-j-WoF0dq1XqhdJq9Ihamh2tAuIXUAJ703naIWQkuDKgwbxJBLZr7nztLpNS8gOBymnnWNUtYbRMCzAcGywC9wOVLowjUzCwaWDYfOKhYJ1TWnlHYVQvwtDz0XndbhkjMRz23ulGKa4FHSO3vfUs5Z1HMGftoFcMcTCcnULo0Af9RF1kAUyCa-DsxWAkVIueAsHScKZh6eRTi8b5jDB7XR3jgxaMfro-RhibQmLHk48x45WFAmsbBaqpATA0DXJIJg2gZFuNANoZeyoAAMoAwwKCLMktc2gHigAAKTZKEcI1kzM5QDEqN-OInVvg0CMvKOgTUXGgEIDUP4zotgj0ScCPUtjND7HLEoKii8MrrnYuM0eDR2zMAWZ+ReHsZnQWHrYhBMoWl2HiGPeeepUE7VKUcpguM+52Sydw0gYATDXL6aAEwiddmjzPM034lFel3O-CqeqhzJl6HWX1MeFgyBrI-AAag0OYcsH4IUrOhQsguhcgyorWTM0AKKoUwsVqiT5iThYvh+eBG8-zPpZP2RSo5iLwWQtWXYD845QVIvhPillMyMWYtRNiplgqiJ9xJdQ3C9LCKnJpYCulILGW4ohRy1l2Q+X8uZWixVGrCUfMbLYpikqqVBwXrSuqBzfnKq1cK1Vt9QaCq1cqkVQC9T9IEVQDI9ANi7l8IYfswtQicD2Hq0eNp1nGoBehWhkh6GhpbC0koWwQLbOdaiAhAEzwsU4ABeNIhE3PxzcQRNNqmx-MVAAPiMXYb5hypVEpRGmwCL5M1mjjTAvNrYC1FrVSiUtFbQ1AUNZBOtoAG24WbdmtteF82TrnN25SUqlR9vERKmtN5h0NqYuO1trSp0dpncW-MvbK0GtXUOxOo6zUgW3Qmqd10rknMXZWuVFrrm+z7ovRiIg6AtmglcKq4qzUUpvfe3GvTF6mhwpe6dO65wgdqQ0rYxtO3G3aZ0zkyDIHgzRNgeBgHkN2A5tpFBWGqAoFw8Cyddho4YEoWeVyHNSM6iAA","body":"function install_rational_package() {\n    // internal functions\n    function numer(x) { return head(x); }\n    function denom(x) { return tail(x); }\n    function make_rat(n, d) {\n        const g = gcd(n, d);\n        return pair(n / g, d / g);\n    }\n    function add_rat(x, y) {\n        return make_rat(numer(x) * denom(y) + numer(y) * denom(x),\n                        denom(x) * denom(y));\n    }\n    function sub_rat(x, y) {\n        return make_rat(numer(x) * denom(y) - numer(y) * denom(x),\n                        denom(x) * denom(y));\n    }\n    function mul_rat(x, y) {\n        return make_rat(numer(x) * numer(y),\n                        denom(x) * denom(y));\n    }\n    function div_rat(x, y) {\n        return make_rat(numer(x) * denom(y),\n                        denom(x) * numer(y));\n    }\n    // interface to rest of the system\n    function tag(x) {\n        return attach_tag(\"rational\", x);\n    }\n    put(\"add\", list(\"rational\", \"rational\"),\n        (x, y) => tag(add_rat(x, y)));\n    put(\"sub\", list(\"rational\", \"rational\"),\n        (x, y) => tag(sub_rat(x, y)));\n    put(\"mul\", list(\"rational\", \"rational\"),\n        (x, y) => tag(mul_rat(x, y)));\n    put(\"div\", list(\"rational\", \"rational\"),\n        (x, y) => tag(div_rat(x, y)));\n    put(\"make\", \"rational\",\n        (n, d) => tag(make_rat(n, d)));\n    return \"done\";  \n}\n\nfunction make_rational(n, d) {\n    return get(\"make\", \"rational\")(n, d);\n} "}]},{"tag":"TEXT","id":"#p6","child":[{"body":"\n    We can install a similar package to handle complex numbers, using the tag\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"\"complex\""},{"body":".\n    In creating the package, we extract from the table the operations\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"make_from_real_imag"},{"body":"\n    and\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"make_from_mag_ang"},{"body":"\n    that were defined by the rectangular and polar packages.  \n    \n    Additivity permits us to use, as the internal operations, the same\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"add_complex"},{"body":",\n      ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"sub_complex"},{"body":",\n      ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"mul_complex"},{"body":",\n      \n    and\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"div_complex"},{"body":"functions\n    from section ","tag":"#text"},{"tag":"REF","body":"2.4.1","href":"/sicpjs/2.4.1"},{"body":".\n    ","tag":"#text"},{"tag":"SNIPPET","latex":false,"id":5,"eval":true,"prependLength":168,"program":"chap=4&prgrm=PTAEGUEkGEAVQFLlAJgHQFY0EYBQuRRIA7CAewFcAnAYwFMAaUAWzIGcAXUAMwuJo4BLMsTagAFgEMAbnVCSeggB50AJqGIVmAIzpVQZbvKoBzLXWIc2aAmAAUAFXFze-ISNAAbQZ1A-QHM4GxJ4AnqB0SvQADu7ETBxkAeL+bEncklRoAJS2oE4ufALCpJLR0WEA+oLElXyqemE1JpUAVjKSbDRUgrHynp5kAO5iFGKJeWUV4ZLE4SaCsqSuxR6uAUmSAxGedMwWVgZGgXKZZvuWoHnevmdsTJ1+x87hQ3pybHTRmZIcp6bmSxsXArOLycphOyuB6mNjZUAAb1woBRoCodA41FKENC1Vq9UaoWabQ6XR6sShfBhJjhAG5cABffCgkrg6aVEwWPSCGh2MjRalwxHI1E0ES+DihaJ0SocSQ00AAXhYZTskulsvlguy9NRoDFoi462VnI4fIFASlMrlNJ1IpR6MxVFIAEI-Gw6sQGtwampKcRcnqgyiAPxsqo1T0NKhNYgtdrSTrdXpm6Eq6J2A1-IHawPBvUALgiVCoZCodhuZv5CStmttDHt+aboAARMQkvtAmR1Nwy8k6J9LdKxABaEfh3Gc4jcmgtu1MkFFMGSVSqOxKJiheEItEYrETjlcnq8lsr1QtpiV9eb7I60ALlkeNgUbTX0BbxG7p3Y9lTmd2Ftn20C8vB8M0N3fW9aXvZkl1ZZgKE8N8Px3R19ymKo-2PACEM8ECrwgrc7wfOCPFURZkO3L90JxQ9p2wltyOkfCwMo4jYLcVl0S2SpvioM0AC8qLQ50DywnkAO4zxeMyDgWM4OwhPYxdOI8QRmHlGT+MU4S91EjDJyPCSW3UzS+Lky9WKU6CSNU0gNJMYhBExBodM-ESf0woyTwcpyXLoeTBKgmCVNWUo412Ny9VQvTPMM+jjNmExdkCnS7z1BdCH5PRfhKTVtF2JhogoLhZnUU08m4UtmH1KRYj0UAAGZQDsT4wqatBGs63JQuXNg0l5ABrOhQiYdExSoVQhSRPUPPdSpNAGOxxrLKa82bMMCR9adVEbfMizoABHCgtjsYbRokOgVzsZxrpWya4VvPbgzDW613utbnqDItOgGs6RoSSRBCQj7HvpWz2o04b8si7dGwNXxBhoHi5QKuRlSvFsACpUd2LG511VFH1IQYyEGigM3OypsCYKmUDhpsEa4IDcfR+R+rIIaRupwHgYrTmUckNGoK+p4Wp8KM6G2v0WaF3Zb2FZtUTmrbfVUQngwZHZBxmpX9XFLgPqVdm-rp3mkNl4W7T16jRIl1WduWugJtUdabb1TavSltXRb1os5T5j7rfzJkMsbYm-FEPQzSpmnQDN0BE08Cg6AZ-MmdAS3dmN37Of+3E44DpCkcFq2NaDQQjDse2veltcs9TtOlc+DhNT5kvpNZht3abb5BHLK9Y6KoHywTpOU9vbue71ov+eRzu5cb4PNe1uRdaVjOjeVXOudxFBzdal9WZFm3K-Fj0Hb9IOm-dlu24to-F6n6fe5Huw+9H7n98TrYJ4PhvbzL2bFrOgngda+3zHfWeH0mDj1TuXJsocQ6NiQSiCO5E2DfA4DQcQdhmA31mrFFgSpFTKhbKTcm0QWwQKDGGChFMaGFmIaQshNRPj8WodPMMbDo6MNRAdEsZY8FMBbHwQa7YhikGylQXKHgxwBEXgTFBjY5oYKwTg8G+AM7SNkbUVmxsobWkXnYO0GdTTGx0XEGGdAAL0KoaYg2oBipcGVJYvKrMAI8I4XaXqrJfhyhwXWNUtYbRMCzAcaaKiiEf2CRqUJ+tLARPnL4jw6ojEmDsKoX4Wgb5zQljErJmJ8E0NeldNchSck0IEaWcsFTmAiO0CuBRJhOTqDqaAeRaS6xKKZBHcJQJMnZPwYrZWRD8lvzqW7fMYZZ6TKqcWGpgyikNKaTaVpoB2nyP6VYHpHF2psGOpkGxShclEKUKALGoAlCaJSaQNhcoBiVHGnKOMiFMgyRoINeUNib6EBqH8Z0WweCkVEOHEFu4eLmTcjFb8l1rpCRsmCuyfgHJaSCu5Ihs8EUwT1BHQxlQqpkGYE8q60lTIZMIrpWFMTKWItxeC3yzkKCuSEiM4Mc0NKBEqAc7SByTroidpC2SaVQAAGpM6HIFeStFaUgGoOBcipKkVWXryDBy344hKi-FmCgauqKoVCTGqSmV1llH0uRfiwlxLUVJWWg8AhozqVv30JczlmqxRsDsJIbIY0Lkqi5WwGoXqT6ogXHqP5iSqAZHoBsfsu5fCGDjWwUInA9hIvajadcVL0IcACZqzNLZnlJTeVQECJy6WomcZJY15lUqFudi8swnhMhziNUK-iQCq0mX1bJOtRbXnNtLT6lFZlZKdpKjheUflmUBUsgpetAhi2DtbSqRyTKGjjrNKeCKs7QLzv7U2ltw6lXwMbF2y11USU8XJSBBdjaS0XlFpRJUAA+ZpeDJDQytVeslDk2KbsnV+y9Nq4y3oPQ+5+QY7XyHhIqN9maL1EsqCBjJVB7UhodEQxiIgAo3PuVsaS4HB0fK+ZyEx9JbmR04AR3iZBiPfE+d8kxbLQARoBcQIFxNgTmshlO9dNiVW21IG9HSFa0HgpPdCoTCi+bYvlXiz9Mpv0oeg96jFTr+6qfYjxsEUkTUOsw7Cxl-k3Kuo1ZUD1Xqd1pXLvJ8F0qDUGek8Zmdpn-WasDcQKzyUBMYZxUTBlimCWXr0+S59qrCEafLG67lh1eWSuOfCcVfKjl2CIpBl+MXtXEF1RdE5cr8DhrAP8vQ0a5CJDjeiBNzwPgpr+MwdNYJM0nPUzmvNQSWzRDoy2pg5b-Moi7Xp2tc6t1deXcOobY7y5doc72kbAExtHqYLNjt02J0thcw0Oti2h1ME26evUXaT3be67t+QO6AMbaC9+0LDlb07ZAk+ylr732IeJbd+U-61tbre8hzSSV7uncfU2LTL2EPXeA-9uMWm-NzWw9OFseHDQ0Z2yRpjPiI74ceWKZgFRIho7I784ruOyx-B7CCsQVrdyLoHZkc76gdtOMkIxzk3GAsWoh0hj7FKbwsci-uU0gGlMheNTekRRGj2UVs41+CnPrVQ9Q-avnjqBcYiF8FpDKHAfja09Lorkd2OcYpzLjwZ4LNErx0oRSccBL02V4Z-cv3ueCukga7ASWIWu+Fbbn1fCX7BhW4Jd3YqR0tANfTArOnWRAXN7j3YVuBI27txFlXoknei7-ZN7Sif4Tjiz4JemGX-fu0D9b3PoeTUR71+zyGiFY+W+t0wH39vnNy7+y0W1+2y9+q7z7ovxfmySZzyHofVezU17BExev8fG+gGbynh3ae28qd78HsAvfC9+4H0P4P45R9+flWx0rzPytJCq1wRNJxM51bTVH1Jn3BNzX8cz-Nn2Ww48tyBOTZ71tnjrR-+PW9AAyIFdJ9RPJvO3ODd9M3YAhPJPQBb7ACICf-C3QAkRWA0AkHcAufSA+DT7GPWA2fH3Pzc9RCFAuPEA9A1AkA4dMA+AsHT7XCafSIIgiPS7Jicgz-KgigpQTA-MVg2DPAjJKfQg7A4gy7dPa9O7bgrgq4EHZ7KA8HIDLnDPT7SlEg9bX7LXGQtAuQ-gtDGDBgjJLQhXGHIBOHVQHDRHPURkfALHaSWAgnH5WkIAA","body":"function install_complex_package() {\n    // imported functions from rectangular and polar packages\n    function make_from_real_imag(x, y) {\n        return get(\"make_from_real_imag\", \"rectangular\")(x, y);\n    }\n    function make_from_mag_ang(r, a) {\n        return get(\"make_from_mag_ang\", \"polar\")(r, a);\n    }\n    // internal functions\n    function add_complex(z1, z2) {\n        return make_from_real_imag(real_part(z1) + real_part(z2),\n                                   imag_part(z1) + imag_part(z2));\n    }\n    function sub_complex(z1, z2) {\n        return make_from_real_imag(real_part(z1) - real_part(z2),\n                                   imag_part(z1) - imag_part(z2));\n    }\n    function mul_complex(z1, z2) {\n        return make_from_mag_ang(magnitude(z1) * magnitude(z2),\n                                 angle(z1) + angle(z2));\n    }\n    function div_complex(z1, z2) {\n        return make_from_mag_ang(magnitude(z1) / magnitude(z2),\n                                 angle(z1) - angle(z2));\n    }\n    // interface to rest of the system\n    function tag(z) { return attach_tag(\"complex\", z); }\n    put(\"add\", list(\"complex\", \"complex\"), \n        (z1, z2) => tag(add_complex(z1, z2)));\n    put(\"sub\", list(\"complex\", \"complex\"), \n        (z1, z2) => tag(sub_complex(z1, z2)));\n    put(\"mul\", list(\"complex\", \"complex\"), \n        (z1, z2) => tag(mul_complex(z1, z2)));\n    put(\"div\", list(\"complex\", \"complex\"), \n        (z1, z2) => tag(div_complex(z1, z2)));\n    put(\"make_from_real_imag\", \"complex\", \n        (x, y) => tag(make_from_real_imag(x, y)));\n    put(\"make_from_mag_ang\", \"complex\", \n        (r, a) => tag(make_from_mag_ang(r, a)));\n    return \"done\";    \n} "}]},{"tag":"TEXT","id":"#p7","child":[{"body":"\n    Programs outside the complex-number package can construct complex\n    numbers either from real and imaginary parts or from magnitudes and\n    angles.  Notice how the underlying\n    functions,\n    originally defined in the rectangular and polar packages, are exported to\n    the complex package, and exported from there to the outside world.\n    ","tag":"#text"},{"tag":"SNIPPET","latex":false,"id":6,"eval":true,"prependLength":212,"program":"chap=4&prgrm=PTAEGUEkGEAVQFLlAJgHQFY0EYBQuRRIA7CAewFcAnAYwFMAaUAWzIGcAXUAMwuJo4BLMsTagAFgEMAbnVCSeggB50AJqGIVmAIzpVQZbvKoBzLXWIc2aAmAAUAFXFze-ISNAAbQZ1A-QHM4GxJ4AnqB0SvQADu7ETBxkAeL+bEncklRoAJS2oE4ufALCpJLR0WEA+oLElXyqemE1JpUAVjKSbDRUgrHynp5kAO5iFGKJeWUV4ZLE4SaCsqSuxR6uAUmSAxGedMwWVgZGgXKZZvuWoHnevmdsTJ1+x87hQ3pybHTRmZIcp6bmSxsXArOLycphOyuB6mNjZUAAb1woBRoCodA41FKENC1Vq9UaoWabQ6XR6sShfBhJjhAG5cABffCgkrg6aVEwWPSCGh2MjRalwxHI1E0ES+DihaJ0SocSQ00AAXhYZTskulsvlguy9NRoDFoi462VnI4fIFASlMrlNJ1IpR6MxVFIAEI-Gw6sQGtwampKcRcnqgyiAPxsqo1T0NKhNYgtdrSTrdXpm6Eq6J2A1-IHawPBvUALgiVCoZCodhuZv5CStmttDHt+aboAARMQkvtAmR1Nwy8k6J9LdKxABaEfh3Gc4jcmgtu1MkFFMGSVSqOxKJiheEItEYrETjlcnq8lsr1QtpiV9eb7I60ALlkeNgUbTX0BbxG7p3Y9lTmd2Ftn20C8vB8M0N3fW9aXvZkl1ZZgKE8N8Px3R19ymKo-2PACEM8ECrwgrc7wfOCPFURZkO3L90JxQ9p2wltyOkfCwMo4jYLcVl0S2SpvioM0AC8qLQ50DywnkAO4zxeMyDgWM4OwhPYxdOI8QRmHlGT+MU4S91EjDJyPCSW3UzS+Lky9WKU6CSNU0gNJMYhBExBodM-ESf0woyTwcpyXLoeTBKgmCVNWUo412Ny9VQvTPMM+jjNmExdkCnS7z1BdCH5PRfhKTVtF2JhogoLhZnUU08m4UtmH1KRYj0UAAGZQDsT4wqatBGs63JQuXNg0l5ABrOhQiYdExSoVQhSRPUPPdSpNAGOxxrLKa82bMMCR9adVEbfMizoABHCgtjsYbRokOgVzsZxrpWya4VvPbgzDW613utbnqDItOgGs6RoSSRBCQj7HvpWz2o04b8si7dGwNXxBhoHi5QKuRlSvFsACpUd2LG511VFH1IQYyEGigM3OypsCYKmUDhpsEa4IDcfR+R+rIIaRupwHgYrTmUckNGoK+p4Wp8KM6G2v0WaF3Zb2FZtUTmrbfVUQngwZHZBxmpX9XFLgPqVdm-rp3mkNl4W7T16jRIl1WduWugJtUdabb1TavSltXRb1os5T5j7rfzJkMsbYm-FEPQzSpmnQDN0BE08Cg6AZ-MmdAS3dmN37Of+3E44DpCkcFq2NaDQQjDse2veltcs9TtOlc+DhNT5kvpNZht3abb5BHLK9Y6KoHywTpOU9vbue71ov+eRzu5cb4PNe1uRdaVjOjeVXOudxFBzdal9WZFm3K-Fj0Hb9IOm-dlu24to-F6n6fe5Huw+9H7n98TrYJ4PhvbzL2bFrOgngda+3zHfWeH0mDj1TuXJsocQ6NiQSiCO5E2DfA4DQcQdhmA31mrFFgSpFTKhbKTcm0QWwQKDGGChFMaGFmIaQshNRPj8WodPMMbDo6MNRAdEsZY8FMBbHwQa7YhikGylQXKHgxwBEXgTFBjY5oYKwTg8G+AM7SNkbUVmxsobWkXnYO0GdTTGx0XEGGdAAL0KoaYg2oBipcGVJYvKrMAI8I4XaXqrJfhyhwXWNUtYbRMCzAcaaKiiEf2CRqUJ+tLARPnL4jw6ojEmDsKoX4Wgb5zQljErJmJ8E0NeldNchSck0IEaWcsFTmAiO0CuBRJhOTqDqaAeRaS6xKKZBHcJQJMnZPwYrZWRD8lvzqW7fMYZZ6TKqcWGpgyikNKaTaVpoB2nyP6VYHpHF2psGOpkGxShclEKUKALGoAlCaJSaQNhcoBiVHGnKOMiFMgyRoINeUNib6EBqH8Z0WweCkVEOHEFu4eLmTcjFb8l1rpCRsmCuyfgHJaSCu5Ihs8EUwT1BHQxlQqpkGYE8q60lTIZMIrpWFMTKWItxeC3yzkKCuSEiM4Mc0NKBEqAc7SByTroidpC2SaVQAAGpM6HIFeStFaUgGoOBcipKkVWXryDBy344hKi-FmCgauqKoVCTGqSmV1llH0uRfiwlxLUVJWWg8AhozqVv30JczlmqxRsDsJIbIY0Lkqi5WwGoXqT6ogXHqP5iSqAZHoBsfsu5fCGDjWwUInA9hIvajadcVL0IcACZqzNLZnlJTeVQECJy6WomcZJY15lUqFudi8swnhMhziNUK-iQCq0mX1bJOtRbXnNtLT6lFZlZKdpKjheUflmUBUsgpetAhi2DtbSqRyTKGjjrNKeCKs7QLzv7U2ltw6lXwMbF2y11USU8XJSBBdjaS0XlFpRJUAA+ZpeDJDQytVeslDk2KbsnV+y9Nq4y3oPQ+5+QY7XyHhIqN9maL1EsqCBjJVB7UhodEQxiIgAo3PuVsaS4HB0fK+ZyEx9JbmR04AR3iZBiPfE+d8kxbLQARoBcQIFxNgTmshlO9dNiVW21IG9HSFa0HgpPdCoTCi+bYvlXiz9Mpv0oeg96jFTr+6qfYjxsEUkTUOsw7Cxl-k3Kuo1ZUD1Xqd1pXLvJ8F0qDUGek8Zmdpn-WasDcQKzyUBMYZxUTBlimCWXr0+S59qrCEafLG67lh1eWSuOfCcVfKjl2CIpBl+MXtXEF1RdE5cr8DhrAP8vQ0a5CJDjeiBNzwPgpr+MwdNYJM0nPUzmvNQSWzRDoy2pg5b-Moi7Xp2tc6t1deXcOobY7y5doc72kbAExtHqYLNjt02J0thcw0Oti2h1ME26evUXaT3be67t+QO6AMbaC9+0LDlb07ZAk+ylr732IeJbd+U-61tbre8hzSSV7uncfU2LTL2EPXeA-9uMWm-NzWw9OFseHDQ0Z2yRpjPiI74ceWKZgFRIho7I784ruOyx-B7CCsQVrdyLoHZkc76gdtOMkIxzk3GAsWoh0hj7FKbwsci-uU0gGlMheNTekRRGj2UVs41+CnPrVQ9Q-avnjqBcYiF8FpDKHAfja09Lorkd2OcYpzLjwZ4LNErx0oRSccBL02V4Z-cv3ueCukga7ASWIWu+Fbbn1fCX7BhW4Jd3YqR0tANfTArOnWRAXN7j3YVuBI27txFlXoknei7-ZN7Sif4Tjiz4JemGX-fu0D9b3PoeTUR71+zyGiFY+W+t0wH39vnNy7+y0W1+2y9+q7z7ovxfmySZzyHofVezU17BExev8fG+gGbynh3ae28qd78HsAvfC9+4H0P4P45R9+flWx0rzPytJCq1wRNJxM51bTVH1Jn3BNzX8cz-Nn2Ww48tyBOTZ71tnjrR-+PW9AAyIFdJ9RPJvO3ODd9M3YAhPJPQBb7ACICf-C3QAkRWA0AkHcAufSA+DT7GPWA2fH3Pzc9RCFAuPEA9A1AkA4dMA+AsHT7XCafSIIgiPS7Jicgz-KgigpQTA-MVg2DPAjJKfQg7A4gy7dPa9O7bgrgq4EHZ7KA8HIDLnDPT7SlEg9bX7LXGQtAuQ-gtDGDBgjJLQhXGHIBOHVQHDRHPURkfALHaSWAgnH5CjBTaGRwm7VQnnSCdeOaQXK7ZQ97TwoA6g3g7IKXWw1wmUdwyHDvaHAw71HwohPwkw2IkwYIngucXXWw3ATeAxILaIlQqQz7AAFiYEagcUNCcTyLcJCI13l1SLsAwCYAAAZMAfEzxoNoh0oURCAqtEJDgah5B9YeCNAtBdB9BBiJd9AxRVoahfgBw8hcJOi7xeiBx+ixBBiFBYDRidAGpBjGcZjJo5i-g2AgA","body":"function make_complex_from_real_imag(x, y){\n   return get(\"make_from_real_imag\", \"complex\")(x, y);\n}\nfunction make_complex_from_mag_ang(r, a){\n   return get(\"make_from_mag_ang\", \"complex\")(r, a);\n} "}]},{"tag":"TEXT","id":"#p8","child":[{"body":"\n    What we have here is a\n    \n    two-level tag system.  A typical complex number,\n    such as ","tag":"#text"},{"body":"$3+4i$","tag":"LATEX"},{"body":" in rectangular form, would be\n    represented as shown in\n    \n\tfigure ","tag":"#text"},{"tag":"REF","body":"2.24","href":"/sicpjs/2.5.1#fig-2.24"},{"body":".\n      \n      The outer tag\n    (","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"\"complex\""},{"body":")\n    is used to direct the number to the complex package.  Once within the\n    complex package, the next tag\n    (","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"\"rectangular\""},{"body":")\n      \n    is used to direct the number to the rectangular package. In a large and\n    complicated system there might be many levels, each interfaced with the\n    next by means of generic operations.  As a data object is passed\n    \"","tag":"#text"},{"body":"downward,","tag":"#text"},{"body":"\" the outer tag that is used to direct it to the\n    appropriate package is stripped off (by applying\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"contents"},{"body":") and the next level of tag (if any)\n    becomes visible to be used for further dispatching.\n    ","tag":"#text"},{"tag":"FIGURE","scale":"70%","src":"img_javascript/ch2-Z-G-65.svg","id":"#fig-2.24","captionHref":"/sicpjs/2.5.1#fig-2.24","captionName":"Figure 2.24 ","captionBody":[{"body":"\n\t    Representation of ","tag":"#text"},{"body":"$3+4i$","tag":"LATEX"},{"body":" in\n\t    rectangular form.\n\t  ","tag":"#text"}]}]},{"tag":"TEXT","id":"#p9","child":[{"body":"\n    In the above packages, we used\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"add_rat"},{"body":",","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"add_complex"},{"body":",\n    \n    and the other arithmetic\n    functions\n    exactly as originally written. Once these declarations are internal to\n    different installation\n    functions,\n    however, they no longer need names that are distinct from each other:\n    we could simply name them ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"add"},{"body":",\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"sub"},{"body":", ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"mul"},{"body":", and\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"div"},{"body":" in both packages.\n  ","tag":"#text"}]},{"tag":"EXERCISE","title":"Exercise 2.77","id":"#ex-2.77","child":[{"body":" \n    Louis Reasoner tries to evaluate the expression\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"magnitude(z)"},{"body":"\n    where\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"z"},{"body":" is the object shown in\n    \n\tfigure ","tag":"#text"},{"tag":"REF","body":"2.24","href":"/sicpjs/2.5.1#fig-2.24"},{"body":".\n      \n    To his surprise, instead of the answer ","tag":"#text"},{"body":"$5$","tag":"LATEX"},{"body":"\n    he gets an error message from\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"apply_generic"},{"body":",\n      \n    saying there is no method for the operation\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"magnitude"},{"body":" on the types\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"list(\"complex\")"},{"body":".\n      \n    He shows this interaction to Alyssa P. Hacker, who says \"","tag":"#text"},{"body":"The problem\n    is that the complex-number selectors were never defined for\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"\"complex\""},{"body":"\n    numbers, just for\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"\"polar\""},{"body":"\n    and\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"\"rectangular\""},{"body":"\n    numbers.  All you have to do to make this work is add the following to the\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"complex"},{"body":" package:","tag":"#text"},{"body":"\"","tag":"#text"},{"tag":"SNIPPET","latex":false,"id":7,"eval":true,"prependLength":219,"program":"chap=4&prgrm=PTAEGUEkGEAVQFLlAJgHQFY0EYBQuRRIA7CAewFcAnAYwFMAaUAWzIGcAXUAMwuJo4BLMsTagAFgEMAbnVCSeggB50AJqGIVmAIzpVQZbvKoBzLXWIc2aAmAAUAFXFze-ISNAAbQZ1A-QHM4GxJ4AnqB0SvQADu7ETBxkAeL+bEncklRoAJS2oE4ufALCpJLR0WEA+oLElXyqemE1JpUAVjKSbDRUgrHynp5kAO5iFGKJeWUV4ZLE4SaCsqSuxR6uAUmSAxGedMwWVgZGgXKZZvuWoHnevmdsTJ1+x87hQ3pybHTRmZIcp6bmSxsXArOLycphOyuB6mNjZUAAb1woBRoCodA41FKENC1Vq9UaoWabQ6XR6sShfBhJjhAG5cABffCgkrg6aVEwWPSCGh2MjRalwxHI1E0ES+DihaJ0SocSQ00AAXhYZTskulsvlguy9NRoDFoi462VnI4fIFASlMrlNJ1IpR6MxVFIAEI-Gw6sQGtwampKcRcnqgyiAPxsqo1T0NKhNYgtdrSTrdXpm6Eq6J2A1-IHawPBvUALgiVCoZCodhuZv5CStmttDHt+aboAARMQkvtAmR1Nwy8k6J9LdKxABaEfh3Gc4jcmgtu1MkFFMGSVSqOxKJiheEItEYrETjlcnq8lsr1QtpiV9eb7I60ALlkeNgUbTX0BbxG7p3Y9lTmd2Ftn20C8vB8M0N3fW9aXvZkl1ZZgKE8N8Px3R19ymKo-2PACEM8ECrwgrc7wfOCPFURZkO3L90JxQ9p2wltyOkfCwMo4jYLcVl0S2SpvioM0AC8qLQ50DywnkAO4zxeMyDgWM4OwhPYxdOI8QRmHlGT+MU4S91EjDJyPCSW3UzS+Lky9WKU6CSNU0gNJMYhBExBodM-ESf0woyTwcpyXLoeTBKgmCVNWUo412Ny9VQvTPMM+jjNmExdkCnS7z1BdCH5PRfhKTVtF2JhogoLhZnUU08m4UtmH1KRYj0UAAGZQDsT4wqatBGs63JQuXNg0l5ABrOhQiYdExSoVQhSRPUPPdSpNAGOxxrLKa82bMMCR9adVEbfMizoABHCgtjsYbRokOgVzsZxrpWya4VvPbgzDW613utbnqDItOgGs6RoSSRBCQj7HvpWz2o04b8si7dGwNXxBhoHi5QKuRlSvFsACpUd2LG511VFH1IQYyEGigM3OypsCYKmUDhpsEa4IDcfR+R+rIIaRupwHgYrTmUckNGoK+p4Wp8KM6G2v0WaF3Zb2FZtUTmrbfVUQngwZHZBxmpX9XFLgPqVdm-rp3mkNl4W7T16jRIl1WduWugJtUdabb1TavSltXRb1os5T5j7rfzJkMsbYm-FEPQzSpmnQDN0BE08Cg6AZ-MmdAS3dmN37Of+3E44DpCkcFq2NaDQQjDse2veltcs9TtOlc+DhNT5kvpNZht3abb5BHLK9Y6KoHywTpOU9vbue71ov+eRzu5cb4PNe1uRdaVjOjeVXOudxFBzdal9WZFm3K-Fj0Hb9IOm-dlu24to-F6n6fe5Huw+9H7n98TrYJ4PhvbzL2bFrOgngda+3zHfWeH0mDj1TuXJsocQ6NiQSiCO5E2DfA4DQcQdhmA31mrFFgSpFTKhbKTcm0QWwQKDGGChFMaGFmIaQshNRPj8WodPMMbDo6MNRAdEsZY8FMBbHwQa7YhikGylQXKHgxwBEXgTFBjY5oYKwTg8G+AM7SNkbUVmxsobWkXnYO0GdTTGx0XEGGdAAL0KoaYg2oBipcGVJYvKrMAI8I4XaXqrJfhyhwXWNUtYbRMCzAcaaKiiEf2CRqUJ+tLARPnL4jw6ojEmDsKoX4Wgb5zQljErJmJ8E0NeldNchSck0IEaWcsFTmAiO0CuBRJhOTqDqaAeRaS6xKKZBHcJQJMnZPwYrZWRD8lvzqW7fMYZZ6TKqcWGpgyikNKaTaVpoB2nyP6VYHpHF2psGOpkGxShclEKUKALGoAlCaJSaQNhcoBiVHGnKOMiFMgyRoINeUNib6EBqH8Z0WweCkVEOHEFu4eLmTcjFb8l1rpCRsmCuyfgHJaSCu5Ihs8EUwT1BHQxlQqpkGYE8q60lTIZMIrpWFMTKWItxeC3yzkKCuSEiM4Mc0NKBEqAc7SByTroidpC2SaVQAAGpM6HIFeStFaUgGoOBcipKkVWXryDBy344hKi-FmCgauqKoVCTGqSmV1llH0uRfiwlxLUVJWWg8AhozqVv30JczlmqxRsDsJIbIY0Lkqi5WwGoXqT6ogXHqP5iSqAZHoBsfsu5fCGDjWwUInA9hIvajadcVL0IcACZqzNLZnlJTeVQECJy6WomcZJY15lUqFudi8swnhMhziNUK-iQCq0mX1bJOtRbXnNtLT6lFZlZKdpKjheUflmUBUsgpetAhi2DtbSqRyTKGjjrNKeCKs7QLzv7U2ltw6lXwMbF2y11USU8XJSBBdjaS0XlFpRJUAA+ZpeDJDQytVeslDk2KbsnV+y9Nq4y3oPQ+5+QY7XyHhIqN9maL1EsqCBjJVB7UhodEQxiIgAo3PuVsaS4HB0fK+ZyEx9JbmR04AR3iZBiPfE+d8kxbLQARoBcQIFxNgTmshlO9dNiVW21IG9HSFa0HgpPdCoTCi+bYvlXiz9Mpv0oeg96jFTr+6qfYjxsEUkTUOsw7Cxl-k3Kuo1ZUD1Xqd1pXLvJ8F0qDUGek8Zmdpn-WasDcQKzyUBMYZxUTBlimCWXr0+S59qrCEafLG67lh1eWSuOfCcVfKjl2CIpBl+MXtXEF1RdE5cr8DhrAP8vQ0a5CJDjeiBNzwPgpr+MwdNYJM0nPUzmvNQSWzRDoy2pg5b-Moi7Xp2tc6t1deXcOobY7y5doc72kbAExtHqYLNjt02J0thcw0Oti2h1ME26evUXaT3be67t+QO6AMbaC9+0LDlb07ZAk+ylr732IeJbd+U-61tbre8hzSSV7uncfU2LTL2EPXeA-9uMWm-NzWw9OFseHDQ0Z2yRpjPiI74ceWKZgFRIho7I784ruOyx-B7CCsQVrdyLoHZkc76gdtOMkIxzk3GAsWoh0hj7FKbwsci-uU0gGlMheNTekRRGj2UVs41+CnPrVQ9Q-avnjqBcYiF8FpDKHAfja09Lorkd2OcYpzLjwZ4LNErx0oRSccBL02V4Z-cv3ueCukga7ASWIWu+Fbbn1fCX7BhW4Jd3YqR0tANfTArOnWRAXN7j3YVuBI27txFlXoknei7-ZN7Sif4Tjiz4JemGX-fu0D9b3PoeTUR71+zyGiFY+W+t0wH39vnNy7+y0W1+2y9+q7z7ovxfmySZzyHofVezU17BExev8fG+gGbynh3ae28qd78HsAvfC9+4H0P4P45R9+flWx0rzPytJCq1wRNJxM51bTVH1Jn3BNzX8cz-Nn2Ww48tyBOTZ71tnjrR-+PW9AAyIFdJ9RPJvO3ODd9M3YAhPJPQBb7ACICf-C3QAkRWA0AkHcAufSA+DT7GPWA2fH3Pzc9RCFAuPEA9A1AkA4dMA+AsHT7XCafSIIgiPS7Jicgz-KgigpQTA-MVg2DPAjJKfQg7A4gy7dPa9O7bgrgq4EHZ7KA8HIDLnDPT7SlEg9bX7LXGQtAuQ-gtDGDBgjJLQhXGHIBOHVQHDRHPURkfALHaSWAgnH5CjBTaGRwm7VQnnSCdeOaQXK7ZQ97TwoA6g3g7IKXWw1wmUdwyHDvaHAw71HwohPwkw2IkwYIngucXXWw3AQbGtObPdLdDAibPI1bHI9bQPTgwA4dQPO0c9PjfySomgvbeomdWo3-HdECPUTGIoh4C7CjDOASAxILaIlQqQz7RqJgAAFh8V7x1CAA","body":"put(\"real_part\", list(\"complex\"), real_part);\nput(\"imag_part\", list(\"complex\"), imag_part);\nput(\"magnitude\", list(\"complex\"), magnitude);\nput(\"angle\",     list(\"complex\"), angle); "},{"body":"\n    Describe in detail why this works.  As an example, trace through all the\n    functions\n    called in evaluating the expression\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"magnitude(z)"},{"body":"\n    where ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"z"},{"body":" is the object shown in\n    \n\tfigure ","tag":"#text"},{"tag":"REF","body":"2.24","href":"/sicpjs/2.5.1#fig-2.24"},{"body":".\n      \n    In particular, how many times is\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"apply_generic"},{"body":"\n    invoked?  What\n    function\n    is dispatched to in each case?\n    ","tag":"#text"}],"solution":[{"body":"\n      Putting the above lines to the package will open up\n      ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"z"},{"body":", and those lines act as a pass-through.\n      ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"apply_generic"},{"body":"\n      will be invoked twice. We shall trace with substitution model how the\n      program evaluates.\n      ","tag":"#text"},{"tag":"SNIPPET","latex":false,"id":8,"eval":false,"body":"magnitude(z);\napply_generic(\"magnitude\", list(z));\n// In this case:\n// type_tags = map(type_tag, list(z))\n// Which evaluates to:\n// type_tags = list(\"complex\");\n// and\n// fun = get(\"magnitude\", list(\"complex\"));\n// which, due to the addition of\n// put(\"magnitude\", list(\"complex\"), magnitude);\n// fun = magnitude;\napply(magnitude, map(contents, list(z)));\napply(magnitude, pair(\"rectangular\", pair(3, 4)));\nmagnitude(pair(\"rectangular\"), pair(3, 4));\napply_generic(\"magnitude\", list(pair(\"rectangular\"), pair(3, 4)));\n// type_tags = map(type_tag, list(z)) evaluates to list(\"rectangular\")\n// fun = get(\"magnitude\", list(\"rectangular\")) which evaluates to\n// z => math_sqrt(square(real_part(z)) + square(imag_part(z)))\n// z => math_sqrt(square(head(z)) + square(tail(z)))\napply(fun, map(contents, list(pair(\"rectangular\"), pair(3, 4))))\napply(fun, pair(3, 4))\n(z => math_sqrt(square(head(z)) + square(tail(z))))(pair(3, 4));\nmath_sqrt(square(head(pair(3, 4))) + square(tail(pair(3, 4))))\n...\nmath_sqrt(square(3) + square(4));\n...\nmath_sqrt(9 + 16);\nmath_sqrt(25);\n5"}]},{"tag":"EXERCISE","title":"Exercise 2.78","id":"#ex-2.78","child":[{"body":" \n    The internal\n    functions\n    in the\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"javascript_number"},{"body":"\n    package are essentially nothing more than calls to the primitive\n    functions","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"+"},{"body":", ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"-"},{"body":", etc.  It\n    was not possible to use the primitives of the language directly because our\n    type-tag system requires that each data object have a type attached to it.\n    In fact, however, all\n    JavaScript\n    implementations do have a type system, which they use internally. Primitive\n    predicates such as\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"is_string"},{"body":"\n    and\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"is_number"},{"body":"\n    determine whether data objects have particular types.  Modify the\n    definitions of\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"type_tag"},{"body":",","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"contents"},{"body":", and\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"attach_tag"},{"body":"\n    from section ","tag":"#text"},{"tag":"REF","body":"2.4.2","href":"/sicpjs/2.4.2"},{"body":" so that our generic\n    system takes advantage of\n    JavaScript's\n    internal type system.  That is to say, the system should work as before\n    except that ordinary numbers should be represented simply as\n    JavaScript\n    numbers rather than as pairs whose\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"head"},{"body":"\n    is the\n    \n\tstring ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"\"javascript_number\""},{"body":".\n      ","tag":"#text"}],"solution":[{"body":"\n      The following modifications will take advantage of the JavaScript number\n      implementation:\n      ","tag":"#text"},{"tag":"SNIPPET","latex":false,"id":9,"eval":true,"prependLength":0,"program":"chap=2&prgrm=PTAEGUEkGEAVQFLlAJgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AQwoobIAsB9FgcwAoKAngAcAplwbcANKDJ0KIkhQDOASlABvXKFAAnERSI76VJRxJEAtgCMRO3rMULlardtAB+UEIZU7AIgArBgA3BiUyHSohCjNLGx0-aQd5RVVXbQAuLx87QVFxKRk5J1UAblwAX0JSSlp6PLEeXgATJks1TW09AyNQE1jrWxa2ixV0j1BAkLCIqJjzQYTxrP7vX2GDUfHtTzYRBmaN9u3QLNsdGjtWzek-KwPQHm4RZtBry1AAWk-H4UaJPwqcpVYjkah0IqOVJHUYaVzdQzGUwLeIwsZuCbvCzLPqmNZXEbojETFhUAA2aJOZx0FwJN0m91eTxebxGXx+yRKgOBQA","body":"function attach_tag(type_tag, contents) {\n  return is_number(contents) \n    ? pair(\"javascript_number\", contents)\n    : pair(type_tag, contents);\n}\nfunction type_tag(datum) {\n  return is_number(datum)\n    ? \"javascript_number\"\n    : is_pair(datum)\n      ? head(datum)\n      : error(datum, \"bad tagged datum -- type_tag\");\n}\nfunction contents(datum) {\n  return is_number(datum)\n    ? datum\n    : is_pair(datum)\n      ? tail(datum)\n      : error(datum, \"bad tagged datum -- contents\");\n} "}]},{"tag":"EXERCISE","title":"Exercise 2.79","id":"#ex-2.79","child":[{"body":" \n    Define a generic equality predicate\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"is_equal"},{"body":"\n    that tests the equality of two numbers, and install it in the generic\n    arithmetic package.  This operation should work for ordinary numbers,\n    rational numbers, and complex numbers.\n    ","tag":"#text"}],"solution":[{"tag":"SNIPPET","latex":false,"id":10,"eval":false,"body":"// provided by GitHub user clean99\n\nfunction is_equal(x, y) {\n    return apply_generic(\"is_equal\", list(x, y));\n}\n\nfunction install_javascript_number_package() {\n    // ...\n\n    put(\"is_equal\", list(\"javascript_number\", \"javascript_number\"),\n           (x, y) => x === y);\n\n    // ...\n}\n\nfunction install_rational_package() {\n    // ...\n\n    function is_equal(x, y) {\n        return numer(x) * denom(y) === numer(y) * denom(x);\n    }\n\n    put(\"is_equal\", list(\"rational\", \"rational\"), is_equal);\n\n    // ...\n}\n\nfunction install_complex_package() {\n    // ...\n\n    function is_equal(z1, z2) {\n        return real_part(z1) === real_part(z2)\n               ? imag_part(z1) === imag_part(z2)\n               : false;\n    }\n\n    put(\"is_equal\", list(\"complex\", \"complex\"),\n            is_equal);\n\n    //...\n}"}]},{"tag":"EXERCISE","title":"Exercise 2.80","id":"#ex-2.80","child":[{"body":"\n    Define a generic predicate\n    ","tag":"#text"},{"tag":"JAVASCRIPTINLINE","body":"is_equal_to_zero"},{"body":"\n    that tests if its argument is zero, and install it in the generic\n    arithmetic package.  This operation should work for ordinary numbers,\n    rational numbers, and complex numbers.\n    ","tag":"#text"}],"solution":[{"tag":"SNIPPET","latex":false,"id":11,"eval":false,"body":"// provided by GitHub user clean99\n\nfunction is_equal_to_zero(x) {\n    return apply_generic(\"is_equal_to_zero\", list(x));\n}\n\nfunction install_javascript_number_package() {\n    // ...\n\n    put(\"is_equal_to_zero\", \"javascript_number\",\n          x => x === 0);\n\n    // ...\n}\n\nfunction install_rational_package() {\n    // ...\n\n    function is_equal_to_zero(x) {\n        return numer(x) === 0;\n    }\n\n    put(\"is_equal_to_zero\", \"rational\",\n           is_equal_to_zero);\n\n    // ...\n}\n\nfunction install_complex_package() {\n    // ...\n\n    function is_equal_to_zero(z) {\n        return real_part(z) === 0\n               ? imag_part(z) === 0\n               : false;\n    }\n\n    put(\"is_equal_to_zero\", \"complex\",\n            is_equal_to_zero);\n\n    //...\n}"}]}]