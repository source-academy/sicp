<!DOCTYPE html>
<html lang="en">
  <head>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-156801664-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-156801664-1');
</script>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="2.2.3 
        Sequences as Conventional Interfaces
      " />
    <title>
         2.2.3 
        Sequences as Conventional Interfaces
      
    </title>

    <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="AkH9nZROfXp+ewTKYBT2kT09U++ozwAggsGckEsT95jeF06m8yXDrZQluajO9rY2iV0ly02tOzBEpc19aevGjQ==" />

    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata&display?swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans|Droid+Serif" rel="stylesheet">
    <link rel="stylesheet" media="all" href="../assets/application-f313219f7bd4d132a6fd02c8f84b86f62781f5d155b9681036fc6390c9f3d06c.css" />

   <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon-17dbf972938cc63d48794e3be2c66977e723014f9a9518097da971fb34202187.ico" />

<!--    <link rel="shortcut icon" type="image/png" href="/images/lambda.png" /> -->

    <!-- for support of progressive web app, see github README -->
    <link rel="manifest" href="../static/manifest.json">

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" 
		     	  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	          crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script> -->
    <script type="text/javascript" 
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-AMS-MML_HTMLorMML-full">
    </script>
   <!--  <script type="text/javascript" 
      src="../MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML-full">
    </script> -->

    <script src="../assets/application-77eef7aa2695bed514b473158fa8f35a6ae4cb10c6e0f2ae8e2b485af0611d43.js"></script>

    <!-- Rendering inline LaTeX -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true,
          jax: ["input/TeX","output/HTML-CSS"]
        }
      });
    </script>
    <!--<script src="/mathjax/MathJax.js?config=TeX-AMS_HTML-full.js" type="text/javascript"></script>-->
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js" type="text/javascript"></script>
    <![endif]-->
  </head>
  <body>

    
    <!-- support for progressive web app, see README -->
    <script>
      if ('serviceWorker' in navigator && !navigator.serviceWorker.controller) {
          navigator.serviceWorker.register("/sw.js").then(function(reg) {
              console.log("Service worker has been registered for scope: " + reg.scope);
          });
      }
    </script>

     <nav class="navbar navbar-expand-sm navbar-dark bg-dark fixed-top justify-content-between">
       <button id="btn" class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#nav-sidebar" aria-controls="nav-sidebar" aria-expanded="false" aria-label="Toggle navigation" title="navigation">
         <span class="navbar-toggler-icon"></span>
       </button>
       <span class="navbar-brand-short"><a title="Go back to front page" href="../index.html" class="gray">SICP &mdash; JS</a></span>
       <span class="navbar-brand-long" ><a title="Go back to front page" href="../index.html" class="gray">Structure and Interpretation
            of Computer Programs &mdash; JavaScript Adaptation</a></span>

       <!-- edit the search engine by visiting: 
	    https://cse.google.com/cse/setup/basic?cx=015760785273492757659:nc_tznrzlsg 
	       -->
       <form class="form-inline ml-auto" id="xxx">
         <div id="search-box">
	         <script>
	           (function() {
	               var cx = "015760785273492757659:nc_tznrzlsg";
	               var gcse = document.createElement("script");
	               gcse.type = "text/javascript";
	               gcse.async = true;
	               gcse.src = "https://cse.google.com/cse.js?cx=" + cx;
	               var s = document.getElementsByTagName("script")[0];
	               s.parentNode.insertBefore(gcse, s);
	           })();
	           window.onload = function()
	           { 
	               var searchBox =  document.getElementById("gsc-i-id1");
	               searchBox.placeholder="search web edition";
	               searchBox.title="search web edition"; 
	           }
	         </script>
	         <gcse:search></gcse:search>
         </div>
       </form>
       <span class="navbar-brand-short">
         &nbsp;
         &nbsp;
         <a href="https://sicp.comp.nus.edu.sg/source/" title="Go to the Source language(s) definition(s)" class="gray">S</a>
       </span>
       <span class="navbar-brand-long">
         &nbsp;
         &nbsp;
         <a href="https://sicp.comp.nus.edu.sg/source/" title="Go to the Source language(s) definition(s)" class="gray">Source</a>
       </span>
     </nav>
     
     <div class="container scroll">

       <div class="collapse" id="nav-sidebar" role="tablist" aria-multiselectable="true">
	 <!-- insert a dummy entry, to give one extra line of space -->
         <a class="navbar-brand" href="index.html">&nbsp;</a>
                     <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-122">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-122" aria-expanded="false" aria-controls="sidebar-collapse-122">
                    <a href="122">        Foreword    </a>
                  </span>
                </h5>
              </div>
            </div>

                     <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-123">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-123" aria-expanded="false" aria-controls="sidebar-collapse-123">
                    <a href="123">        Prefaces    </a>
                  </span>
                </h5>
              </div>
            </div>

                     <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-124">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-124" aria-expanded="false" aria-controls="sidebar-collapse-124">
                    <a href="124">Acknowledgments from Second Edition of SICP, 1996    </a>
                  </span>
                </h5>
              </div>
            </div>

                     <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-1">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-1" aria-expanded="true" aria-controls="sidebar-collapse-1">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-1" aria-expanded="true" aria-controls="sidebar-collapse-1">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="1">1        Building Abstractions with       Functions    </a>
                </h5>
              </div>
              <div id="sidebar-collapse-1" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-2">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-2" aria-expanded="true" aria-controls="sidebar-collapse-2">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-2" aria-expanded="true" aria-controls="sidebar-collapse-2">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="2">1.1  The Elements of Programming</a>
                </h5>
              </div>
              <div id="sidebar-collapse-2" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-3">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-3" aria-expanded="false" aria-controls="sidebar-collapse-3">
                    <a href="3">1.1.1  Expressions</a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-4">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-4" aria-expanded="false" aria-controls="sidebar-collapse-4">
                    <a href="4">1.1.2  Naming and the Environment</a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-5">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-5" aria-expanded="false" aria-controls="sidebar-collapse-5">
                    <a href="5">1.1.3            Evaluating          Operator Combinations        </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-6">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-6" aria-expanded="false" aria-controls="sidebar-collapse-6">
                    <a href="6">1.1.4            Functions        </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-7">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-7" aria-expanded="false" aria-controls="sidebar-collapse-7">
                    <a href="7">1.1.5            The Substitution Model for                                                 Function                              Application        </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-8">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-8" aria-expanded="false" aria-controls="sidebar-collapse-8">
                    <a href="8">1.1.6            Conditional Expressions and Predicates        </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-9">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-9" aria-expanded="false" aria-controls="sidebar-collapse-9">
                    <a href="9">1.1.7  Example: Square Roots by Newtons Method</a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-10">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-10" aria-expanded="false" aria-controls="sidebar-collapse-10">
                    <a href="10">1.1.8                                                  Functions                                as Black-Box Abstractions        </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-11">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-11" aria-expanded="true" aria-controls="sidebar-collapse-11">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-11" aria-expanded="true" aria-controls="sidebar-collapse-11">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="11">1.2              Functions            and the Processes They Generate      </a>
                </h5>
              </div>
              <div id="sidebar-collapse-11" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-12">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-12" aria-expanded="false" aria-controls="sidebar-collapse-12">
                    <a href="12">1.2.1  Linear Recursion and Iteration</a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-13">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-13" aria-expanded="false" aria-controls="sidebar-collapse-13">
                    <a href="13">1.2.2  Tree Recursion</a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-14">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-14" aria-expanded="false" aria-controls="sidebar-collapse-14">
                    <a href="14">1.2.3  Orders of Growth</a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-15">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-15" aria-expanded="false" aria-controls="sidebar-collapse-15">
                    <a href="15">1.2.4  Exponentiation</a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-16">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-16" aria-expanded="false" aria-controls="sidebar-collapse-16">
                    <a href="16">1.2.5  Greatest Common Divisors</a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-17">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-17" aria-expanded="false" aria-controls="sidebar-collapse-17">
                    <a href="17">1.2.6  Example: Testing for Primality</a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-18">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-18" aria-expanded="true" aria-controls="sidebar-collapse-18">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-18" aria-expanded="true" aria-controls="sidebar-collapse-18">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="18">1.3          Formulating Abstractions with Higher-Order         Functions      </a>
                </h5>
              </div>
              <div id="sidebar-collapse-18" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-19">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-19" aria-expanded="false" aria-controls="sidebar-collapse-19">
                    <a href="19">1.3.1            Functions          as Arguments        </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-20">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-20" aria-expanded="false" aria-controls="sidebar-collapse-20">
                    <a href="20">1.3.2            Function Definition Expressions          </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-21">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-21" aria-expanded="false" aria-controls="sidebar-collapse-21">
                    <a href="21">1.3.3              Functions            as General Methods          </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-22">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-22" aria-expanded="false" aria-controls="sidebar-collapse-22">
                    <a href="22">1.3.4      Functions    as Returned Values  </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>

                </div>
              </div>
            </div>

                     <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-23">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-23" aria-expanded="true" aria-controls="sidebar-collapse-23">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-23" aria-expanded="true" aria-controls="sidebar-collapse-23">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="23">2  Building Abstractions with Data</a>
                </h5>
              </div>
              <div id="sidebar-collapse-23" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-24">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-24" aria-expanded="true" aria-controls="sidebar-collapse-24">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-24" aria-expanded="true" aria-controls="sidebar-collapse-24">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="24">2.1  Introduction to Data Abstraction</a>
                </h5>
              </div>
              <div id="sidebar-collapse-24" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-25">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-25" aria-expanded="false" aria-controls="sidebar-collapse-25">
                    <a href="25">2.1.1      Example: Arithmetic Operations for Rational Numbers  </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-26">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-26" aria-expanded="false" aria-controls="sidebar-collapse-26">
                    <a href="26">2.1.2          Abstraction Barriers      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-27">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-27" aria-expanded="false" aria-controls="sidebar-collapse-27">
                    <a href="27">2.1.3          What Is Meant by Data?      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-28">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-28" aria-expanded="false" aria-controls="sidebar-collapse-28">
                    <a href="28">2.1.4          Extended Exercise: Interval Arithmetic      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-29">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-29" aria-expanded="true" aria-controls="sidebar-collapse-29">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-29" aria-expanded="true" aria-controls="sidebar-collapse-29">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="29">2.2  Hierarchical Data and the Closure Property</a>
                </h5>
              </div>
              <div id="sidebar-collapse-29" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-30">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-30" aria-expanded="false" aria-controls="sidebar-collapse-30">
                    <a href="30">2.2.1          Representing Sequences      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-31">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-31" aria-expanded="false" aria-controls="sidebar-collapse-31">
                    <a href="31">2.2.2          Hierarchical Structures      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-32">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-32" aria-expanded="false" aria-controls="sidebar-collapse-32">
                    <a href="32">2.2.3          Sequences as Conventional Interfaces      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-33">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-33" aria-expanded="false" aria-controls="sidebar-collapse-33">
                    <a href="33">2.2.4          Example: A Picture Language      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-34">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-34" aria-expanded="true" aria-controls="sidebar-collapse-34">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-34" aria-expanded="true" aria-controls="sidebar-collapse-34">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="34">2.3  Symbolic Data</a>
                </h5>
              </div>
              <div id="sidebar-collapse-34" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-35">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-35" aria-expanded="false" aria-controls="sidebar-collapse-35">
                    <a href="35">2.3.1          Strings      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-36">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-36" aria-expanded="false" aria-controls="sidebar-collapse-36">
                    <a href="36">2.3.2          Example: Symbolic Differentiation      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-37">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-37" aria-expanded="false" aria-controls="sidebar-collapse-37">
                    <a href="37">2.3.3          Example: Representing Sets      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-38">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-38" aria-expanded="false" aria-controls="sidebar-collapse-38">
                    <a href="38">2.3.4          Example: Huffman Encoding Trees      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-39">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-39" aria-expanded="true" aria-controls="sidebar-collapse-39">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-39" aria-expanded="true" aria-controls="sidebar-collapse-39">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="39">2.4  Multiple Representations for Abstract Data</a>
                </h5>
              </div>
              <div id="sidebar-collapse-39" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-40">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-40" aria-expanded="false" aria-controls="sidebar-collapse-40">
                    <a href="40">2.4.1          Representations for Complex Numbers      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-41">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-41" aria-expanded="false" aria-controls="sidebar-collapse-41">
                    <a href="41">2.4.2          Tagged data      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-42">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-42" aria-expanded="false" aria-controls="sidebar-collapse-42">
                    <a href="42">2.4.3          Data-Directed Programming and Additivity      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-43">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-43" aria-expanded="true" aria-controls="sidebar-collapse-43">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-43" aria-expanded="true" aria-controls="sidebar-collapse-43">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="43">2.5  Systems with Generic Operations</a>
                </h5>
              </div>
              <div id="sidebar-collapse-43" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-44">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-44" aria-expanded="false" aria-controls="sidebar-collapse-44">
                    <a href="44">2.5.1          Generic Arithmetic Operations      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-45">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-45" aria-expanded="false" aria-controls="sidebar-collapse-45">
                    <a href="45">2.5.2          Combining Data of Different Types      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-46">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-46" aria-expanded="false" aria-controls="sidebar-collapse-46">
                    <a href="46">2.5.3          Example: Symbolic Algebra      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>

                </div>
              </div>
            </div>

                     <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-47">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-47" aria-expanded="true" aria-controls="sidebar-collapse-47">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-47" aria-expanded="true" aria-controls="sidebar-collapse-47">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="47">3  Modularity, Objects, and State</a>
                </h5>
              </div>
              <div id="sidebar-collapse-47" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-48">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-48" aria-expanded="true" aria-controls="sidebar-collapse-48">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-48" aria-expanded="true" aria-controls="sidebar-collapse-48">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="48">3.1  Assignment and Local State</a>
                </h5>
              </div>
              <div id="sidebar-collapse-48" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-49">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-49" aria-expanded="false" aria-controls="sidebar-collapse-49">
                    <a href="49">3.1.1          Local State Variables      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-50">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-50" aria-expanded="false" aria-controls="sidebar-collapse-50">
                    <a href="50">3.1.2          The Benefits of Introducing Assignment      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-51">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-51" aria-expanded="false" aria-controls="sidebar-collapse-51">
                    <a href="51">3.1.3          The Costs of Introducing Assignment      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-52">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-52" aria-expanded="true" aria-controls="sidebar-collapse-52">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-52" aria-expanded="true" aria-controls="sidebar-collapse-52">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="52">3.2  The Environment Model of Evaluation</a>
                </h5>
              </div>
              <div id="sidebar-collapse-52" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-53">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-53" aria-expanded="false" aria-controls="sidebar-collapse-53">
                    <a href="53">3.2.1          The Rules for Evaluation      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-54">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-54" aria-expanded="false" aria-controls="sidebar-collapse-54">
                    <a href="54">3.2.2          Applying Simple        Functions      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-55">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-55" aria-expanded="false" aria-controls="sidebar-collapse-55">
                    <a href="55">3.2.3          Frames as the Repository of Local State      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-56">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-56" aria-expanded="false" aria-controls="sidebar-collapse-56">
                    <a href="56">3.2.4          Internal Definitions      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-57">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-57" aria-expanded="true" aria-controls="sidebar-collapse-57">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-57" aria-expanded="true" aria-controls="sidebar-collapse-57">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="57">3.3  Modeling with Mutable Data</a>
                </h5>
              </div>
              <div id="sidebar-collapse-57" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-58">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-58" aria-expanded="false" aria-controls="sidebar-collapse-58">
                    <a href="58">3.3.1          Mutable List Structure      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-59">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-59" aria-expanded="false" aria-controls="sidebar-collapse-59">
                    <a href="59">3.3.2          Representing Queues      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-60">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-60" aria-expanded="false" aria-controls="sidebar-collapse-60">
                    <a href="60">3.3.3          Representing Tables      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-61">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-61" aria-expanded="false" aria-controls="sidebar-collapse-61">
                    <a href="61">3.3.4          A Simulator for Digital Circuits      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-62">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-62" aria-expanded="false" aria-controls="sidebar-collapse-62">
                    <a href="62">3.3.5          Propagation of Constraints      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-63">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-63" aria-expanded="true" aria-controls="sidebar-collapse-63">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-63" aria-expanded="true" aria-controls="sidebar-collapse-63">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="63">3.4  Concurrency: Time Is of the Essence</a>
                </h5>
              </div>
              <div id="sidebar-collapse-63" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-64">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-64" aria-expanded="false" aria-controls="sidebar-collapse-64">
                    <a href="64">3.4.1      The Nature of Time in Concurrent Systems  </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-65">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-65" aria-expanded="false" aria-controls="sidebar-collapse-65">
                    <a href="65">3.4.2      Mechanisms for Controlling Concurrency  </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-66">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-66" aria-expanded="true" aria-controls="sidebar-collapse-66">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-66" aria-expanded="true" aria-controls="sidebar-collapse-66">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="66">3.5  Streams</a>
                </h5>
              </div>
              <div id="sidebar-collapse-66" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-67">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-67" aria-expanded="false" aria-controls="sidebar-collapse-67">
                    <a href="67">3.5.1      Streams Are Delayed Lists  </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-68">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-68" aria-expanded="false" aria-controls="sidebar-collapse-68">
                    <a href="68">3.5.2      Infinite Streams  </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-69">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-69" aria-expanded="false" aria-controls="sidebar-collapse-69">
                    <a href="69">3.5.3      Exploiting the Stream Paradigm  </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-70">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-70" aria-expanded="false" aria-controls="sidebar-collapse-70">
                    <a href="70">3.5.4      Streams and Delayed Evaluation  </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-71">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-71" aria-expanded="false" aria-controls="sidebar-collapse-71">
                    <a href="71">3.5.5      Modularity of Functional Programs and Modularity of Objects  </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>

                </div>
              </div>
            </div>

                     <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-72">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-72" aria-expanded="true" aria-controls="sidebar-collapse-72">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-72" aria-expanded="true" aria-controls="sidebar-collapse-72">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="72">4  Metalinguistic Abstraction</a>
                </h5>
              </div>
              <div id="sidebar-collapse-72" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-73">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-73" aria-expanded="true" aria-controls="sidebar-collapse-73">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-73" aria-expanded="true" aria-controls="sidebar-collapse-73">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="73">4.1  The Metacircular Evaluator</a>
                </h5>
              </div>
              <div id="sidebar-collapse-73" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-74">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-74" aria-expanded="false" aria-controls="sidebar-collapse-74">
                    <a href="74">4.1.1      The Core of the Evaluator  </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-75">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-75" aria-expanded="false" aria-controls="sidebar-collapse-75">
                    <a href="75">4.1.2      Representing                Statements and Expressions      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-76">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-76" aria-expanded="false" aria-controls="sidebar-collapse-76">
                    <a href="76">4.1.3      Evaluator Data Structures  </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-77">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-77" aria-expanded="false" aria-controls="sidebar-collapse-77">
                    <a href="77">4.1.4      Running the Evaluator as a Program  </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-78">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-78" aria-expanded="false" aria-controls="sidebar-collapse-78">
                    <a href="78">4.1.5    Data as Programs      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-79">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-79" aria-expanded="false" aria-controls="sidebar-collapse-79">
                    <a href="79">4.1.6      Internal Declarations  </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-80">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-80" aria-expanded="false" aria-controls="sidebar-collapse-80">
                    <a href="80">4.1.7      Separating Syntactic Analysis from Execution  </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-81">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-81" aria-expanded="true" aria-controls="sidebar-collapse-81">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-81" aria-expanded="true" aria-controls="sidebar-collapse-81">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="81">4.2    Lazy Evaluation</a>
                </h5>
              </div>
              <div id="sidebar-collapse-81" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-82">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-82" aria-expanded="false" aria-controls="sidebar-collapse-82">
                    <a href="82">4.2.1      Normal Order and Applicative Order  </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-83">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-83" aria-expanded="false" aria-controls="sidebar-collapse-83">
                    <a href="83">4.2.2      An Interpreter with Lazy Evaluation  </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-84">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-84" aria-expanded="false" aria-controls="sidebar-collapse-84">
                    <a href="84">4.2.3      Streams as Lazy Lists  </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-85">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-85" aria-expanded="true" aria-controls="sidebar-collapse-85">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-85" aria-expanded="true" aria-controls="sidebar-collapse-85">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="85">4.3   Nondeterministic Computing</a>
                </h5>
              </div>
              <div id="sidebar-collapse-85" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-86">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-86" aria-expanded="false" aria-controls="sidebar-collapse-86">
                    <a href="86">4.3.1    Amb and Search      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-87">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-87" aria-expanded="false" aria-controls="sidebar-collapse-87">
                    <a href="87">4.3.2    Examples of Nondeterministic Programs      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-88">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-88" aria-expanded="false" aria-controls="sidebar-collapse-88">
                    <a href="88">4.3.3    Implementing the amb Evaluator      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-89">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-89" aria-expanded="true" aria-controls="sidebar-collapse-89">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-89" aria-expanded="true" aria-controls="sidebar-collapse-89">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="89">4.4  Logic Programming</a>
                </h5>
              </div>
              <div id="sidebar-collapse-89" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-90">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-90" aria-expanded="false" aria-controls="sidebar-collapse-90">
                    <a href="90">4.4.1    Deductive Information Retrieval      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-91">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-91" aria-expanded="false" aria-controls="sidebar-collapse-91">
                    <a href="91">4.4.2    How the Query System Works      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-92">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-92" aria-expanded="false" aria-controls="sidebar-collapse-92">
                    <a href="92">4.4.3    Is Logic Programming Mathematical Logic?      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-93">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-93" aria-expanded="false" aria-controls="sidebar-collapse-93">
                    <a href="93">4.4.4    Implementing the Query System      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>

                </div>
              </div>
            </div>

                     <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-94">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-94" aria-expanded="true" aria-controls="sidebar-collapse-94">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-94" aria-expanded="true" aria-controls="sidebar-collapse-94">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="94">5  Computing with Register Machines</a>
                </h5>
              </div>
              <div id="sidebar-collapse-94" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-95">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-95" aria-expanded="true" aria-controls="sidebar-collapse-95">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-95" aria-expanded="true" aria-controls="sidebar-collapse-95">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="95">5.1  Designing Register Machines</a>
                </h5>
              </div>
              <div id="sidebar-collapse-95" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-96">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-96" aria-expanded="false" aria-controls="sidebar-collapse-96">
                    <a href="96">5.1.1    A Language for Describing Register Machines      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-97">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-97" aria-expanded="false" aria-controls="sidebar-collapse-97">
                    <a href="97">5.1.2    Abstraction in Machine Design      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-98">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-98" aria-expanded="false" aria-controls="sidebar-collapse-98">
                    <a href="98">5.1.3    Subroutines      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-99">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-99" aria-expanded="false" aria-controls="sidebar-collapse-99">
                    <a href="99">5.1.4    Using a Stack to Implement Recursion      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-100">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-100" aria-expanded="false" aria-controls="sidebar-collapse-100">
                    <a href="100">5.1.5    Instruction Summary      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-101">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-101" aria-expanded="true" aria-controls="sidebar-collapse-101">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-101" aria-expanded="true" aria-controls="sidebar-collapse-101">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="101">5.2  A Register-Machine Simulator</a>
                </h5>
              </div>
              <div id="sidebar-collapse-101" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-102">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-102" aria-expanded="false" aria-controls="sidebar-collapse-102">
                    <a href="102">5.2.1    The Machine Model      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-103">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-103" aria-expanded="false" aria-controls="sidebar-collapse-103">
                    <a href="103">5.2.2    The Assembler      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-104">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-104" aria-expanded="false" aria-controls="sidebar-collapse-104">
                    <a href="104">5.2.3    Generating Execution  Functions  for Instructions      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-105">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-105" aria-expanded="false" aria-controls="sidebar-collapse-105">
                    <a href="105">5.2.4    Monitoring Machine Performance      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-106">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-106" aria-expanded="true" aria-controls="sidebar-collapse-106">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-106" aria-expanded="true" aria-controls="sidebar-collapse-106">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="106">5.3  Storage Allocation and Garbage Collection</a>
                </h5>
              </div>
              <div id="sidebar-collapse-106" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-107">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-107" aria-expanded="false" aria-controls="sidebar-collapse-107">
                    <a href="107">5.3.1    Memory as Vectors      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-108">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-108" aria-expanded="false" aria-controls="sidebar-collapse-108">
                    <a href="108">5.3.2    Maintaining the Illusion of Infinite Memory      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-109">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-109" aria-expanded="true" aria-controls="sidebar-collapse-109">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-109" aria-expanded="true" aria-controls="sidebar-collapse-109">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="109">5.4  The Explicit-Control Evaluator</a>
                </h5>
              </div>
              <div id="sidebar-collapse-109" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-110">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-110" aria-expanded="false" aria-controls="sidebar-collapse-110">
                    <a href="110">5.4.1    The Core of the Explicit-Control Evaluator      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-111">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-111" aria-expanded="false" aria-controls="sidebar-collapse-111">
                    <a href="111">5.4.2    Sequence Evaluation and Tail Recursion      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-112">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-112" aria-expanded="false" aria-controls="sidebar-collapse-112">
                    <a href="112">5.4.3    Conditionals, Assignments, and Definitions      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-113">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-113" aria-expanded="false" aria-controls="sidebar-collapse-113">
                    <a href="113">5.4.4    Running the Evaluator      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-114">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-114" aria-expanded="true" aria-controls="sidebar-collapse-114">
                     &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-114" aria-expanded="true" aria-controls="sidebar-collapse-114">
                    &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                    <a href="114">5.5  Compilation</a>
                </h5>
              </div>
              <div id="sidebar-collapse-114" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-115">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-115" aria-expanded="false" aria-controls="sidebar-collapse-115">
                    <a href="115">5.5.1    Structure of the Compiler      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-116">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-116" aria-expanded="false" aria-controls="sidebar-collapse-116">
                    <a href="116">5.5.2    Compiling Expressions      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-117">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-117" aria-expanded="false" aria-controls="sidebar-collapse-117">
                    <a href="117">5.5.3    Compiling Combinations      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-118">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-118" aria-expanded="false" aria-controls="sidebar-collapse-118">
                    <a href="118">5.5.4    Combining Instruction Sequences      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-119">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-119" aria-expanded="false" aria-controls="sidebar-collapse-119">
                    <a href="119">5.5.5    An Example of Compiled Code      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-120">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-120" aria-expanded="false" aria-controls="sidebar-collapse-120">
                    <a href="120">5.5.6    Lexical Addressing      </a>
                  </span>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-121">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-121" aria-expanded="false" aria-controls="sidebar-collapse-121">
                    <a href="121">5.5.7    Interfacing Compiled Code to the Evaluator      </a>
                  </span>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>

                </div>
              </div>
            </div>

                     <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-125">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-125" aria-expanded="false" aria-controls="sidebar-collapse-125">
                    <a href="125">References</a>
                  </span>
                </h5>
              </div>
            </div>

                     <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-126">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-126" aria-expanded="false" aria-controls="sidebar-collapse-126">
                    <a href="126">Index</a>
                  </span>
                </h5>
              </div>
            </div>

                     <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-127">
                <h5 class="mb-0">
                  <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-127" aria-expanded="false" aria-controls="sidebar-collapse-127">
                    <a href="127">Making of the JavaScript Adaptation</a>
                  </span>
                </h5>
              </div>
            </div>

       </div>

           <div id="permalink-msg">
  <div class="screen">
    <div class="alert alert-success">
      <strong>Permalink copied!</strong> 
    </div>
  </div>
</div>
<div class="chapter-content">

  <div class="chapter-title">
    <div class="permalink">
      <a name="top" class="permalink">2.2.3 
        Sequences as Conventional Interfaces
      </a>
    </div>
  </div>
    <div class="chapter-text" >
        <div class="SUBSECTION"><SUBSECTION>
      

      
      
      

      <div class="permalink">
<a name="p1" class="permalink"></a><p>
        In working with compound data, we've stressed how data abstraction
        permits us to design programs without becoming enmeshed in the details
        of data representations, and how abstraction preserves for us the
        flexibility to experiment with alternative representations.  In this
        section, we introduce another powerful design principle for working
        with data structures—the use of <EM>conventional interfaces</EM>.
      </p>
</div>

      <div class="permalink">
<a name="p2" class="permalink"></a><p>
        In section <REF NAME="sec:higher-order-procedures"><a class="superscript" id="2.2.3-sec-link-1.3" href="18">1.3</a></REF> we saw how program
        abstractions, implemented as higher-order
        functions, can capture
        common patterns in programs that deal with numerical data.  Our
        ability to formulate analogous operations for working with compound
        data depends crucially on the style in which we manipulate our data
        structures.  Consider, for example, the following
        function, analogous
        to the <kbd>count_leaves</kbd>
        function
        of section <REF NAME="sec:trees"><a class="superscript" id="2.2.3-sec-link-2.2.2" href="31">2.2.2</a></REF>, which
        takes a tree as argument and computes the sum of the squares of the
        leaves that are odd:

        

        <div class="snippet" id="javascript_32_0_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction square(x) {\n    return x * x;\n}\n                \nfunction is_odd(n) {\n    return n % 2 === 1;\n}\n          '+'\n'+'function sum_odd_squares(tree) {\n    return is_null(tree)\n           ? 0\n           : ! is_pair(tree)\n             ? (is_odd(tree) ? square(tree) : 0)\n             : sum_odd_squares(head(tree))\n               +\n               sum_odd_squares(tail(tree));\n}'+'\n'+'\nsum_odd_squares(list(list(2, 3), list(4, 5)));\n        '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function sum_odd_squares(tree) {
    return is_null(tree)
           ? 0
           : ! is_pair(tree)
             ? (is_odd(tree) ? square(tree) : 0)
             : sum_odd_squares(head(tree))
               +
               sum_odd_squares(tail(tree));
}</pre></div></div>

        
      </p>
</div>

      <div class="permalink">
<a name="p3" class="permalink"></a><p>
        On the surface, this
        function
        is very different from the following
        one, which constructs a list of all the even Fibonacci numbers
        ${\textrm{Fib}}(k)$, where $k$ is less than or equal to a given integer $n$:
        <div class="snippet" id="javascript_32_1_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction is_even(n) {\n    return n % 2 === 0;\n}\n          \nfunction fib(n) {\n    return n === 0\n           ? 0\n           : n === 1\n             ? 1\n             : fib(n - 1) + fib(n - 2);\n}\n          '+'\n'+'function even_fibs(n) {\n    function next(k) {\n        if (k &gt; n) {\n            return null;\n        } else {\n            const f = fib(k);\n            return is_even(f)\n                   ? pair(f, next(k + 1))\n                   : next(k + 1);\n        }\n    }\n    return next(0);\n}'+'\n'+'\neven_fibs(9);\n        '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function even_fibs(n) {
    function next(k) {
        if (k &gt; n) {
            return null;
        } else {
            const f = fib(k);
            return is_even(f)
                   ? pair(f, next(k + 1))
                   : next(k + 1);
        }
    }
    return next(0);
}</pre></div></div>

        

      </p>
</div>

      <div class="permalink">
<a name="p4" class="permalink"></a><p>
        Despite the fact that these two
        functions
        are structurally very
        different, a more abstract description of the two computations reveals
        a great deal of similarity.  The first program
        <UL>
          <LI>enumerates the leaves of a tree;
          </LI>
          <LI>filters them, selecting the odd ones;
          </LI>
          <LI>squares each of the selected ones; and
          </LI>
          <LI>accumulates the results using <kbd>+</kbd>, starting with 0.
          </LI>
        </UL>
      </p>
</div>

      <div class="permalink">
<a name="p5" class="permalink"></a><p>
        The second program
        <UL>
          <LI>enumerates the integers from 0 to $n$;
          </LI>
          <LI>computes the Fibonacci number for each integer;
          </LI>
          <LI>filters them, selecting the even ones; and
          </LI>
          <LI>accumulates the results using <kbd>pair</kbd>,  starting with the
            empty list.
          </LI>
        </UL>
      </p>
</div>

      <div class="permalink">
<a name="p6" class="permalink"></a><p>
        
        
        A signal-processing engineer would find it natural to conceptualize
        these processes in terms of signals flowing through a cascade of
        stages, each of which implements part of the program plan, as shown in
        Figure <REF NAME="fig:signal-flow-plans"><a class="superscript" id="2.2.3-fig-link-2.7" href="32#fig_2.7">2.7</a></REF>.  In <kbd>sum_odd_squares</kbd>, we
        begin with an 
        
        <EM>enumerator</EM>, which generates a <QUOTE>signal</QUOTE>
        consisting of the leaves of a given tree.  This signal is passed
        through a 
        
        <EM>filter</EM>, which eliminates all but the odd elements.
        The resulting signal is in turn passed through a 
        
        <EM>map</EM>, which is a
        <QUOTE>transducer</QUOTE> that applies the <kbd>square</kbd>
        function
        to each
        element.  The output of the map is then fed to an 
        
        <EM>accumulator</EM>,
        which combines the elements using <kbd>+</kbd>, starting from an initial 0.
        The plan for <kbd>even_fibs</kbd> is analogous.

	<SPLIT>
	  
	  
              <img src="img_javascript/ch2-Z-G-17.svg">
	  
	</SPLIT>
      </p>
</div>

      <div class="permalink">
<a name="p7" class="permalink"></a><p>
        Unfortunately, the two
        function
        definitions above fail to exhibit this
        signal-flow structure.  For instance, if we examine the <kbd>sum_odd_squares</kbd>
        function, we find that the enumeration is
        implemented partly by the <kbd>is_null</kbd> and <kbd>is_pair</kbd> tests and partly
        by the tree-recursive structure of the
        function.  Similarly, the
        accumulation is found partly in the tests and partly in the addition used
        in the recursion.  In general, there are no distinct parts of either
        function
        that correspond to the elements in the signal-flow
        description.
        Our two
        functions
        decompose the computations in a different way,
        spreading the enumeration over the program and mingling it with the
        map, the filter, and the accumulation.  If we could organize our
        programs to make the signal-flow structure manifest in the
        functions
        we write, this would increase the conceptual clarity of the resulting
        code.
      </p>
</div>

      <div class="permalink">
<a name="h1" class="permalink"></a><h2>
        Sequence Operations
      </h2>
</div>

      
      

      <div class="permalink">
<a name="p8" class="permalink"></a><p>
        The key to organizing programs so as to more clearly reflect the
        signal-flow structure is to concentrate on the <QUOTE>signals</QUOTE> that flow
        from one stage in the process to the next.  If we represent these
        signals as lists, then we can use list operations to implement the
        processing at each of the stages.  For instance, we can implement the
        mapping stages of the signal-flow diagrams using the <kbd>map</kbd>
        function
        from section <REF NAME="sec:sequences"><a class="superscript" id="2.2.3-sec-link-2.2.1" href="30">2.2.1</a></REF>:
        <div class="snippet" id="javascript_32_2_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction square(x) {\n    return x * x;\n}\n                \n// we avoid overriding the predeclared map\n// function by using the name map_ here\nfunction map_(fun, items) {\n    return is_null(items)\n           ? null\n           : pair(fun(head(items)), \n                  map_(fun, tail(items)));\n}\n          '+'\n'+'map_(square, list(1, 2, 3, 4, 5));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">map(square, list(1, 2, 3, 4, 5));</pre></div></div>
      </p>
</div>

      <div class="permalink">
<a name="p9" class="permalink"></a><p>
        Filtering a sequence to select only those elements that satisfy a
        given predicate is accomplished by
        <div class="snippet" id="javascript_32_3_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'// to avoid overriding the predeclared filter \n// function, we use the name filter_ here\nfunction filter_(predicate, sequence) {\n    return is_null(sequence)\n           ? null\n           : predicate(head(sequence))\n             ? pair(head(sequence), \n                    filter_(predicate, tail(sequence)))\n             : filter_(predicate, tail(sequence));\n}'+'\n'+'\nfunction is_odd(n) {\n    return n % 2 === 1;\n}\nfilter_(is_odd, list(1, 2, 3, 4, 5));\n        '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function filter(predicate, sequence) {
    return is_null(sequence)
           ? null
           : predicate(head(sequence))
             ? pair(head(sequence), 
                    filter(predicate, tail(sequence)))
             : filter(predicate, tail(sequence));
}</pre></div></div>

        

      </p>
</div>

      <div class="permalink">
<a name="p10" class="permalink"></a><p>
        For example,
        <div class="snippet" id="javascript_32_4_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\n// to avoid overriding the predeclared filter \n// function, we use the name filter_ here\nfunction filter_(predicate, sequence) {\n    return is_null(sequence)\n           ? null\n           : predicate(head(sequence))\n             ? pair(head(sequence), \n                    filter_(predicate, tail(sequence)))\n             : filter_(predicate, tail(sequence));\n}\n        \nfunction is_odd(n) {\n    return n % 2 === 1;\n}\n          '+'\n'+'filter_(is_odd, list(1, 2, 3, 4, 5));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">filter(is_odd, list(1, 2, 3, 4, 5));</pre></div></div>


        Accumulations can be implemented by
        
        <div class="snippet" id="javascript_32_5_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'// to avoid overriding the predeclared accumulate\n// function, we use the name accumulate_ here\nfunction accumulate_(op, initial, sequence) {\n    return is_null(sequence)\n           ? initial\n           : op(head(sequence), \n                accumulate_(op, initial, tail(sequence)));\n}'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function accumulate(op, initial, sequence) {
    return is_null(sequence)
           ? initial
           : op(head(sequence), 
                accumulate(op, initial, tail(sequence)));
}</pre></div></div>

        

        <div class="snippet" id="javascript_32_6_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\n// to avoid overriding the predeclared accumulate\n// function, we use the name accumulate_ here\nfunction accumulate_(op, initial, sequence) {\n    return is_null(sequence)\n           ? initial\n           : op(head(sequence), \n                accumulate_(op, initial, tail(sequence)));\n}\n          \nfunction plus(x, y) {\n    return x + y;\n}\n          '+'\n'+'accumulate_(plus, 0, list(1, 2, 3, 4, 5));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">accumulate(plus, 0, list(1, 2, 3, 4, 5));</pre></div></div>

        


        <div class="snippet" id="javascript_32_7_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\n// to avoid overriding the predeclared accumulate\n// function, we use the name accumulate_ here\nfunction accumulate_(op, initial, sequence) {\n    return is_null(sequence)\n           ? initial\n           : op(head(sequence), \n                accumulate_(op, initial, tail(sequence)));\n}\n          \nfunction times(x, y) {\n    return x * y;\n}\n          '+'\n'+'accumulate_(times, 1, list(1, 2, 3, 4, 5));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">accumulate(times, 1, list(1, 2, 3, 4, 5));</pre></div></div>

        <div class="snippet" id="javascript_32_8_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\n// to avoid overriding the predeclared accumulate\n// function, we use the name accumulate_ here\nfunction accumulate_(op, initial, sequence) {\n    return is_null(sequence)\n           ? initial\n           : op(head(sequence), \n                accumulate_(op, initial, tail(sequence)));\n}\n          '+'\n'+'accumulate_(pair, null, list(1, 2, 3, 4, 5));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">accumulate(pair, null, list(1, 2, 3, 4, 5));</pre></div></div>
      </p>
</div>

      <div class="permalink">
<a name="p11" class="permalink"></a><p>
        All that remains to implement signal-flow diagrams is to enumerate the
        sequence of elements to be processed.  For <kbd>even_fibs</kbd>, we need to
        generate the sequence of
        integers in a given range, which we can do as follows:
        <div class="snippet" id="javascript_32_9_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function enumerate_interval(low, high) {\n    return low &gt; high\n           ? null\n           : pair(low,\n                  enumerate_interval(low + 1, high));\n}'+'\n'+'\nenumerate_interval(2, 7);\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function enumerate_interval(low, high) {
    return low &gt; high
           ? null
           : pair(low,
                  enumerate_interval(low + 1, high));
}</pre></div></div>

        
      </p>
</div>

      <div class="permalink">
<a name="p12" class="permalink"></a><p>
        To enumerate the leaves of a tree, we can use<a class="superscript" id="footnote-link-1" href="32#footnote-1">[1]</a>

            

        <div class="snippet" id="javascript_32_10_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function enumerate_tree(tree) {\n    return is_null(tree)\n           ? null\n           : ! is_pair(tree)\n             ? list(tree)\n             : append(enumerate_tree(head(tree)),\n                      enumerate_tree(tail(tree)));\n}'+'\n'+'\nenumerate_tree(list(1, list(2, list(3, 4)), 5));\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function enumerate_tree(tree) {
    return is_null(tree)
           ? null
           : ! is_pair(tree)
             ? list(tree)
             : append(enumerate_tree(head(tree)),
                      enumerate_tree(tail(tree)));
}</pre></div></div>

        
      </p>
</div>

      <div class="permalink">
<a name="p13" class="permalink"></a><p>
        Now we can reformulate <kbd>sum_odd_squares</kbd> and <kbd>even_fibs</kbd> as in
        the signal-flow diagrams.  For <kbd>sum_odd_squares</kbd>, we enumerate the
        sequence of leaves of the tree, filter this to keep only the odd
        numbers in the sequence, square each element, and sum the results:
        <div class="snippet" id="javascript_32_11_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction square(x) {\n    return x * x;\n}\n                \nfunction plus(x, y) {\n    return x + y;\n}\n          \nfunction is_odd(n) {\n    return n % 2 === 1;\n}\n          \nfunction enumerate_tree(tree) {\n    return is_null(tree)\n           ? null\n           : ! is_pair(tree)\n             ? list(tree)\n             : append(enumerate_tree(head(tree)),\n                      enumerate_tree(tail(tree)));\n}\n        '+'\n'+'function sum_odd_squares(tree) {\n    return accumulate(plus, \n                      0, \n                      map(square, \n                          filter(is_odd, \n                                 enumerate_tree(tree))));\n}'+'\n'+'\nsum_odd_squares(list(list(2, 3), list(4, 5)));\n        '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function sum_odd_squares(tree) {
    return accumulate(plus, 
                      0, 
                      map(square, 
                          filter(is_odd, 
                                 enumerate_tree(tree))));
}</pre></div></div>
      </p>
</div>

      <div class="permalink">
<a name="p14" class="permalink"></a><p>
        For <kbd>even_fibs</kbd>, we enumerate the integers from 0 to $n$, generate
        the Fibonacci number for each of these integers, filter the resulting
        sequence to keep only the even elements, and accumulate the results
        into a list:
        <div class="snippet" id="javascript_32_12_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction is_even(n) {\n    return n % 2 === 0;\n}\n          \nfunction fib(n) {\n    return n === 0\n           ? 0\n           : n === 1\n             ? 1\n             : fib(n - 1) + fib(n - 2);\n}\n          \nfunction enumerate_interval(low, high) {\n    return low &gt; high\n           ? null\n           : pair(low,\n                  enumerate_interval(low + 1, high));\n}\n          '+'\n'+'function even_fibs(n) {\n    return accumulate(pair, \n                      null, \n                      filter(is_even, \n                             map(fib, \n                                 enumerate_interval(0, n))));\n}'+'\n'+'\neven_fibs(9);\n        '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function even_fibs(n) {
    return accumulate(pair, 
                      null, 
                      filter(is_even, 
                             map(fib, 
                                 enumerate_interval(0, n))));
}</pre></div></div>
      </p>
</div>

      <div class="permalink">
<a name="p15" class="permalink"></a><p>
        The value of expressing programs as sequence operations is that this
        helps us make program designs that are modular, that is, designs that
        are constructed by combining relatively independent pieces.  We can
        encourage modular design by providing a library of standard components
        together with a conventional interface for connecting the components
        in flexible ways.
      </p>
</div>

      <div class="permalink">
<a name="p16" class="permalink"></a><p>
        
        
        Modular construction is a powerful strategy for
        controlling complexity in engineering design.  In real
        signal-processing applications, for example, designers regularly build
        systems by cascading elements selected from standardized families of
        filters and transducers.  Similarly, sequence operations provide a
        library of standard program elements that we can mix and match.  For
        instance, we can reuse pieces from the <kbd>sum_odd_squares</kbd> and <kbd>even-fibs</kbd>
        functions
        in a program that constructs a list of the
        squares of the first $n+1$ Fibonacci numbers:
        <div class="snippet" id="javascript_32_13_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction square(x) {\n    return x * x;\n}\n                \nfunction fib(n) {\n    return n === 0\n           ? 0\n           : n === 1\n             ? 1\n             : fib(n - 1) + fib(n - 2);\n}\n          \nfunction enumerate_interval(low, high) {\n    return low &gt; high\n           ? null\n           : pair(low,\n                  enumerate_interval(low + 1, high));\n}\n          '+'\n'+'function list_fib_squares(n) {\n    return accumulate(pair, \n                      null, \n                      map(square, \n                          map(fib, \n                              enumerate_interval(0, n))));\n}'+'\n'+'\nlist_fib_squares(10);\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function list_fib_squares(n) {
    return accumulate(pair, 
                      null, 
                      map(square, 
                          map(fib, 
                              enumerate_interval(0, n))));
}</pre></div></div>

        
      </p>
</div>

      <div class="permalink">
<a name="p17" class="permalink"></a><p>
        We can rearrange the pieces and use them in computing the product of
        the odd integers in a sequence:
        <div class="snippet" id="javascript_32_14_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction square(x) {\n    return x * x;\n}\n                \nfunction is_odd(n) {\n    return n % 2 === 1;\n}\n          \nfunction times(x, y) {\n    return x * y;\n}\n          '+'\n'+'function product_of_squares_of_odd_elements(sequence) {\n    return accumulate(times, \n                      1, \n                      map(square, \n                          filter(is_odd, sequence)));\n}'+'\n'+'\nproduct_of_squares_of_odd_elements(list(1, 2, 3, 4, 5));\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function product_of_squares_of_odd_elements(sequence) {
    return accumulate(times, 
                      1, 
                      map(square, 
                          filter(is_odd, sequence)));
}</pre></div></div>

        
      </p>
</div>

      <div class="permalink">
<a name="p18" class="permalink"></a><p>
        We can also formulate conventional data-processing applications in
        terms of sequence operations.  Suppose we have a sequence of personnel
        records and we want to find the salary of the highest-paid programmer.
        Assume that we have a selector <kbd>salary</kbd> that returns the salary of
        a record, and a predicate <kbd>is_programmer</kbd> that tests if a record is
        for a programmer.  Then we can write
        
        <div class="snippet" id="javascript_32_15_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function salary_of_highest_paid_programmer(records) {\n    return accumulate(math_max, \n                      0, \n                      map(salary, \n                          filter(is_programmer, records)));\n}'+'\n'+'\nconst my_records = list(list(&quot;Linus&quot;, &quot;programmer&quot;, 30000),\n                        list(&quot;Richard&quot;, &quot;programmer&quot;, 25000),\n                        list(&quot;Bill&quot;, &quot;manager&quot;, 2500000));\nfunction is_programmer(record) {\n    return head(tail(record)) === &quot;programmer&quot;;\n}\nfunction salary(record) {\n    return head(tail(tail(record)));\n}\nsalary_of_highest_paid_programmer(my_records);\n	  '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function salary_of_highest_paid_programmer(records) {
    return accumulate(math_max, 
                      0, 
                      map(salary, 
                          filter(is_programmer, records)));
}</pre></div></div>
      </p>
</div>

      <div class="permalink">
<a name="p19" class="permalink"></a><p>
        These examples give just a hint of the vast range of operations that
        can be expressed as sequence operations.<a class="superscript" id="footnote-link-2" href="32#footnote-2">[2]</a>
      </p>
</div>

      <div class="permalink">
<a name="p20" class="permalink"></a><p>
        Sequences, implemented here as lists, serve
        as a conventional interface that permits us to combine processing
        modules.  Additionally, when we uniformly represent structures as
        sequences, we have localized the data-structure dependencies in our
        programs to a small number of sequence operations.  By changing these, 
        we can experiment with alternative representations of sequences, while
        leaving the overall design of our programs intact.  We will exploit
        this capability in section <REF NAME="sec:streams"><a class="superscript" id="2.2.3-sec-link-3.5" href="66">3.5</a></REF>, when we generalize the
        sequence-processing paradigm to admit infinite sequences.
      </p>
</div>

      <div class="permalink">
<a name="ex_2.33" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_2.33">Exercise 2.33 </a></b>
        Fill in the missing expressions to complete the following definitions
        of some basic list-manipulation operations as accumulations:
        

        <div class="snippet" id="javascript_32_16_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'// to avoid overriding the predeclared map,\n// append and length functions, we use the names\n// map_, append_ and length_ here\nfunction map_(p, sequence) {\n    return accumulate((x, y) =&gt; ?? , \n                      null, sequence);\n}\n\nfunction append_(seq1, seq2) {\n    return accumulate(pair, ??, ??);\n}\n\nfunction length_(sequence) {\n    return accumulate(??, 0, sequence);\n}'+'\n'+'\nmap_(math_sqrt, list(1, 2, 3, 4));\n// append_(list(1, 2, 3), list(4, 5, 6));\n// length_(list(1, 2, 3, 4));\n	  '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function map(f, sequence) {
    return accumulate((x, y) =&gt; ?? , 
                      null, sequence);
}

function append(seq1, seq2) {
    return accumulate(pair, ??, ??);
}

function length(sequence) {
    return accumulate(??, 0, sequence);
}</pre></div></div>
	<div class="Solution">
<div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#solution_32_1_div" data-toggle="collapse">Solution</button></div>
<div class="solution_content collapse" id="solution_32_1_div"><SOLUTION>
    <div class="snippet" id="javascript_32_17_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'// to avoid overriding the predeclared map,\n// append and length functions, we use the names\n// map_, append_ and length_ here\nfunction map_(p, sequence) {\n    return accumulate((x, y) =&gt; pair(p(x), y),\n                      null, \n                      sequence);\n}\n\nfunction append_(seq1, seq2) {\n    return accumulate(pair, seq2, seq1);\n}\n\nfunction length_(sequence) {\n    return accumulate((x, y) =&gt; y + 1,\n                      0, \n                      sequence);\n}'+'\n'+'\nmap_(math_sqrt, list(1, 2, 3, 4));\n// append_(list(1, 2, 3), list(4, 5, 6));\n// length_(list(1, 2, 3, 4));\n	  '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function map(f, sequence) {
    return accumulate((x, y) =&gt; pair(p(x), y),
                      null, 
                      sequence);
}

function append(seq1, seq2) {
    return accumulate(pair, seq2, seq1);
}

function length(sequence) {
    return accumulate((x, y) =&gt; y + 1,
                      0, 
                      sequence);
}</pre></div></div></SOLUTION></div>
</div>
      </EXERCISE>
</div>

      <div class="permalink">
<a name="ex_2.34" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_2.34">Exercise 2.34 </a></b>
        
        Evaluating a polynomial in $x$ at a given value of $x$ can be
        formulated as an accumulation.  We evaluate the polynomial
        
          \[ a_{n} x^n +a_{n-1}x^{n-1}+\cdots + a_{1} x+a_{0} \]
        
        using a well-known algorithm called 
        
        <EM>Horner's rule</EM>, which
        structures the computation as
        
          \[ \left(\cdots (a_{n}  x+a_{n-1})x+\cdots +a_{1}\right) x+a_{0} \]
        
        In other words, we start with $a_{n}$, multiply by $x$, add $a_{n-1}$, 
        multiply by $x$, and so on, until we reach $a_{0}$.<a class="superscript" id="footnote-link-3" href="32#footnote-3">[3]</a>

        Fill in the following template to produce a
        function
        that evaluates a
        polynomial using Horner's rule.
        Assume that the coefficients of the
        polynomial are arranged in a sequence, from $a_{0}$ through $a_{n}$.
        <div class="snippet" id="javascript_32_18_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function horner_eval(x, coefficient_sequence) {\n    return accumulate((this_coeff, higher_terms) =&gt; ??,\n                      0, \n                      coefficient_sequence);\n}'+'\n'+'\nhorner_eval(2, list(1, 3, 0, 5, 0, 1));\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function horner_eval(x, coefficient_sequence) {
    return accumulate((this_coeff, higher_terms) =&gt; ??,
                      0, 
                      coefficient_sequence);
}</pre></div></div>

        For example, to compute $1+3x+5x^3+x^5$ at $x=2$ you would evaluate
        <div class="snippet" id="javascript_32_19_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction horner_eval(x, coefficient_sequence) {\n    return accumulate((this_coeff, higher_terms) =&gt; ??,\n                      0, \n                      coefficient_sequence);\n}\n        '+'\n'+'horner_eval(2, list(1, 3, 0, 5, 0, 1));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">horner_eval(2, list(1, 3, 0, 5, 0, 1));</pre></div></div>
	<div class="Solution">
<div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#solution_32_2_div" data-toggle="collapse">Solution</button></div>
<div class="solution_content collapse" id="solution_32_2_div"><SOLUTION>
    <div class="snippet" id="javascript_32_20_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function horner_eval(x, coefficient_sequence) {\n    return accumulate((this_coeff, higher_terms) =&gt; \n                      x * higher_terms + this_coeff,\n                      0, \n                      coefficient_sequence);\n}'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function horner_eval(x, coefficient_sequence) {
    return accumulate((this_coeff, higher_terms) =&gt; 
                      x * higher_terms + this_coeff,
                      0, 
                      coefficient_sequence);
}</pre></div></div></SOLUTION></div>
</div>
      </EXERCISE>
</div>

      <div class="permalink">
<a name="ex_2.35" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_2.35">Exercise 2.35 </a></b>
        Redefine <kbd>count_leaves</kbd> from section <REF NAME="sec:trees"><a class="superscript" id="2.2.3-sec-link-2.2.2" href="31">2.2.2</a></REF> as an
        accumulation:
        <div class="snippet" id="javascript_32_21_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function count_leaves(t) {\n    return accumulate(??, ??, map(??, ??));\n}'+'\n'+'\ncount_leaves(pair(list(1, 2), list(3, 4)));\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function count_leaves(t) {
    return accumulate(??, ??, map(??, ??));
}</pre></div></div>
	<div class="Solution">
<div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#solution_32_3_div" data-toggle="collapse">Solution</button></div>
<div class="solution_content collapse" id="solution_32_3_div"><SOLUTION>
    <div class="snippet" id="javascript_32_22_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function count_leaves(t) {\n    return accumulate((leaves, total) =&gt; leaves + total,\n                      0, \n		      map(sub_tree =&gt; is_pair(sub_tree)\n		             ? count_leaves(sub_tree)\n                             : 1,\n			  t));\n}'+'\n'+'\ncount_leaves(pair(list(1, 2), list(3, 4)));\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function count_leaves(t) {
    return accumulate((leaves, total) =&gt; leaves + total,
                      0, 
		      map(sub_tree =&gt; is_pair(sub_tree)
		             ? count_leaves(sub_tree)
                             : 1,
			  t));
}</pre></div></div></SOLUTION></div>
</div>
      </EXERCISE>
</div>

      <div class="permalink">
<a name="ex_2.36" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_2.36">Exercise 2.36 </a></b>
        The
        function
        <kbd>accumulate_n</kbd> is similar to <kbd>accumulate</kbd> except
        that it takes as its third argument a sequence of sequences, which are all
        assumed to have the same number of elements.  It applies the
        designated accumulation
        function
        to combine all the first elements of
        the sequences, all the second elements of the sequences, and so on, and
        returns a sequence of the results.  For instance, if <kbd>s</kbd> is a sequence
        containing four sequences

	<div class="snippet" id="javascript_32_23_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'list(list( 1,  2,  3),\n     list( 4,  5,  6),\n     list( 7,  8,  9),\n     list(10, 11, 12))'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">list(list( 1,  2,  3),
     list( 4,  5,  6),
     list( 7,  8,  9),
     list(10, 11, 12))</pre></div></div>
	then the value of <kbd>accumulate_n(plus, 0, s)</kbd> should be the sequence <kbd>[22, [26, [30, null]]]</kbd>.  Fill in the missing expressions
        in the following definition of <kbd>accumulate_n</kbd>:
        <div class="snippet" id="javascript_32_24_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function accumulate_n(op, init, seqs) {\n    return is_null(head(seqs))\n           ? null\n           : pair(accumulate(op, init, ??), \n                  accumulate_n(op, init, ??));\n}'+'\n'+'\nconst seq_seq = list(list(1, 2, 3), list(4, 5, 6), \n                     list(7, 8, 9), list(10, 11, 12));\naccumulate_n(add, 0, seq_seq);\n    '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function accumulate_n(op, init, seqs) {
    return is_null(head(seqs))
           ? null
           : pair(accumulate(op, init, ??), 
                  accumulate_n(op, init, ??));
}</pre></div></div>
	<div class="Solution">
<div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#solution_32_4_div" data-toggle="collapse">Solution</button></div>
<div class="solution_content collapse" id="solution_32_4_div"><SOLUTION>
    <div class="snippet" id="javascript_32_25_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function accumulate_n(op, init, seqs) {\n    return is_null(head(seqs))\n           ? null\n           : pair(accumulate(op, init, map(x =&gt; head(x), seqs)),\n                  accumulate_n(op, init, map(x =&gt; tail(x), seqs)));\n}'+'\n'+'\nconst seq_seq = list(list(1, 2, 3), list(4, 5, 6), \n                     list(7, 8, 9), list(10, 11, 12));\naccumulate_n(add, 0, seq_seq);\n    '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function accumulate_n(op, init, seqs) {
    return is_null(head(seqs))
           ? null
           : pair(accumulate(op, init, map(x =&gt; head(x), seqs)),
                  accumulate_n(op, init, map(x =&gt; tail(x), seqs)));
}</pre></div></div></SOLUTION></div>
</div>
    
    </EXERCISE>
</div>

      <div class="permalink">
<a name="ex_2.37" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_2.37">Exercise 2.37 </a></b>
        
        
        
        Suppose we represent vectors $v=(v_{i})$ as sequences of numbers, and
        matrices $m=(m_{ij})$ as sequences of vectors (the rows of the matrix).
        For example, the matrix
        
          \[ \left[ 
          \begin{array}{llll}
          1 &amp; 2 &amp; 3 &amp; 4\\
          4 &amp; 5 &amp; 6 &amp; 6\\
          6 &amp; 7 &amp; 8 &amp; 9\\
          \end{array}
          \right] \]
        
	<SPLIT>
	  
	  
	    is represented as the following sequence:
	    <div class="snippet" id="javascript_32_26_div"><div class="pre-prettyprint"><pre class="prettyprint no-eval">[[1, [2, [3, [4, null]]]], 
 [[4, [5, [6, [6, null]]]], 
  [[6, [7, [8, [9, null]]]], null]]]</pre></div></div>
	  
	</SPLIT>
        With this representation, we can use sequence operations to concisely
        express the basic matrix and vector operations.  These operations
        (which are described in any book on matrix algebra) are the following:


        <UL>
          <LI>
          <kbd>dot_product(</kbd>$v$<kbd>, </kbd>$w$<kbd>)</kbd> returns the sum $\sum_{i}v_{i}
            w_{i}$.
          </LI>
          <LI>
            <kbd>matrix_times_vector(</kbd>$m$<kbd>, </kbd>$v$<kbd>)</kbd> returns the vector $t$, where $t_{i} =\sum_{j}m_{ij}v_{j}$.
          </LI>
          <LI>
            <kbd>matrix_times_matrix(</kbd>$m$<kbd>, </kbd>$n$<kbd>)</kbd> returns the matrix $p$, where $p_{ij}=\sum_{k} m_{ik}n_{kj}$.
          </LI>
          <LI>
            <kbd>transpose(</kbd>$m$<kbd>)</kbd> returns the matrix $n$, where $n_{ij}=m_{ji}$.
          </LI>
        </UL>
        We can define the dot product as<a class="superscript" id="footnote-link-4" href="32#footnote-4">[4]</a>
          <div class="snippet" id="javascript_32_27_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction plus(x, y) {\n    return x + y;\n}\n          \nfunction times(x, y) {\n    return x * y;\n}\n          \nfunction accumulate_n(op, init, seqs) {\n    return is_null(head(seqs))\n           ? null\n           : pair(accumulate(op, init, map(x =&gt; head(x), seqs)),\n                  accumulate_n(op, init, map(x =&gt; tail(x), seqs)));\n}\n    '+'\n'+'function dot_product(v, w) {\n    return accumulate(plus, 0, \n                      accumulate_n(times, 1, list(v, w)));\n}'+'\n'+'\ndot_product(list(1, 2), list(3, 4));\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function dot_product(v, w) {
    return accumulate(plus, 0, 
                      accumulate_n(times, 1, list(v, w)));
}</pre></div></div>
        

        Fill in the missing expressions in the following
        functions
        for
        computing the other matrix operations.  (The
        function
        <kbd>accumulate_n</kbd> is
        defined in exercise <REF NAME="ex:accumulate-n"><a class="superscript" id="2.2.3-ex-link-2.36" href="32#ex_2.36">2.36</a></REF>.)
        <div class="snippet" id="javascript_32_28_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function matrix_times_vector(m, v) {\n    return map(??, m);\n}\n\nfunction transpose(mat) {\n    return accumulate_n(??, ??, mat);\n}\n\nfunction matrix_times_matrix(n, m) {\n    const cols = transpose(n);\n    return map(??, m);\n}'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function matrix_times_vector(m, v) {
    return map(??, m);
}

function transpose(mat) {
    return accumulate_n(??, ??, mat);
}

function matrix_times_matrix(n, m) {
    const cols = transpose(n);
    return map(??, m);
}</pre></div></div>
  <div class="Solution">
<div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#solution_32_5_div" data-toggle="collapse">Solution</button></div>
<div class="solution_content collapse" id="solution_32_5_div"><SOLUTION>
    <div class="snippet" id="javascript_32_29_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction accumulate_n(op, init, seqs) {\n    return is_null(head(seqs))\n           ? null\n           : pair(accumulate(op, init, map(x =&gt; head(x), seqs)),\n                  accumulate_n(op, init, map(x =&gt; tail(x), seqs)));\n}\n    \nfunction plus(x, y) {\n    return x + y;\n}\n          \nfunction times(x, y) {\n    return x * y;\n}\n          \nfunction dot_product(v, w) {\n    return accumulate(plus, 0, \n                      accumulate_n(times, 1, list(v, w)));\n}\n        '+'\n'+'function matrix_times_vector(m, v) {\n    return map(row =&gt; dot_product(row, v), m);\n}\n\nfunction transpose(mat) {\n    return accumulate_n(pair, null, mat);\n}\n\nfunction matrix_times_matrix(n, m) {\n    const cols = transpose(m);\n    return map(x =&gt; map(y =&gt; dot_product(x, y), cols), n);\n}'+'\n'+'\nconst v = list(10, 20, 30);\nconst m1 = list(list(1, 2, 3), list(3, 5, 1), list(1, 1, 1));\nconst m2 = list(list(1, 2, 3), list(4, 5, 6), list(7, 8, 9));\n\nmatrix_times_vector(m1, v);\n// transpose(m1);\n// matrix_times_matrix(m1, m2);\n     '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function matrix_times_vector(m, v) {
    return map(row =&gt; dot_product(row, v), m);
}

function transpose(mat) {
    return accumulate_n(pair, null, mat);
}

function matrix_times_matrix(n, m) {
    const cols = transpose(m);
    return map(x =&gt; map(y =&gt; dot_product(x, y), cols), n);
}</pre></div></div></SOLUTION></div>
</div>
    
      </EXERCISE>
</div>

      <div class="permalink">
<a name="ex_2.38" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_2.38">Exercise 2.38 </a></b>
        
        
        The <kbd>accumulate</kbd>
        function
        is also known as <kbd>fold_right</kbd>, 
        because it combines the first element of the sequence with the result
        of combining all the elements to the right.  There is also a <kbd>fold_left</kbd>, which is 
        similar to <kbd>fold_right</kbd>, except
        that it combines elements working in the opposite direction:
        <div class="snippet" id="javascript_32_30_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function fold_left(op, initial, sequence) {\n    function iter(result, rest) {\n        return is_null(rest)\n               ? result\n               : iter(op(result, head(rest)), \n                      tail(rest));\n    }\n    return iter(initial, sequence);\n}'+'\n'+'\nfold_left(list, null, list(1, 2, 3));\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function fold_left(op, initial, sequence) {
    function iter(result, rest) {
        return is_null(rest)
               ? result
               : iter(op(result, head(rest)), 
                      tail(rest));
    }
    return iter(initial, sequence);
}</pre></div></div>

        

        What are the values of
        
        <div class="snippet" id="javascript_32_31_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\n// same as accumulate\nconst fold_right = accumulate;\n          \nfunction divide(x, y) {\n    return x / y;\n}\n          '+'\n'+'fold_right(divide, 1, list(1, 2, 3));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">fold_right(divide, 1, list(1, 2, 3));</pre></div></div>
        <div class="snippet" id="javascript_32_32_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction fold_left(op, initial, sequence) {\n    function iter(result, rest) {\n        return is_null(rest)\n               ? result\n               : iter(op(result, head(rest)), \n                      tail(rest));\n    }\n    return iter(initial, sequence);\n}\n        \nfunction divide(x, y) {\n    return x / y;\n}\n          '+'\n'+'fold_left(divide, 1, list(1, 2, 3));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">fold_left(divide, 1, list(1, 2, 3));</pre></div></div>
        <div class="snippet" id="javascript_32_33_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\n// same as accumulate\nconst fold_right = accumulate;\n          '+'\n'+'fold_right(list, null, list(1, 2, 3));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">fold_right(list, null, list(1, 2, 3));</pre></div></div>
        <div class="snippet" id="javascript_32_34_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction fold_left(op, initial, sequence) {\n    function iter(result, rest) {\n        return is_null(rest)\n               ? result\n               : iter(op(result, head(rest)), \n                      tail(rest));\n    }\n    return iter(initial, sequence);\n}\n        '+'\n'+'fold_left(list, null, list(1, 2, 3));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">fold_left(list, null, list(1, 2, 3));</pre></div></div>

        Give a property that <kbd>op</kbd> should satisfy to guarantee that <kbd>fold_right</kbd> and <kbd>fold_left</kbd> will produce the same values for any
        sequence.
        
   <div class="Solution">
<div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#solution_32_6_div" data-toggle="collapse">Solution</button></div>
<div class="solution_content collapse" id="solution_32_6_div"><SOLUTION>
     We can guarantee that <kbd>fold_right</kbd> and
     <kbd>fold_left</kbd> produce
     the same values for any sequence, if we require that
     <kbd>op</kbd> is commutative and associative.
 <div class="snippet" id="javascript_32_35_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction plus(x, y) {\n    return x + y;\n}\n          \n// same as accumulate\nconst fold_right = accumulate;\n          '+'\n'+'fold_right(plus, 0, list(1, 2, 3));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">fold_right(plus, 0, list(1, 2, 3));</pre></div></div>
<div class="snippet" id="javascript_32_36_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction plus(x, y) {\n    return x + y;\n}\n          \nfunction fold_left(op, initial, sequence) {\n    function iter(result, rest) {\n        return is_null(rest)\n               ? result\n               : iter(op(result, head(rest)), \n                      tail(rest));\n    }\n    return iter(initial, sequence);\n}\n        '+'\n'+'fold_left(plus, 0, list(1, 2, 3));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">fold_left(plus, 0, list(1, 2, 3));</pre></div></div>
   </SOLUTION></div>
</div>
      </EXERCISE>
</div>

      <div class="permalink">
<a name="ex_2.39" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_2.39">Exercise 2.39 </a></b>
        Complete the following definitions of <kbd>reverse</kbd>
        
        (exercise <REF NAME="ex:reverse"><a class="superscript" id="2.2.3-ex-link-2.18" href="30#ex_2.18">2.18</a></REF>) in terms of <kbd>fold_right</kbd> and <kbd>fold_left</kbd> from exercise <REF NAME="ex:fold-right-left"><a class="superscript" id="2.2.3-ex-link-2.38" href="32#ex_2.38">2.38</a></REF>:

        <div class="snippet" id="javascript_32_37_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function reverse_(sequence) {\n    return fold_right((x, y) =&gt; ??, null, sequence);\n}'+'\n'+'\nreverse_(list(1, 4, 9, 16, 25));\n// result: [25, [16, [9, [4, [1, null]]]]]\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function reverse(sequence) {
    return fold_right((x, y) =&gt; ??, null, sequence);
}</pre></div></div>

        <div class="snippet" id="javascript_32_38_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function reverse_(sequence) {\n    return fold_left((x, y) =&gt; ??, null, sequence);\n}'+'\n'+'\nreverse_(list(1, 4, 9, 16, 25));\n// result: [25, [16, [9, [4, [1, null]]]]]\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function reverse(sequence) {
    return fold_left((x, y) =&gt; ??, null, sequence);
}</pre></div></div>

	
	<div class="Solution">
<div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#solution_32_7_div" data-toggle="collapse">Solution</button></div>
<div class="solution_content collapse" id="solution_32_7_div"><SOLUTION>
  <div class="snippet" id="javascript_32_39_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\n// same as accumulate\nconst fold_right = accumulate;\n          '+'\n'+'// to avoid overriding the predeclared reverse\n// function, we use the name reverse_ here\nfunction reverse_(sequence) {\n    return fold_right((x, y) =&gt; append(y, list(x)), \n                      null, sequence);\n}'+'\n'+'\nreverse_(list(1, 4, 9, 16, 25));\n// result: [25, [16, [9, [4, [1, null]]]]]\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function reverse(sequence) {
    return fold_right((x, y) =&gt; append(y, list(x)), 
                      null, sequence);
}</pre></div></div>

<div class="snippet" id="javascript_32_40_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction fold_left(op, initial, sequence) {\n    function iter(result, rest) {\n        return is_null(rest)\n               ? result\n               : iter(op(result, head(rest)), \n                      tail(rest));\n    }\n    return iter(initial, sequence);\n}\n        '+'\n'+'// to avoid overriding the predeclared reverse\n// function, we use the name reverse_ here\nfunction reverse_(sequence) {\n    return fold_left((x, y) =&gt; pair(y, x), null, sequence);\n}'+'\n'+'\nreverse_(list(1, 4, 9, 16, 25));\n// result: [25, [16, [9, [4, [1, null]]]]]\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function reverse(sequence) {
    return fold_left((x, y) =&gt; pair(y, x), null, sequence);
}</pre></div></div>
</SOLUTION></div>
</div>
      </EXERCISE>
</div>
      

      <div class="permalink">
<a name="h2" class="permalink"></a><h2>
        Nested Mappings
      </h2>
</div>

      
      

      <div class="permalink">
<a name="p22" class="permalink"></a><p>
        We can extend the sequence paradigm to include many
        computations that are commonly expressed using nested 
        loops.<a class="superscript" id="footnote-link-5" href="32#footnote-5">[5]</a>
      </p>
</div>

      <div class="permalink">
<a name="p23" class="permalink"></a><p>
        Consider
        this problem: Given a positive integer $n$, find all ordered pairs of
        distinct positive integers $i$ and $j$, where $1\leq j&lt; i\leq n$, such
        that $i +j$ is prime.  For example, if $n$ is 6, then the pairs are
        the following:
        
          \[
          \begin{array}{c|ccccccc}
          i     &amp; 2 &amp; 3 &amp; 4 &amp; 4 &amp; 5 &amp; 6 &amp; 6 \\
          j     &amp; 1 &amp; 2 &amp; 1 &amp; 3 &amp; 2 &amp; 1 &amp; 5 \\
          \hline
          i+j   &amp; 3 &amp; 5 &amp; 5 &amp; 7 &amp; 7 &amp; 7 &amp; 11
          \end{array}
          \]
        
      </p>
</div>

      <div class="permalink">
<a name="p24" class="permalink"></a><p>
        A natural way to organize this computation is to generate the sequence
        of all ordered pairs of positive integers less than or equal to $n$, 
        filter to select those pairs whose sum is prime, and
        then, for each pair $(i, j)$ that passes through the filter, produce the triple
        $(i, j, i+j)$.
      </p>
</div>

      <div class="permalink">
<a name="p25" class="permalink"></a><p>
        Here is a way to generate the sequence of pairs: For each integer
        $i\leq n$, enumerate the integers $j&lt;i$, and for each such $i$ and $j$
        generate the pair $(i, j)$.  In terms of sequence operations, we map
        along the sequence <kbd>enumerate_interval(1, n)</kbd>.  For each $i$ in
        this sequence, we map along the sequence <kbd>enumerate_interval(1, i-1)</kbd>.  For each $j$ in this latter sequence, we generate the pair
        <kbd>list(i, j)</kbd>.  This gives us a sequence of pairs for each $i$.
        Combining all the sequences for all the $i$ (by accumulating with <kbd>append</kbd>) produces the required sequence of pairs:<a class="superscript" id="footnote-link-6" href="32#footnote-6">[6]</a>

        

        <div class="snippet" id="javascript_32_41_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction enumerate_interval(low, high) {\n    return low &gt; high\n           ? null\n           : pair(low,\n                  enumerate_interval(low + 1, high));\n}\n          \nconst n = 6;\n        '+'\n'+'accumulate(append, \n           null, \n           map(i =&gt; map(j =&gt; list(i, j),\n                        enumerate_interval(1, i-1)),\n               enumerate_interval(1, n)));'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">accumulate(append, 
           null, 
           map(i =&gt; map(j =&gt; list(i, j),
                        enumerate_interval(1, i-1)),
               enumerate_interval(1, n)));</pre></div></div>
      </p>
</div>

      <div class="permalink">
<a name="p26" class="permalink"></a><p>
        The combination of mapping and accumulating with <kbd>append</kbd> is so common in this
        sort of program that we will isolate it as a separate
        function:
        
        <div class="snippet" id="javascript_32_42_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function flatmap(f, seq) {\n    return accumulate(append, null, map(f, seq));\n}'+'\n'+'\nflatmap(x =&gt; list(x, x), list(1, 2, 3, 4));\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function flatmap(f, seq) {
    return accumulate(append, null, map(f, seq));
}</pre></div></div>

        
      </p>
</div>

      <div class="permalink">
<a name="p27" class="permalink"></a><p>
        Now filter this sequence of pairs to find those whose sum is prime. The
        filter predicate is called for each element of the sequence; its
        argument is a pair and it must extract the integers from the pair.
        Thus, the predicate to apply to each element in the sequence is
        <div class="snippet" id="javascript_32_43_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction square(x) {\n    return x * x;\n}\n                \nfunction smallest_divisor(n) {\n    return find_divisor(n, 2);\n}\nfunction find_divisor(n, test_divisor) {\n     return square(test_divisor) &gt; n\n            ? n\n            : divides(test_divisor, n)\n              ? test_divisor\n              : find_divisor(n, test_divisor + 1);\n}\nfunction divides(a, b) {\n    return b % a === 0;\n}\n          \nfunction is_prime(n) {\n    return n === smallest_divisor(n);\n}\n          '+'\n'+'function is_prime_sum(pair) {\n    return is_prime(head(pair) + head(tail(pair)));\n}'+'\n'+'\nis_prime_sum(list(8, 9));\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function is_prime_sum(pair) {
    return is_prime(head(pair) + head(tail(pair)));
}</pre></div></div>
        
      </p>
</div>

      <div class="permalink">
<a name="p28" class="permalink"></a><p>
        Finally, generate the sequence of results by mapping over the filtered
        pairs using the following
        function, which constructs a triple
        consisting of the two elements of the pair along with their sum:
        <div class="snippet" id="javascript_32_44_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function make_pair_sum(pair) {\n    return list(head(pair), head(tail(pair)), \n                head(pair) + head(tail(pair)));\n}'+'\n'+'\nmake_pair_sum(list(8, 9));\n        '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function make_pair_sum(pair) {
    return list(head(pair), head(tail(pair)), 
                head(pair) + head(tail(pair)));
}</pre></div></div>
        
      </p>
</div>

      <div class="permalink">
<a name="p29" class="permalink"></a><p>
        Combining all these steps yields the complete
        function:
        <div class="snippet" id="javascript_32_45_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction make_pair_sum(pair) {\n    return list(head(pair), head(tail(pair)), \n                head(pair) + head(tail(pair)));\n}\n        \nfunction square(x) {\n    return x * x;\n}\n                \nfunction smallest_divisor(n) {\n    return find_divisor(n, 2);\n}\nfunction find_divisor(n, test_divisor) {\n     return square(test_divisor) &gt; n\n            ? n\n            : divides(test_divisor, n)\n              ? test_divisor\n              : find_divisor(n, test_divisor + 1);\n}\nfunction divides(a, b) {\n    return b % a === 0;\n}\n          \nfunction is_prime(n) {\n    return n === smallest_divisor(n);\n}\n          \nfunction is_prime_sum(pair) {\n    return is_prime(head(pair) + head(tail(pair)));\n}\n          \nfunction flatmap(f, seq) {\n    return accumulate(append, null, map(f, seq));\n}\n          \nfunction enumerate_interval(low, high) {\n    return low &gt; high\n           ? null\n           : pair(low,\n                  enumerate_interval(low + 1, high));\n}\n          '+'\n'+'function prime_sum_pairs(n) {\n    return map(make_pair_sum, \n             filter(is_prime_sum, \n               flatmap(i =&gt; map(j =&gt; list(i, j), \n                                enumerate_interval(1, i - 1)),\n                       enumerate_interval(1, n))));\n}'+'\n'+'\nprime_sum_pairs(6);\n          '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function prime_sum_pairs(n) {
    return map(make_pair_sum, 
             filter(is_prime_sum, 
               flatmap(i =&gt; map(j =&gt; list(i, j), 
                                enumerate_interval(1, i - 1)),
                       enumerate_interval(1, n))));
}</pre></div></div>

        

      </p>
</div>

      <div class="permalink">
<a name="p30" class="permalink"></a><p>
        Nested mappings are also useful for sequences other than those that
        enumerate intervals.  Suppose we wish to generate all the 
        
        
        permutations
        of a set $S$; that is, all the ways of ordering the items in
        the set.  For instance, the permutations of $\{1, 2, 3\}$ are
        $\{1, 2, 3\}$, $\{ 1, 3, 2\}$, $\{2, 1, 3\}$, $\{ 2, 3, 1\}$, $\{ 3, 1, 2\}$, and
        $\{ 3, 2, 1\}$.  Here is a plan for generating the permutations of $S$:
        For each item $x$ in $S$, recursively generate the sequence of
        permutations of $S-x$, <a class="superscript" id="footnote-link-7" href="32#footnote-7">[7]</a> and adjoin
        $x$ to the front of each one.  This yields, for each $x$ in $S$, the sequence
        of permutations of $S$ that begin with $x$.  Combining these
        sequences for all $x$ gives all the permutations of $S$:<a class="superscript" id="footnote-link-8" href="32#footnote-8">[8]</a>

        <div class="snippet" id="javascript_32_46_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction flatmap(f, seq) {\n    return accumulate(append, null, map(f, seq));\n}\n          '+'\n'+'function permutations(s) {\n    return is_null(s)\n           ? list(null)\n           : flatmap(x =&gt; map(p =&gt; pair(x, p),\n                              permutations(remove(x, s))),\n                     s);\n}'+'\n'+'\npermutations(list(1, 2, 3));\n        '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function permutations(s) {
    return is_null(s)
           ? list(null)
           : flatmap(x =&gt; map(p =&gt; pair(x, p),
                              permutations(remove(x, s))),
                     s);
}</pre></div></div>

        

      </p>
</div>

      <div class="permalink">
<a name="p31" class="permalink"></a><p>
        Notice how this strategy reduces the problem of generating
        permutations of $S$ to the problem of generating the permutations of
        sets with fewer elements than $S$.  In the terminal case, we work our
        way down to the empty list, which represents a set of no elements.
        For this, we generate <kbd>list(null)</kbd>, which is a sequence with one
        item, namely the set with no elements.  The <kbd>remove</kbd>
        function
        used in <kbd>permutations</kbd> returns all the items in a given sequence
        except for a given item.  This can be expressed as a simple filter:
        <div class="snippet" id="javascript_32_47_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'// to avoid overriding the predeclared remove\n// function, we use the name remove_ here\nfunction remove_(item, sequence) {\n    return filter(x =&gt; !(x === item),\n                  sequence);\n}'+'\n'+'\nremove_(3, list(1, 2, 3, 4, 5));\n        '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function remove(item, sequence) {
    return filter(x =&gt; !(x === item),
                  sequence);
}</pre></div></div>
        
      </p>
</div>

      <div class="permalink">
<a name="ex_2.40" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_2.40">Exercise 2.40 </a></b>
        Define a
        function

        
        <kbd>unique_pairs</kbd> that, given an integer $n$, 
        generates the sequence of pairs $(i, j)$ with $1\leq j&lt; i\leq n$.  Use <kbd>unique_pairs</kbd> to simplify the definition of <kbd>prime_sum_pairs</kbd>
        given above.
   <div class="Solution">
<div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#solution_32_8_div" data-toggle="collapse">Solution</button></div>
<div class="solution_content collapse" id="solution_32_8_div"><SOLUTION>
    <div class="snippet" id="javascript_32_48_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction enumerate_interval(low, high) {\n    return low &gt; high\n           ? null\n           : pair(low,\n                  enumerate_interval(low + 1, high));\n}\n          \nfunction make_pair_sum(pair) {\n    return list(head(pair), head(tail(pair)), \n                head(pair) + head(tail(pair)));\n}\n        \nfunction square(x) {\n    return x * x;\n}\n                \nfunction smallest_divisor(n) {\n    return find_divisor(n, 2);\n}\nfunction find_divisor(n, test_divisor) {\n     return square(test_divisor) &gt; n\n            ? n\n            : divides(test_divisor, n)\n              ? test_divisor\n              : find_divisor(n, test_divisor + 1);\n}\nfunction divides(a, b) {\n    return b % a === 0;\n}\n          \nfunction is_prime(n) {\n    return n === smallest_divisor(n);\n}\n          \nfunction is_prime_sum(pair) {\n    return is_prime(head(pair) + head(tail(pair)));\n}\n          \nfunction flatmap(f, seq) {\n    return accumulate(append, null, map(f, seq));\n}\n          '+'\n'+'function unique_pairs(n) {\n    return flatmap(i =&gt; map(j =&gt; list(i, j), \n                            enumerate_interval(1, i-1)), \n                   enumerate_interval(1, n));\n}\nfunction prime_sum_pairs(n) {\n    return map(make_pair_sum, \n               filter(is_prime_sum, \n                      unique_pairs(n)));\n}'+'\n'+'\nprime_sum_pairs(6);\n    '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function unique_pairs(n) {
    return flatmap(i =&gt; map(j =&gt; list(i, j), 
                            enumerate_interval(1, i-1)), 
                   enumerate_interval(1, n));
}
function prime_sum_pairs(n) {
    return map(make_pair_sum, 
               filter(is_prime_sum, 
                      unique_pairs(n)));
}</pre></div></div>
    
    </SOLUTION></div>
</div>
      </EXERCISE>
</div>

      <div class="permalink">
<a name="ex_2.41" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_2.41">Exercise 2.41 </a></b>
        Write a
        function
        to find all ordered
        triples of distinct positive integers $i$, $j$, and $k$ less than or
        equal to a given integer $n$ that sum to a given integer $s$.
    <div class="Solution">
<div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#solution_32_9_div" data-toggle="collapse">Solution</button></div>
<div class="solution_content collapse" id="solution_32_9_div"><SOLUTION>
      <div class="snippet" id="javascript_32_49_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction enumerate_interval(low, high) {\n    return low &gt; high\n           ? null\n           : pair(low,\n                  enumerate_interval(low + 1, high));\n}\n          \nfunction flatmap(f, seq) {\n    return accumulate(append, null, map(f, seq));\n}\n          '+'\n'+'function unique_triples(n) {\n    return flatmap(i =&gt; flatmap(j =&gt; map(k =&gt; list(i, j, k),\n                                         enumerate_interval(1, j-1)),\n                                enumerate_interval(1, i-1)),\n                   enumerate_interval(1, n));\n}\nfunction plus(x, y) {\n    return x + y;\n}\nfunction triples_that_sum_to(s, n) {\n    return filter(items =&gt; accumulate(plus, 0, items) === s,\n                  unique_triples(n));\n}'+'\n'+'\ntriples_that_sum_to(10, 6);\n    '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function unique_triples(n) {
    return flatmap(i =&gt; flatmap(j =&gt; map(k =&gt; list(i, j, k),
                                         enumerate_interval(1, j-1)),
                                enumerate_interval(1, i-1)),
                   enumerate_interval(1, n));
}
function plus(x, y) {
    return x + y;
}
function triples_that_sum_to(s, n) {
    return filter(items =&gt; accumulate(plus, 0, items) === s,
                  unique_triples(n));
}</pre></div></div>
    
    </SOLUTION></div>
</div>
      </EXERCISE>
</div>

      <div class="permalink">
<a name="ex_2.42" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_2.42">Exercise 2.42 </a></b>
        

              <img src="img_original/ch2-Z-G-23.svg">
        The 
        
        
        <QUOTE>eight-queens puzzle</QUOTE> asks how to place eight queens on a
        chessboard so that no queen is in check from any other (i.e., no two
        queens are in the same row, column, or diagonal).  One possible
        solution is shown in Figure <REF NAME="fig:8queens"><a class="superscript" id="2.2.3-fig-link-2.8" href="32#fig_2.8">2.8</a></REF>.  One way to solve the
        puzzle is to work across the board, placing a queen in each column.
        Once we have placed $k-1$ queens, we must place the $k$th queen in a
        position where it does not check any of the queens already on the
        board.  We can formulate this approach recursively: Assume that we
        have already generated the sequence of all possible ways to place
        $k-1$ queens in the first $k-1$ columns of the board.  For each of
        these ways, generate an extended set of positions by placing a queen
        in each row of the $k$th column.  Now filter these, keeping only
        the positions for which the queen in the $k$th column is safe with
        respect to the other queens.  This produces the sequence of all ways
        to place $k$ queens in the first $k$ columns.  By continuing this
        process, we will produce not only one solution, but all solutions to
        the puzzle.

        We implement this solution as a
        function
        <kbd>queens</kbd>, which returns
        a sequence of all solutions to the problem of placing $n$ queens on an
        $n\times n$ chessboard.  The function <kbd>queens</kbd> has an internal
        function
        <kbd>queens_cols</kbd> that returns the sequence of all ways to place queens in
        the first $k$ columns of the board.

        
	
        <div class="snippet" id="javascript_32_50_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction flatmap(f, seq) {\n    return accumulate(append, null, map(f, seq));\n}\n          \nfunction enumerate_interval(low, high) {\n    return low &gt; high\n           ? null\n           : pair(low,\n                  enumerate_interval(low + 1, high));\n}\n          '+'\n'+'function queens(board_size) {\n    function queen_cols(k) {\n        return k === 0\n               ? list(empty_board)\n               : filter(\n                     positions =&gt; is_safe(k, positions), \n                     flatmap(rest_of_queens =&gt; \n			     map(new_row =&gt; adjoin_position(\n                                             new_row, k,\n                                             rest_of_queens), \n                                 enumerate_interval(1, \n                                     board_size)),\n			     queen_cols(k - 1)));\n   }\n   return queen_cols(board_size);\n}'+'\n'+'\nqueens(8);\n	  '+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function queens(board_size) {
    function queen_cols(k) {
        return k === 0
               ? list(empty_board)
               : filter(
                     positions =&gt; is_safe(k, positions), 
                     flatmap(rest_of_queens =&gt; 
			     map(new_row =&gt; adjoin_position(
                                             new_row, k,
                                             rest_of_queens), 
                                 enumerate_interval(1, 
                                     board_size)),
			     queen_cols(k - 1)));
   }
   return queen_cols(board_size);
}</pre></div></div>

        In this
        function
        <kbd>rest_of_queens</kbd> is a way to place $k-1$ queens
        in the first $k-1$ columns, and <kbd>new_row</kbd> is a proposed row in
        which to place the queen for the $k$th column.  Complete the program
        by implementing the representation for sets of board positions, 
        including the
        function
        <kbd>adjoin_position</kbd>, which adjoins a new row-column
        position to a set of positions, and <kbd>empty_board</kbd>, which
        represents an empty set of positions.  You must also write the
        function
        <kbd>is_safe</kbd>, which determines for a set of positions, 
        whether the queen in the $k$th column is safe with respect to the
        others.  (Note that we need only check whether the new queen is
        safe—the other queens are already guaranteed safe with respect to
        each other.)

<div class="Solution">
<div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#solution_32_10_div" data-toggle="collapse">Solution</button></div>
<div class="solution_content collapse" id="solution_32_10_div"><SOLUTION>


        <div class="snippet" id="javascript_32_51_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function adjoin_position(row, col, rest) {\n    return pair(pair(row, col), rest);\n}'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function adjoin_position(row, col, rest) {
    return pair(pair(row, col), rest);
}</pre></div></div>

        <div class="snippet" id="javascript_32_52_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'const empty_board = null;'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">const empty_board = null;</pre></div></div>

        <div class="snippet" id="javascript_32_53_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent(''+'\n'+'function is_safe(k, positions) {\n    const first_row = head(head(positions));\n    const first_col = tail(head(positions));\n    return accumulate((pos, so_far) =&gt; {\n                         const row = head(pos);\n                         const col = tail(pos);\n                         return so_far &amp;&amp;\n                                first_row - first_col !==\n                                row - col &amp;&amp;\n                                first_row + first_col !==\n                                row + col &amp;&amp;\n                                first_row !== row;\n                      },\n                      true, \n                      tail(positions));\n}'+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">function is_safe(k, positions) {
    const first_row = head(head(positions));
    const first_col = tail(head(positions));
    return accumulate((pos, so_far) =&gt; {
                         const row = head(pos);
                         const col = tail(pos);
                         return so_far &amp;&amp;
                                first_row - first_col !==
                                row - col &amp;&amp;
                                first_row + first_col !==
                                row + col &amp;&amp;
                                first_row !== row;
                      },
                      true, 
                      tail(positions));
}</pre></div></div>

	Putting it all together:

        <div class="snippet" id="javascript_32_54_div"><div class="pre-prettyprint"><pre class="prettyprint" title="Evaluate Javascript expression" onclick="var compressed = LZString.compressToEncodedURIComponent('\nfunction adjoin_position(row, col, rest) {\n    return pair(pair(row, col), rest);\n}\n          \nconst empty_board = null;\n          \nfunction is_safe(k, positions) {\n    const first_row = head(head(positions));\n    const first_col = tail(head(positions));\n    return accumulate((pos, so_far) =&gt; {\n                         const row = head(pos);\n                         const col = tail(pos);\n                         return so_far &amp;&amp;\n                                first_row - first_col !==\n                                row - col &amp;&amp;\n                                first_row + first_col !==\n                                row + col &amp;&amp;\n                                first_row !== row;\n                      },\n                      true, \n                      tail(positions));\n}   \n          \nfunction flatmap(f, seq) {\n    return accumulate(append, null, map(f, seq));\n}\n          \nfunction enumerate_interval(low, high) {\n    return low &gt; high\n           ? null\n           : pair(low,\n                  enumerate_interval(low + 1, high));\n}\n          \nfunction queens(board_size) {\n    function queen_cols(k) {\n        return k === 0\n               ? list(empty_board)\n               : filter(\n                     positions =&gt; is_safe(k, positions), \n                     flatmap(rest_of_queens =&gt; \n			     map(new_row =&gt; adjoin_position(\n                                             new_row, k,\n                                             rest_of_queens), \n                                 enumerate_interval(1, \n                                     board_size)),\n			     queen_cols(k - 1)));\n   }\n   return queen_cols(board_size);\n}\n          \nqueens(8);\n	  '+'\n'+''+'\n'+''+'\n'); var url = 'https://source-academy.github.io/playground#chap=2&amp;prgrm='+compressed; window.open(url); ">// click here to see the solution</pre></div></div>

</SOLUTION></div>
</div>

      </EXERCISE>
</div>
      

      <div class="permalink">
<a name="ex_2.43" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_2.43">Exercise 2.43 </a></b>
        Louis Reasoner is having a terrible time doing exercise <REF NAME="ex:8queens"><a class="superscript" id="2.2.3-ex-link-2.42" href="32#ex_2.42">2.42</a></REF>.  His
        <kbd>queens</kbd>
        function
        seems to work, but it runs extremely slowly.
        (Louis never does manage to wait long enough for it to solve even the
        $6\times 6$ case.)  When Louis asks Eva Lu Ator for help, she points
        out that he has interchanged the order of the nested mappings in the
        <kbd>flatmap</kbd>, writing it as
        <div class="snippet" id="javascript_32_55_div"><div class="pre-prettyprint"><pre class="prettyprint no-eval">flatmap(new_row =&gt;
        map(rest_of_queens =&gt; adjoin_position(
                               new_row, k, 
                               rest_of_queens), 
	    queen_cols(k - 1)), 
        enumerate_interval(1, board_size));</pre></div></div>

        Explain why this interchange makes the program run slowly.  Estimate
        how long it will take Louis's program to solve the eight-queens
        puzzle, assuming that the program in exercise <REF NAME="ex:8queens"><a class="superscript" id="2.2.3-ex-link-2.42" href="32#ex_2.42">2.42</a></REF> solves
        the puzzle in time $T$.

	<div class="Solution">
<div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#solution_32_11_div" data-toggle="collapse">Solution</button></div>
<div class="solution_content collapse" id="solution_32_11_div"><SOLUTION>
	  Louis's program re-evaluates the application <kbd>queen_cols(k - 1))</kbd>
	  in each iteration of <kbd>flatmap</kbd>,
	  which happens $n$
	  times for each $k$. That
	  means overall Louis's program will solve the puzzle in a time of about
	  $n^n T$ if the program in
	  exercise <REF NAME="ex:8queens"><a class="superscript" id="2.2.3-ex-link-2.42" href="32#ex_2.42">2.42</a></REF> solves the  puzzle in time 
	  $T$.
	</SOLUTION></div>
</div>

      </EXERCISE>
</div>
      
      
      
      
    <hr>
<div class="footnote">
<a class="footnote-number" id="footnote-1" href="32#footnote-link-1">[1] </a><FOOTNOTE>This 
          is, in fact, precisely the 
          
          <kbd>fringe</kbd>
          function
          from
          exercise <REF NAME="ex:fringe"><a class="superscript" id="2.2.3-ex-link-2.28" href="31#ex_2.28">2.28</a></REF>.  Here we've renamed it to emphasize that
          it is part of a family of general sequence-manipulation
          functions.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-2" href="32#footnote-link-2">[2] </a><FOOTNOTE>
          
          Richard Waters (1979)
          developed a program that automatically analyzes traditional 
          
          Fortran
          programs, viewing them in terms of maps, filters, and accumulations.
          He found that fully 90 percent of the code in the Fortran Scientific
          Subroutine Package fits neatly into this paradigm.  One of the reasons
          for the success of Lisp as a programming language is that lists
          provide a standard medium for expressing ordered collections so that
          they can be manipulated using higher-order operations.  The
          programming language 
          
          APL owes much of its power and appeal to a
          similar choice. In APL all data are represented as arrays, and there is a
          universal and convenient set of generic operators for all sorts of
          array operations.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-3" href="32#footnote-link-3">[3] </a><FOOTNOTE>According to 
          
          Knuth (1981), this rule was formulated by
          
          W. G. Horner early in the nineteenth century, but the method was
          actually used by Newton over a hundred years earlier.  Horner's rule
          evaluates the polynomial using fewer additions and multiplications
          than does the straightforward method of first computing $a_{n} x^n$, 
          then adding $a_{n-1}x^{n-1}$, and so on.  In fact, it is possible to
          prove that any algorithm for evaluating arbitrary polynomials must use
          at least as many additions and multiplications as does Horner's rule, 
          and thus Horner's rule is an 
          
          
          optimal algorithm for polynomial
          evaluation.  This was proved (for the number of additions) by
          
          A. M. Ostrowski in a 1954 paper that essentially founded the modern
          study of optimal algorithms.  The analogous statement for
          multiplications was proved by 
          
          V. Y. Pan in 1966.  The book by 
          
          
          <CITATION><div class="permalink">
<a name="p21" class="permalink"></a><p>Borodin and Munro (1975)</p>
</div>Borodin and Munro 1975</CITATION> 
          provides an overview of these and other results about
          optimal algorithms.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-4" href="32#footnote-link-4">[4] </a><FOOTNOTE>This definition uses
	
	  
	  
	    the function <kbd>accumulate_n</kbd>
	    from exercise <REF NAME="ex:accumulate-n"><a class="superscript" id="2.2.3-ex-link-2.36" href="32#ex_2.36">2.36</a></REF>.
	  
	
      </FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-5" href="32#footnote-link-5">[5] </a><FOOTNOTE>This approach to nested mappings was shown
          to us by 
          
          David Turner, whose languages 
          
          KRC and 
          
          Miranda provide elegant
          formalisms for dealing with these constructs.  The examples in this
          section (see also exercise <REF NAME="ex:8queens"><a class="superscript" id="2.2.3-ex-link-2.42" href="32#ex_2.42">2.42</a></REF>) are adapted from Turner
          1981.  In section <REF NAME="sec:exploiting-streams"><a class="superscript" id="2.2.3-sec-link-3.5.3" href="69">3.5.3</a></REF>, we'll see how this
          approach generalizes to infinite sequences.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-6" href="32#footnote-link-6">[6] </a><FOOTNOTE>We're
          representing a pair here as a list of two elements rather than as
          an ordinary pair.  Thus, the <QUOTE>pair</QUOTE> $(i, j)$ is represented as <kbd>list(i, j)</kbd>, not <kbd>pair(i, j)</kbd>.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-7" href="32#footnote-link-7">[7] </a><FOOTNOTE>The set $S-x$ is the set of all elements
          of $S$, excluding $x$.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-8" href="32#footnote-link-8">[8] </a><FOOTNOTE>
          
          
          
          The character sequence <kbd>//</kbd> in JavaScript code is used to
          introduce <EM>comments</EM>.  Everything from <kbd>//</kbd> to the end of
          the line is ignored by the interpreter.  In this book we don't use
          many comments; we try to make our programs self-documenting by using
          descriptive names.</FOOTNOTE>
</div></SUBSECTION></div>
    </div>

    <div class="nav">

        <button type="button" class="btn btn-secondary" style="background-color: #fff;">
          <a href="31">&lt; Previous</a>
        </button>

    <div style="flex-grow: 1;"></div>
    
        <button type="button" class="btn btn-secondary" style="background-color: #fff;">
          <a class="scroll-next" href="33">Next &gt;</a>
        </button>


  </div>
  <div class="chapter_sign">
        2.2.3 
        Sequences as Conventional Interfaces
      
    </div>
  <script>
//<![CDATA[
var chapter_id = 32;
//]]>
</script>
  <div class="next-page"></div>
</div>

     </div><!-- /.container -->


     <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
     -->
   </body>
</html>
